/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 * 
 *      "Free software" is a matter of liberty, not price.
 *      "Free" as in "free speech", not as in "free beer".
 *                                         - Richard M. Stallman
 * 
 * FUELED BY:
 *  - the wonderful Constructive Solid Geometry library by Evan Wallace (http://madebyevan.com)
 *    LICENSE: https://raw.github.com/xtk/X/master/lib/csg/LICENSE
 *
 *  - parts of the Google Closure Library (http://code.google.com/closure/library)
 *    LICENSE: https://raw.github.com/xtk/google-closure-library/master/LICENSE
 *
 *  - zlib.js, the ultimate gzip/zlib javascript implementation (https://github.com/imaya/zlib.js)
 *    LICENSE: https://raw.github.com/imaya/zlib.js/master/LICENSE
 *
 * MORE CREDITS: https://raw.github.com/xtk/X/master/LICENSE
 *
 */
function m(a){throw a;}var p=void 0,r=!0,t=null,u=!1;function aa(){return function(){}}function ba(a){return function(b){this[a]=b}}function v(a){return function(){return this[a]}}var w,ea=this;function ga(){}
function ha(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ia(a){return a!==p}function ja(a){return"array"==ha(a)}function ka(a){var b=ha(a);return"array"==b||"object"==b&&"number"==typeof a.length}function la(a){return"string"==typeof a}function y(a){return"number"==typeof a}function oa(a){return"function"==ha(a)}function pa(a){var b=typeof a;return"object"==b&&a!=t||"function"==b}function qa(a){return a[ra]||(a[ra]=++sa)}var ra="closure_uid_"+(1E9*Math.random()>>>0),sa=0;
function ta(a,b,c){return a.call.apply(a.bind,arguments)}function ua(a,b,c){a||m(Error());if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,e);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function va(a,b,c){va=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ta:ua;return va.apply(t,arguments)}
function wa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}}var xa=Date.now||function(){return+new Date};function C(a,b){var c=a.split("."),e=ea;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var d;c.length&&(d=c.shift());)!c.length&&ia(b)?e[d]=b:e=e[d]?e[d]:e[d]={}}
function E(a,b){function c(){}c.prototype=b.prototype;a.w=b.prototype;a.prototype=new c;a.prototype.constructor=a};function ya(a,b,c){this.eb=this.cb=this.bb=0;3==arguments.length?(this.bb=Number(a),this.cb=Number(b),this.eb=Number(c)):a instanceof ya?(this.bb=Number(a.x()),this.cb=Number(a.y()),this.eb=Number(a.d())):(this.bb=Number(a[0]),this.cb=Number(a[1]),this.eb=Number(a[2]))}
ya.prototype={l:function(){return new ya(this.bb,this.cb,this.eb)},ec:function(a){return this.bb*a.x()+this.cb*a.y()+this.eb*a.d()},ve:function(a,b){return za(this,Aa(Ba(a,this),b))},length:function(){return Math.sqrt(this.ec(this))},yc:function(a){return new ya(this.cb*a.d()-this.eb*a.y(),this.eb*a.x()-this.bb*a.d(),this.bb*a.y()-this.cb*a.x())},x:v("bb"),y:v("cb"),d:v("eb")};function Ca(a){var b=a.length();return new ya(a.bb/b,a.cb/b,a.eb/b)}
function Aa(a,b){return new ya(a.bb*b,a.cb*b,a.eb*b)}function Ba(a,b){return new ya(a.bb-b.x(),a.cb-b.y(),a.eb-b.d())}function za(a,b){return new ya(a.bb+b.x(),a.cb+b.y(),a.eb+b.d())}function Ea(a){return new ya(-a.bb,-a.cb,-a.eb)};var F=F||{};F.Mk=r;F.La=function(a){eval("X.DEV === undefined")||window.console.time(a)};F.Ea=function(a){eval("X.DEV === undefined")||window.console.timeEnd(a)};window["X.counter"]=new function(){this.di=0;this.Dk=function(){return this.di++}};function Fa(a,b){for(var c in b){var e=b.__lookupGetter__(c),d=b.__lookupSetter__(c);c in a||(e||d?(e&&a.__defineGetter__(c,e),d&&a.__defineSetter__(c,d)):a[c]=b[c])}}var Ga=window.Uh;
Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return f.apply(this instanceof c?this:a||window,d.concat(e.call(arguments)))}function c(){}"function"!==typeof this&&m(new TypeError("Function.prototype.bind - what is trying to be bound is not callable"));var e=Array.prototype.slice,d=e.call(arguments,1),f=this;c.prototype=this.prototype;b.prototype=new c;return b});
for(var Ia=0,Ja=["ms","moz","webkit","o"],Ka=0;Ka<Ja.length&&!window.requestAnimationFrame;++Ka)window.requestAnimationFrame=window[Ja[Ka]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Ja[Ka]+"CancelAnimationFrame"]||window[Ja[Ka]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(0,16-(b-Ia)),e=window.setTimeout(function(){a(b+c)},c);Ia=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});
"slice"in ArrayBuffer.prototype||(ArrayBuffer.prototype.slice=function(a,b){a===p&&m(Error("Not enough arguments."));var c=b||this.byteLength;0>a&&(a=this.byteLength+a);0>c&&(c=this.byteLength+c);c<a&&(c=a=0);0>a&&(a=0);0>c&&(c=0);a>this.byteLength&&(a=this.byteLength);c>this.byteLength&&(c=this.byteLength);for(var e=new ArrayBuffer(c-a),d=new Uint8Array(this),f=new Uint8Array(e),g=a,h=0;g<c;++g,++h)f[h]=d[g];return e});C("$",Ga);C("Function.prototype.bind",Function.prototype.bind);
C("window.requestAnimationFrame",window.requestAnimationFrame);C("window.cancelAnimationFrame",window.cancelAnimationFrame);var La=0;function Ma(){}w=Ma.prototype;w.key=0;w.Cc=u;w.le=u;w.Da=function(a,b,c,e,d,f){oa(a)?this.bh=r:a&&a.handleEvent&&oa(a.handleEvent)?this.bh=u:m(Error("Invalid listener argument"));this.fc=a;this.wh=b;this.src=c;this.type=e;this.capture=!!d;this.yf=f;this.le=u;this.key=++La;this.Cc=u};w.handleEvent=function(a){return this.bh?this.fc.call(this.yf||this.src,a):this.fc.handleEvent.call(this.fc,a)};function Na(a,b){for(var c in a)b.call(p,a[c],c,a)}function Oa(a){var b=[],c=0,e;for(e in a)b[c++]=a[e];return b}var Pa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qa(a,b){for(var c,e,d=1;d<arguments.length;d++){e=arguments[d];for(c in e)a[c]=e[c];for(var f=0;f<Pa.length;f++)c=Pa[f],Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}};function Ra(a){if(!Sa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Ta,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Ua,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Va,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Wa,"&quot;"));return a}var Ta=/&/g,Ua=/</g,Va=/>/g,Wa=/\"/g,Sa=/[&<>\"]/;var Xa,Ya,Za,$a,ab,bb,cb;function db(){return ea.navigator?ea.navigator.userAgent:t}function fb(){return ea.navigator}$a=Za=Ya=Xa=u;var gb;if(gb=db()){var hb=fb();Xa=0==gb.indexOf("Opera");Ya=!Xa&&-1!=gb.indexOf("MSIE");Za=!Xa&&-1!=gb.indexOf("WebKit");$a=!Xa&&!Za&&"Gecko"==hb.product}var ib=Xa,jb=Ya,kb=$a,lb=Za,nb,ob=fb();nb=ob&&ob.platform||"";ab=-1!=nb.indexOf("Mac");bb=-1!=nb.indexOf("Win");cb=-1!=nb.indexOf("Linux");var rb=!!fb()&&-1!=(fb().appVersion||"").indexOf("X11");
function sb(){var a=ea.document;return a?a.documentMode:p}var tb;a:{var ub="",vb;if(ib&&ea.opera)var zb=ea.opera.version,ub="function"==typeof zb?zb():zb;else if(kb?vb=/rv\:([^\);]+)(\)|;)/:jb?vb=/MSIE\s+([^\);]+)(\)|;)/:lb&&(vb=/WebKit\/(\S+)/),vb)var Ab=vb.exec(db()),ub=Ab?Ab[1]:"";if(jb){var Bb=sb();if(Bb>parseFloat(ub)){tb=String(Bb);break a}}tb=ub}var Cb={};
function Db(a){var b;if(!(b=Cb[a])){b=0;for(var c=String(tb).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=Math.max(c.length,e.length),f=0;0==b&&f<d;f++){var g=c[f]||"",h=e[f]||"",l=RegExp("(\\d*)(\\D*)","g"),j=RegExp("(\\d*)(\\D*)","g");do{var k=l.exec(g)||["","",""],n=j.exec(h)||["","",""];if(0==k[0].length&&0==n[0].length)break;b=((0==k[1].length?0:parseInt(k[1],10))<(0==n[1].length?0:parseInt(n[1],10))?-1:(0==k[1].length?0:parseInt(k[1],
10))>(0==n[1].length?0:parseInt(n[1],10))?1:0)||((0==k[2].length)<(0==n[2].length)?-1:(0==k[2].length)>(0==n[2].length)?1:0)||(k[2]<n[2]?-1:k[2]>n[2]?1:0)}while(0==b)}b=Cb[a]=0<=b}return b}var Eb=ea.document,Fb=!Eb||!jb?p:sb()||("CSS1Compat"==Eb.compatMode?parseInt(tb,10):5);var Gb=!jb||jb&&9<=Fb,Hb=jb&&!Db("9");!lb||Db("528");kb&&Db("1.9b")||jb&&Db("8")||ib&&Db("9.5")||lb&&Db("528");kb&&!Db("8")||jb&&Db("9");var Ib=Array.prototype,Jb=Ib.indexOf?function(a,b,c){return Ib.indexOf.call(a,b,c)}:function(a,b,c){c=c==t?0:0>c?Math.max(0,a.length+c):c;if(la(a))return!la(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Kb=Ib.forEach?function(a,b,c){Ib.forEach.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=la(a)?a.split(""):a,f=0;f<e;f++)f in d&&b.call(c,d[f],f,a)},Lb=Ib.map?function(a,b,c){return Ib.map.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=Array(e),f=
la(a)?a.split(""):a,g=0;g<e;g++)g in f&&(d[g]=b.call(c,f[g],g,a));return d},Mb=Ib.some?function(a,b,c){return Ib.some.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=la(a)?a.split(""):a,f=0;f<e;f++)if(f in d&&b.call(c,d[f],f,a))return r;return u};function Nb(a,b){var c=Jb(a,b);0<=c&&Ib.splice.call(a,c,1)}function Ob(a,b,c){return 2>=arguments.length?Ib.slice.call(a,b):Ib.slice.call(a,b,c)};function Qb(){0!=Rb&&(this.Ml=Error().stack,qa(this))}var Rb=0;function Sb(a,b){this.type=a;this.currentTarget=this.target=b}w=Sb.prototype;w.Bc=u;w.defaultPrevented=u;w.Be=r;w.stopPropagation=function(){this.Bc=r};w.preventDefault=function(){this.defaultPrevented=r;this.Be=u};function Tb(a){Tb[" "](a);return a}Tb[" "]=ga;function Ub(a,b){a&&this.Da(a,b)}E(Ub,Sb);w=Ub.prototype;w.target=t;w.relatedTarget=t;w.offsetX=0;w.offsetY=0;w.clientX=0;w.clientY=0;w.screenX=0;w.screenY=0;w.button=0;w.keyCode=0;w.charCode=0;w.ctrlKey=u;w.altKey=u;w.shiftKey=u;w.metaKey=u;w.hk=u;w.ub=t;
w.Da=function(a,b){var c=this.type=a.type;Sb.call(this,c);this.target=a.target||a.srcElement;this.currentTarget=b;var e=a.relatedTarget;if(e){if(kb){var d;a:{try{Tb(e.nodeName);d=r;break a}catch(f){}d=u}d||(e=t)}}else"mouseover"==c?e=a.fromElement:"mouseout"==c&&(e=a.toElement);this.relatedTarget=e;this.offsetX=lb||a.offsetX!==p?a.offsetX:a.layerX;this.offsetY=lb||a.offsetY!==p?a.offsetY:a.layerY;this.clientX=a.clientX!==p?a.clientX:a.pageX;this.clientY=a.clientY!==p?a.clientY:a.pageY;this.screenX=
a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.hk=ab?a.metaKey:a.ctrlKey;this.state=a.state;this.ub=a;a.defaultPrevented&&this.preventDefault();delete this.Bc};w.stopPropagation=function(){Ub.w.stopPropagation.call(this);this.ub.stopPropagation?this.ub.stopPropagation():this.ub.cancelBubble=r};
w.preventDefault=function(){Ub.w.preventDefault.call(this);var a=this.ub;if(a.preventDefault)a.preventDefault();else if(a.returnValue=u,Hb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};w.Oi=v("ub");var Vb={},Wb={},Xb={},Yb={};function I(a,b,c,e,d){if(ja(b)){for(var f=0;f<b.length;f++)I(a,b[f],c,e,d);return t}a=Zb(a,b,c,u,e,d);b=a.key;Vb[b]=a;return b}
function Zb(a,b,c,e,d,f){b||m(Error("Invalid event type"));d=!!d;var g=Wb;b in g||(g[b]={qa:0,Pa:0});g=g[b];d in g||(g[d]={qa:0,Pa:0},g.qa++);var g=g[d],h=qa(a),l;g.Pa++;if(g[h]){l=g[h];for(var j=0;j<l.length;j++)if(g=l[j],g.fc==c&&g.yf==f){if(g.Cc)break;e||(l[j].le=u);return l[j]}}else l=g[h]=[],g.qa++;var k=$b,n=Gb?function(a){return k.call(n.src,n.fc,a)}:function(a){a=k.call(n.src,n.fc,a);if(!a)return a},j=n,g=new Ma;g.Da(c,j,a,b,d,f);g.le=e;j.src=a;j.fc=g;l.push(g);Xb[h]||(Xb[h]=[]);Xb[h].push(g);
a.addEventListener?(a==ea||!a.customEvent_)&&a.addEventListener(b,j,d):a.attachEvent(b in Yb?Yb[b]:Yb[b]="on"+b,j);return g}function ac(a,b,c,e,d){if(ja(b))for(var f=0;f<b.length;f++)ac(a,b[f],c,e,d);else a=Zb(a,b,c,r,e,d),Vb[a.key]=a}function bc(a,b,c,e,d){if(ja(b))for(var f=0;f<b.length;f++)bc(a,b[f],c,e,d);else{e=!!e;a:{f=Wb;if(b in f&&(f=f[b],e in f&&(f=f[e],a=qa(a),f[a]))){a=f[a];break a}a=t}if(a)for(f=0;f<a.length;f++)if(a[f].fc==c&&a[f].capture==e&&a[f].yf==d){cc(a[f].key);break}}}
function cc(a){var b=Vb[a];if(!b||b.Cc)return u;var c=b.src,e=b.type,d=b.wh,f=b.capture;c.removeEventListener?(c==ea||!c.customEvent_)&&c.removeEventListener(e,d,f):c.detachEvent&&c.detachEvent(e in Yb?Yb[e]:Yb[e]="on"+e,d);c=qa(c);Xb[c]&&(d=Xb[c],Nb(d,b),0==d.length&&delete Xb[c]);b.Cc=r;if(b=Wb[e][f][c])b.nh=r,dc(e,f,c,b);delete Vb[a];return r}
function dc(a,b,c,e){if(!e.we&&e.nh){for(var d=0,f=0;d<e.length;d++)e[d].Cc?e[d].wh.src=t:(d!=f&&(e[f]=e[d]),f++);e.length=f;e.nh=u;0==f&&(delete Wb[a][b][c],Wb[a][b].qa--,0==Wb[a][b].qa&&(delete Wb[a][b],Wb[a].qa--),0==Wb[a].qa&&delete Wb[a])}}function ec(a){var b=0;if(a!=t){if(a=qa(a),Xb[a]){a=Xb[a];for(var c=a.length-1;0<=c;c--)cc(a[c].key),b++}}else Na(Vb,function(a,c){cc(c);b++})}
function fc(a,b){var c=qa(a),e=Xb[c];if(e){var d=ia(b),f=ia(p);return d&&f?(e=Wb[b],!!e&&!!e[p]&&c in e[p]):!d&&!f?r:Mb(e,function(a){return d&&a.type==b||f&&a.capture==p})}return u}function gc(a,b,c,e,d){var f=1;b=qa(b);if(a[b]){var g=--a.Pa,h=a[b];h.we?h.we++:h.we=1;try{for(var l=h.length,j=0;j<l;j++){var k=h[j];k&&!k.Cc&&(f&=hc(k,d)!==u)}}finally{a.Pa=Math.max(g,a.Pa),h.we--,dc(c,e,b,h)}}return Boolean(f)}function hc(a,b){a.le&&cc(a.key);return a.handleEvent(b)}
function $b(a,b){if(a.Cc)return r;var c=a.type,e=Wb;if(!(c in e))return r;var e=e[c],d,f;if(!Gb){var g;if(!(g=b))a:{g=["window","event"];for(var h=ea;d=g.shift();)if(h[d]!=t)h=h[d];else{g=t;break a}g=h}d=g;g=r in e;h=u in e;if(g){if(0>d.keyCode||d.returnValue!=p)return r;a:{var l=u;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(j){l=r}if(l||d.returnValue==p)d.returnValue=r}}l=new Ub;l.Da(d,this);d=r;try{if(g){for(var k=[],n=l.currentTarget;n;n=n.parentNode)k.push(n);f=e[r];f.Pa=f.qa;for(var s=k.length-
1;!l.Bc&&0<=s&&f.Pa;s--)l.currentTarget=k[s],d&=gc(f,k[s],c,r,l);if(h){f=e[u];f.Pa=f.qa;for(s=0;!l.Bc&&s<k.length&&f.Pa;s++)l.currentTarget=k[s],d&=gc(f,k[s],c,u,l)}}else d=hc(a,l)}finally{k&&(k.length=0)}return d}c=new Ub(b,this);return d=hc(a,c)}var ic=0;function jc(a){return a+"_"+ic++};function kc(){Qb.call(this);this.Ql={};this.Il=this}E(kc,Qb);kc.prototype.customEvent_=r;w=kc.prototype;w.Sf=t;w.Xf=ba("Sf");w.addEventListener=function(a,b,c,e){I(this,a,b,c,e)};w.removeEventListener=function(a,b,c,e){bc(this,a,b,c,e)};
w.dispatchEvent=function(a){var b=a.type||a,c=Wb;if(b in c){if(la(a))a=new Sb(a,this);else if(a instanceof Sb)a.target=a.target||this;else{var e=a;a=new Sb(b,this);Qa(a,e)}var e=1,d,c=c[b],b=r in c,f;if(b){d=[];for(f=this;f;f=f.Sf)d.push(f);f=c[r];f.Pa=f.qa;for(var g=d.length-1;!a.Bc&&0<=g&&f.Pa;g--)a.currentTarget=d[g],e&=gc(f,d[g],a.type,r,a)&&a.Be!=u}if(u in c)if(f=c[u],f.Pa=f.qa,b)for(g=0;!a.Bc&&g<d.length&&f.Pa;g++)a.currentTarget=d[g],e&=gc(f,d[g],a.type,u,a)&&a.Be!=u;else for(d=this;!a.Bc&&
d&&f.Pa;d=d.Sf)a.currentTarget=d,e&=gc(f,d,a.type,u,a)&&a.Be!=u;a=Boolean(e)}else a=r;return a};function J(){kc.call(this);this.f="base";this.sa=window["X.counter"].Dk();this.j=u}E(J,kc);J.prototype.__defineGetter__("classname",v("f"));J.prototype.__defineGetter__("id",v("sa"));C("X.base",J);function lc(a,b){this.$a=new ya(a);this.va=new ya(b)}lc.prototype={l:function(){return new lc(this.$a.l(),this.va.l())},Ac:function(){this.va=Ea(this.va)}};function mc(a,b){this.va=a;this.Sd=b}mc.prototype={l:function(){return new mc(this.va.l(),this.Sd)},Ac:function(){this.va=Ea(this.va);this.Sd=-this.Sd}};function nc(a,b){this.Pb=a;this.He=b;var c=a[0].$a,e=a[2].$a,e=Ca(Ba(a[1].$a,c).yc(Ba(e,c)));this.Za=new mc(e,e.ec(c))}nc.prototype={l:function(){var a=this.Pb.map(function(a){return a.l()});return new nc(a,this.He)},Ac:function(){this.Pb.reverse().map(function(a){a.Ac()});this.Za.Ac()}};
function oc(a,b,c,e,d,f){for(var g=0,h=[],l=0;l<a.Pb.length;l++){var j=b.va.ec(a.Pb[l].$a)-b.Sd,j=-1E-5>j?2:1E-5<j?1:0,g=g|j;h.push(j)}switch(g){case 0:(0<b.va.ec(a.Za.va)?c:e).push(a);break;case 1:d.push(a);break;case 2:f.push(a);break;case 3:c=[];e=[];for(l=0;l<a.Pb.length;l++){var k=(l+1)%a.Pb.length,j=h[l],n=h[k],g=a.Pb[l],k=a.Pb[k];2!=j&&c.push(g);1!=j&&e.push(2!=j?g.l():g);3==(j|n)&&(j=(b.Sd-b.va.ec(g.$a))/b.va.ec(Ba(k.$a,g.$a)),j=new lc(g.$a.ve(k.$a,j),g.va.ve(k.va,j)),c.push(j),e.push(j.l()))}3<=
c.length&&d.push(new nc(c,a.He));3<=e.length&&f.push(new nc(e,a.He))}};function pc(a){this.Ba=this.Ca=this.Za=t;this.ba=[];a&&qc(this,a)}pc.prototype={l:function(){var a=new pc,b=this.Za&&this.Za.l();a.Za=b;b=this.Ca&&this.Ca.l();a.Ca=b;b=this.Ba&&this.Ba.l();a.Ba=b;a.Ge(this.ba.map(function(a){return a.l()}));return a},aa:function(){for(var a=0;a<this.ba.length;a++)this.ba[a].Ac();this.Za.Ac();this.Ca&&this.Ca.aa();this.Ba&&this.Ba.aa();a=this.Ca;this.Ca=this.Ba;this.Ba=a},Ge:ba("ba")};
function qc(a,b){if(b.length){a.Za||(a.Za=b[0].Za.l());for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Za,a.ba,a.ba,c,e);c.length&&(a.Ca||(a.Ca=new pc),qc(a.Ca,c));e.length&&(a.Ba||(a.Ba=new pc),qc(a.Ba,e))}}function rc(a){var b=a.ba.slice();a.Ca&&(b=b.concat(rc(a.Ca)));a.Ba&&(b=b.concat(rc(a.Ba)));return b}function sc(a,b){a.ba=tc(b,a.ba);a.Ca&&sc(a.Ca,b);a.Ba&&sc(a.Ba,b)}
function tc(a,b){if(!a.Za)return b.slice();for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Za,c,e,c,e);a.Ca&&(c=tc(a.Ca,c));e=a.Ba?tc(a.Ba,e):[];return c.concat(e)};function uc(){this.ba=[]}function vc(a){var b=new uc;b.Ge(a);return b}
uc.prototype={l:function(){var a=new uc;a.Ge(this.ba.map(function(a){return a.l()}));return a},dg:function(a){var b=new pc(this.l().ba);a=new pc(a.l().ba);sc(b,a);sc(a,b);a.aa();sc(a,b);a.aa();qc(b,rc(a));return vc(rc(b))},wa:function(a){var b=new pc(this.l().ba);a=new pc(a.l().ba);b.aa();sc(b,a);sc(a,b);a.aa();sc(a,b);a.aa();qc(b,rc(a));b.aa();return vc(rc(b))},Af:function(a){var b=new pc(this.l().ba);a=new pc(a.l().ba);b.aa();sc(a,b);a.aa();sc(b,a);sc(a,b);qc(b,rc(a));b.aa();return vc(rc(b))},inverse:function(){var a=
this.l();a.ba.map(function(a){a.Ac()});return a},Ge:ba("ba")};function wc(){J.call(this);this.f="indexer";this.gf=[];this.Cl=[];this.Ma={}}E(wc,J);wc.prototype.add=function(a){a==t&&m(Error("Invalid object."));var b=window.JSON.stringify(a);b in this.Ma||(this.Ma[b]=this.gf.length,this.gf.push(a));return this.Ma[b]};wc.prototype.unique=v("gf");function xc(a){J.call(this);this.f="file";this.td=a;this.j=r}E(xc,J);function yc(){this.gb=this.s=t}yc.prototype.__defineSetter__("file",function(a){if(a==t||ja(a)&&0==a.length)this.s=t;else{if(ja(a)){if(1==a.length){this.s=new xc(a[0]);return}this.s=Lb(a,function(a){var c=new M;c.s=new xc(a);return c})}else this.s=new xc(a);this.gb=t}});yc.prototype.__defineGetter__("file",function(){return!this.s?"":ja(this.s)?this.s.map(function(a){return a.s.td}):this.s.td});
yc.prototype.__defineGetter__("filedata",function(){return ja(this.s)?this.s.map(function(a){return a.gb}):this.gb});yc.prototype.__defineSetter__("filedata",function(a){if(a==t||ja(a)&&0==a.length)this.gb=t;if(ja(a))if(1==a.length)this.gb=a[0];else{var b=this.s.length,c;for(c=0;c<b;c++)this.s[c].gb=a[c]}else this.gb=a});function zc(a){if("function"==typeof a.Gd)return a.Gd();if(la(a))return a.split("");if(ka(a)){for(var b=[],c=a.length,e=0;e<c;e++)b.push(a[e]);return b}return Oa(a)};function Ac(a,b){this.ia={};this.V=[];var c=arguments.length;if(1<c){c%2&&m(Error("Uneven number of arguments"));for(var e=0;e<c;e+=2)this.set(arguments[e],arguments[e+1])}else a&&this.jf(a)}w=Ac.prototype;w.qa=0;w.fg=0;w.xf=v("qa");w.Gd=function(){Bc(this);for(var a=[],b=0;b<this.V.length;b++)a.push(this.ia[this.V[b]]);return a};function Cc(a){for(var b=0;b<a.V.length;b++){var c=a.V[b];if(Dc(a.ia,c)&&a.ia[c]==u)return r}return u}w.clear=function(){this.ia={};this.fg=this.qa=this.V.length=0};
w.remove=function(a){return Dc(this.ia,a)?(delete this.ia[a],this.qa--,this.fg++,this.V.length>2*this.qa&&Bc(this),r):u};function Bc(a){if(a.qa!=a.V.length){for(var b=0,c=0;b<a.V.length;){var e=a.V[b];Dc(a.ia,e)&&(a.V[c++]=e);b++}a.V.length=c}if(a.qa!=a.V.length){for(var d={},c=b=0;b<a.V.length;)e=a.V[b],Dc(d,e)||(a.V[c++]=e,d[e]=1),b++;a.V.length=c}}w.get=function(a,b){return Dc(this.ia,a)?this.ia[a]:b};w.set=function(a,b){Dc(this.ia,a)||(this.qa++,this.V.push(a),this.fg++);this.ia[a]=b};
w.jf=function(a){var b;if(a instanceof Ac)Bc(a),b=a.V.concat(),a=a.Gd();else{b=[];var c=0,e;for(e in a)b[c++]=e;a=Oa(a)}for(c=0;c<b.length;c++)this.set(b[c],a[c])};w.l=function(){return new Ac(this)};w.cg=function(){for(var a=new Ac,b=0;b<this.V.length;b++){var c=this.V[b];a.set(this.ia[c],c)}return a};function Dc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Ec(){J.call(this);this.f="colortable";this.Ma=new Ac;Fa(this,new yc)}E(Ec,J);Ec.prototype.add=function(a,b,c,e,d,f){(!y(a)||!y(c)||!y(e)||!y(d)||!y(f))&&m(Error("Invalid color table entry."));this.Ma.set(a,[b,c,e,d,f]);this.j=r};Ec.prototype.get=function(a){return this.Ma.get(a)};C("X.colortable.prototype.get",Ec.prototype.get);function Fc(a,b,c){this.x=ia(a)?a:0;this.y=ia(b)?b:0;this.d=ia(c)?c:0}Fc.prototype.l=function(){return new Fc(this.x,this.y,this.d)};function P(a,b,c){this.x=a;this.y=b;this.d=c}E(P,Fc);w=P.prototype;w.l=function(){return new P(this.x,this.y,this.d)};w.Mb=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.d*this.d)};w.scale=function(a){this.x*=a;this.y*=a;this.d*=a;return this};w.aa=function(){this.x=-this.x;this.y=-this.y;this.d=-this.d;return this};w.normalize=function(){return this.scale(1/this.Mb())};w.add=function(a){this.x+=a.x;this.y+=a.y;this.d+=a.d;return this};
w.wa=function(a){this.x-=a.x;this.y-=a.y;this.d-=a.d;return this};function Gc(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return Math.sqrt(c*c+e*e+d*d)}function Hc(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return c*c+e*e+d*d}function Ic(a,b){return new P(a.x+b.x,a.y+b.y,a.d+b.d)}function Jc(a,b){return new P(a.y*b.d-a.d*b.y,a.d*b.x-a.x*b.d,a.x*b.y-a.y*b.x)};F.m=P;w=F.m.prototype;w.l=P.prototype.l;w.Mb=P.prototype.Mb;w.scale=P.prototype.scale;w.aa=P.prototype.aa;w.add=P.prototype.add;w.wa=P.prototype.wa;w.normalize=function(){var a=this.Mb();return 0==a?this.scale(0):this.scale(1/a)};F.m.ec=function(a,b){return a.x*b.x+a.y*b.y+a.d*b.d};F.m.yc=Jc;F.m.wf=Gc;F.m.ve=function(a,b,c){return new P(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y),a.d+c*(b.d-a.d))};F.m.prototype.__defineGetter__("xx",v("x"));F.m.prototype.__defineGetter__("yy",v("y"));
F.m.prototype.__defineGetter__("zz",v("d"));C("X.vector",F.m);C("X.vector.prototype.clone",F.m.prototype.l);C("X.vector.prototype.magnitude",F.m.prototype.Mb);C("X.vector.prototype.scale",F.m.prototype.scale);C("X.vector.prototype.invert",F.m.prototype.aa);C("X.vector.prototype.normalize",F.m.prototype.normalize);C("X.vector.prototype.add",F.m.prototype.add);C("X.vector.prototype.subtract",F.m.prototype.wa);C("X.vector.dot",F.m.ec);C("X.vector.cross",F.m.yc);C("X.vector.distance",F.m.wf);
C("X.vector.lerp",F.m.ve);function Kc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Kc.prototype.BYTES_PER_ELEMENT=8;Kc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Kc.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Kc.BYTES_PER_ELEMENT=8}catch(Lc){}Kc.prototype.BYTES_PER_ELEMENT=Kc.prototype.BYTES_PER_ELEMENT;Kc.prototype.set=Kc.prototype.set;Kc.prototype.toString=Kc.prototype.toString;C("Float64Array",Kc)};function Mc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Mc.prototype.BYTES_PER_ELEMENT=4;Mc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Mc.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(Mc.BYTES_PER_ELEMENT=4,Mc.prototype.BYTES_PER_ELEMENT=Mc.prototype.BYTES_PER_ELEMENT,Mc.prototype.set=Mc.prototype.set,Mc.prototype.toString=Mc.prototype.toString,C("Float32Array",Mc));function Nc(){return new Float32Array(3)}function Oc(a,b,c){var e=Nc();e[0]=a;e[1]=b;e[2]=c;return e}function Pc(a,b){var c=a[0],e=a[1],d=a[2],c=1/Math.sqrt(c*c+e*e+d*d);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c};function Qc(){return new Float32Array(4)}function Rc(a,b,c,e){var d=Qc();d[0]=a;d[1]=b;d[2]=c;d[3]=e;return d};function Sc(){return new Float32Array(16)}function Tc(){var a=Sc();a[0]=a[5]=a[10]=a[15]=1;return a}function Uc(a,b,c,e,d,f,g,h,l,j,k,n,s,q,x,z,B){a[0]=b;a[1]=c;a[2]=e;a[3]=d;a[4]=f;a[5]=g;a[6]=h;a[7]=l;a[8]=j;a[9]=k;a[10]=n;a[11]=s;a[12]=q;a[13]=x;a[14]=z;a[15]=B;return a}function Vc(a,b,c,e,d){a[12]=b;a[13]=c;a[14]=e;a[15]=d;return a}function Wc(a,b,c){b*=4;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3]}function Xc(a,b,c){b*=4;c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3]}
function Q(a,b,c,e,d,f){a[b]=c;a[b+4]=e;a[b+8]=d;a[b+12]=f}function Yc(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]}function Zc(a,b,c){c[0]=a[b];c[1]=a[b+4];c[2]=a[b+8];c[3]=a[b+12]}
function $c(a,b,c){var e=a[0],d=a[1],f=a[2],g=a[3],h=a[4],l=a[5],j=a[6],k=a[7],n=a[8],s=a[9],q=a[10],x=a[11],z=a[12],B=a[13],A=a[14];a=a[15];var G=b[0],D=b[1],H=b[2],K=b[3],N=b[4],R=b[5],O=b[6],S=b[7],da=b[8],L=b[9],ca=b[10],na=b[11],U=b[12],V=b[13],Ha=b[14];b=b[15];c[0]=e*G+h*D+n*H+z*K;c[1]=d*G+l*D+s*H+B*K;c[2]=f*G+j*D+q*H+A*K;c[3]=g*G+k*D+x*H+a*K;c[4]=e*N+h*R+n*O+z*S;c[5]=d*N+l*R+s*O+B*S;c[6]=f*N+j*R+q*O+A*S;c[7]=g*N+k*R+x*O+a*S;c[8]=e*da+h*L+n*ca+z*na;c[9]=d*da+l*L+s*ca+B*na;c[10]=f*da+j*L+q*ca+
A*na;c[11]=g*da+k*L+x*ca+a*na;c[12]=e*U+h*V+n*Ha+z*b;c[13]=d*U+l*V+s*Ha+B*b;c[14]=f*U+j*V+q*Ha+A*b;c[15]=g*U+k*V+x*Ha+a*b;return c}
function ad(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],l=a[6],j=a[7],k=a[8],n=a[9],s=a[10],q=a[11],x=a[12],z=a[13],B=a[14],A=a[15],G=c*h-e*g,D=c*l-d*g,H=c*j-f*g,K=e*l-d*h,N=e*j-f*h,R=d*j-f*l,O=k*z-n*x,S=k*B-s*x,da=k*A-q*x,L=n*B-s*z,ca=n*A-q*z,na=s*A-q*B,U=G*na-D*ca+H*L+K*da-N*S+R*O;if(0==U)return u;U=1/U;b[0]=(h*na-l*ca+j*L)*U;b[1]=(-e*na+d*ca-f*L)*U;b[2]=(z*R-B*N+A*K)*U;b[3]=(-n*R+s*N-q*K)*U;b[4]=(-g*na+l*da-j*S)*U;b[5]=(c*na-d*da+f*S)*U;b[6]=(-x*R+B*H-A*D)*U;b[7]=(k*R-s*H+q*D)*U;b[8]=(g*
ca-h*da+j*O)*U;b[9]=(-c*ca+e*da-f*O)*U;b[10]=(x*N-z*H+A*G)*U;b[11]=(-k*N+n*H-q*G)*U;b[12]=(-g*L+h*S-l*O)*U;b[13]=(c*L-e*S+d*O)*U;b[14]=(-x*K+z*D-B*G)*U;b[15]=(k*K-n*D+s*G)*U;return r}function bd(a,b,c){var e=b[0],d=b[1];b=b[2];c[0]=e*a[0]+d*a[4]+b*a[8]+a[12];c[1]=e*a[1]+d*a[5]+b*a[9]+a[13];c[2]=e*a[2]+d*a[6]+b*a[10]+a[14]}
function cd(a,b,c){var e=b[0],d=b[1],f=b[2];b=b[3];c[0]=e*a[0]+d*a[4]+f*a[8]+b*a[12];c[1]=e*a[1]+d*a[5]+f*a[9]+b*a[13];c[2]=e*a[2]+d*a[6]+f*a[10]+b*a[14];c[3]=e*a[3]+d*a[7]+f*a[11]+b*a[15];return c}function ed(a,b,c,e){return Vc(a,a[0]*b+a[4]*c+a[8]*e+a[12],a[1]*b+a[5]*c+a[9]*e+a[13],a[2]*b+a[6]*c+a[10]*e+a[14],a[3]*b+a[7]*c+a[11]*e+a[15])}new Float64Array(3);new Float64Array(3);new Float64Array(4);new Float64Array(4);new Float64Array(4);new Float64Array(16);F.g={};F.g.fh=function(a,b,c,e){c=c.wa(b);c.normalize();e=F.m.yc(c,e);e.normalize();var d=F.m.yc(e,c);d.normalize();c.aa();Q(a,0,e.x,e.y,e.d,0);Q(a,1,d.x,d.y,d.d,0);Q(a,2,c.x,c.y,c.d,0);ed(a,-b.x,-b.y,-b.d);return a};F.g.ga=function(a,b,c,e){var d=1/(b*a[3]+c*a[7]+e*a[11]+a[15]);return new F.m((b*a[0]+c*a[4]+e*a[8]+a[12])*d,(b*a[1]+c*a[5]+e*a[9]+a[13])*d,(b*a[2]+c*a[6]+e*a[10]+a[14])*d)};
F.g.Ak=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);Zc(a,b,e);Zc(a,c,d);Yc(a,b,d);Yc(a,c,e);return a};F.g.zk=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);Xc(a,b,e);Xc(a,c,d);Wc(a,b,d);Wc(a,c,e);return a};F.g.gd=Tc;F.g.l=function(a){var b=Sc();b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};
F.g.cg=function(a,b){if(b==a){var c=a[1],e=a[2],d=a[3],f=a[6],g=a[7],h=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=e;b[9]=f;b[11]=a[14];b[12]=d;b[13]=g;b[14]=h}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};
F.g.Bi=function(a){var b=a[0],c=a[1],e=a[2],d=a[3],f=a[4],g=a[5],h=a[6],l=a[7],j=a[8],k=a[9],n=a[10],s=a[11],q=a[12],x=a[13],z=a[14];a=a[15];return(b*g-c*f)*(n*a-s*z)-(b*h-e*f)*(k*a-s*x)+(b*l-d*f)*(k*z-n*x)+(c*h-e*g)*(j*a-s*q)-(c*l-d*g)*(j*z-n*q)+(e*l-d*h)*(j*x-k*q)};F.g.aa=ad;F.g.ye=function(a,b,c,e,d){var f=b/2;b=d-e;var g=Math.sin(f);if(0==b||0==g||0==c)return a;f=Math.cos(f)/g;return Uc(a,f/c,0,0,0,0,f,0,0,0,0,-(d+e)/b,-1,0,0,-(2*e*d)/b,0)};
F.g.oj=function(a,b,c,e,d,f,g){return Uc(a,2*f/(c-b),0,0,0,0,2*f/(d-e),0,0,(c+b)/(c-b),(d+e)/(d-e),-(g+f)/(g-f),-1,0,0,-(2*g*f)/(g-f),0)};F.g.pj=function(a,b,c,e,d,f,g){return Uc(a,2/(c-b),0,0,0,0,2/(d-e),0,0,0,0,-2/(g-f),0,-(c+b)/(c-b),-(d+e)/(d-e),-(g+f)/(g-f),1)};F.g.multiply=$c;F.g.jh=cd;F.g.translate=ed;F.g.scale=function(a,b,c,e){return Uc(a,a[0]*b,a[1]*b,a[2]*b,a[3]*b,a[4]*c,a[5]*c,a[6]*c,a[7]*c,a[8]*e,a[9]*e,a[10]*e,a[11]*e,a[12],a[13],a[14],a[15])};
F.g.rotate=function(a,b,c,e,d){var f=a[0],g=a[1],h=a[2],l=a[3],j=a[4],k=a[5],n=a[6],s=a[7],q=a[8],x=a[9],z=a[10],B=a[11],A=Math.cos(b),G=Math.sin(b),D=1-A;b=c*c*D+A;var H=c*e*D+d*G,K=c*d*D-e*G,N=c*e*D-d*G,R=e*e*D+A,O=e*d*D+c*G,S=c*d*D+e*G;c=e*d*D-c*G;d=d*d*D+A;return Uc(a,f*b+j*H+q*K,g*b+k*H+x*K,h*b+n*H+z*K,l*b+s*H+B*K,f*N+j*R+q*O,g*N+k*R+x*O,h*N+n*R+z*O,l*N+s*R+B*O,f*S+j*c+q*d,g*S+k*c+x*d,h*S+n*c+z*d,l*S+s*c+B*d,a[12],a[13],a[14],a[15])};
F.g.Ce=function(a,b){var c=a[4],e=a[5],d=a[6],f=a[7],g=a[8],h=a[9],l=a[10],j=a[11],k=Math.cos(b),n=Math.sin(b);a[4]=c*k+g*n;a[5]=e*k+h*n;a[6]=d*k+l*n;a[7]=f*k+j*n;a[8]=c*-n+g*k;a[9]=e*-n+h*k;a[10]=d*-n+l*k;a[11]=f*-n+j*k;return a};F.g.De=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[8],h=a[9],l=a[10],j=a[11],k=Math.cos(b),n=Math.sin(b);a[0]=c*k+g*-n;a[1]=e*k+h*-n;a[2]=d*k+l*-n;a[3]=f*k+j*-n;a[8]=c*n+g*k;a[9]=e*n+h*k;a[10]=d*n+l*k;a[11]=f*n+j*k;return a};
F.g.Ee=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],l=a[6],j=a[7],k=Math.cos(b),n=Math.sin(b);a[0]=c*k+g*n;a[1]=e*k+h*n;a[2]=d*k+l*n;a[3]=f*k+j*n;a[4]=c*-n+g*k;a[5]=e*-n+h*k;a[6]=d*-n+l*k;a[7]=f*-n+j*k;return a};C("X.matrix.identity",F.g.gd);C("X.matrix.clone",F.g.l);C("X.matrix.transpose",F.g.cg);C("X.matrix.determinant",F.g.Bi);C("X.matrix.invert",F.g.aa);C("X.matrix.multiply",F.g.multiply);C("X.matrix.multiplyByVector",F.g.ga);C("X.matrix.multiplyByVec4",F.g.jh);
C("X.matrix.makePerspective",F.g.ye);C("X.matrix.makeFrustum",F.g.oj);C("X.matrix.makeOrtho",F.g.pj);C("X.matrix.makeLookAt",F.g.fh);C("X.matrix.translate",F.g.translate);C("X.matrix.scale",F.g.scale);C("X.matrix.rotate",F.g.rotate);C("X.matrix.rotateX",F.g.Ce);C("X.matrix.rotateY",F.g.De);C("X.matrix.rotateZ",F.g.Ee);C("X.matrix.swapRows",F.g.Ak);C("X.matrix.swapCols",F.g.zk);function fd(){J.call(this);this.f="transform";this.S=F.g.gd()}E(fd,J);fd.prototype.__defineGetter__("matrix",v("S"));fd.prototype.__defineSetter__("matrix",function(a){(a==t||!(a instanceof Float32Array))&&m(Error("Invalid matrix."));this.S=a;this.q()});w=fd.prototype;w.Ce=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));F.g.Ce(this.S,a*Math.PI/180);this.q()};w.De=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));F.g.De(this.S,a*Math.PI/180);this.q()};
w.Ee=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));F.g.Ee(this.S,a*Math.PI/180);this.q()};w.Mh=function(a){y(a)||m(Error("Invalid distance."));F.g.translate(this.S,a,0,0);this.q()};w.Nh=function(a){y(a)||m(Error("Invalid distance."));F.g.translate(this.S,0,a,0);this.q()};w.Oh=function(a){y(a)||m(Error("Invalid distance."));F.g.translate(this.S,0,0,a);this.q()};function gd(a,b,c){a.S[b+4*c]*=-1;a.q()}w.Ji=function(){gd(this,0,0)};w.Ki=function(){gd(this,1,1)};
w.Li=function(){gd(this,2,2)};w.q=function(){this.j=r};C("X.transform",fd);C("X.transform.prototype.rotateX",fd.prototype.Ce);C("X.transform.prototype.rotateY",fd.prototype.De);C("X.transform.prototype.rotateZ",fd.prototype.Ee);C("X.transform.prototype.translateX",fd.prototype.Mh);C("X.transform.prototype.translateY",fd.prototype.Nh);C("X.transform.prototype.translateZ",fd.prototype.Oh);C("X.transform.prototype.flipX",fd.prototype.Ji);C("X.transform.prototype.flipY",fd.prototype.Ki);
C("X.transform.prototype.flipZ",fd.prototype.Li);C("X.transform.prototype.modified",fd.prototype.q);function hd(){J.call(this);this.f="texture";this.bc=this.Ra=this.s=t;this.af=this.bf=0;this.og=u;Fa(this,new yc)}E(hd,J);hd.prototype.__defineSetter__("rawData",function(a){this.bc=a;this.j=r});hd.prototype.__defineSetter__("rawDataHeight",function(a){this.af=a;this.j=r});hd.prototype.__defineSetter__("rawDataWidth",function(a){this.bf=a;this.j=r});hd.prototype.__defineSetter__("grayscale",function(a){this.og=a;this.j=r});C("X.texture",hd);function T(a,b){J.call(this);this.f="triplets";this.ob=Infinity;this.lb=-Infinity;this.pb=Infinity;this.mb=-Infinity;this.qb=Infinity;this.nb=-Infinity;this.Ud=[0,0,0];this.ng=r;this.r=0;this.ha=new Float32Array(a);b!=t&&(this.ha=b.ha.subarray(0,b.ha.length),this.r=this.ha.length,this.ob=b.ob,this.lb=b.lb,this.pb=b.pb,this.mb=b.mb,this.qb=b.qb,this.nb=b.nb,this.Ud=b.Ud.slice(),this.ng=u)}E(T,J);w=T.prototype;
w.add=function(a,b,c){this.ob=Math.min(this.ob,a);this.lb=Math.max(this.lb,a);this.pb=Math.min(this.pb,b);this.mb=Math.max(this.mb,b);this.qb=Math.min(this.qb,c);this.nb=Math.max(this.nb,c);this.Ud=[(this.ob+this.lb)/2,(this.pb+this.mb)/2,(this.qb+this.nb)/2];this.ng=u;this.j=r;this.ha[this.r++]=a;this.ha[this.r++]=b;this.ha[this.r++]=c;return this.r/3};w.ab=function(){if(this.r!=this.ha.length){var a=new Float32Array(this.r);a.set(this.ha.subarray(0,this.r));this.ha=a}};
w.get=function(a){a*=3;return[this.ha[a],this.ha[a+1],this.ha[a+2]]};w.remove=function(){m(Error("Not implemented."))};w.clear=function(){this.ha=new Float32Array(this.ha.length);this.j=r};T.prototype.__defineGetter__("count",function(){this.ab();return this.ha.length/3});T.prototype.__defineGetter__("length",function(){this.ab();return this.ha.length});C("X.triplets",T);C("X.triplets.prototype.add",T.prototype.add);C("X.triplets.prototype.resize",T.prototype.ab);C("X.triplets.prototype.get",T.prototype.get);
C("X.triplets.prototype.remove",T.prototype.remove);C("X.triplets.prototype.clear",T.prototype.clear);function id(){this.Ia=jd;this.ka=new fd;this.B=[1,1,1];this.tc=this.I=this.ra=this.n=this.h=t;this.Uc=[];this.P=r;this.Nc=this.vd=1;this.Fc=t;this.rd=u;this.Aa=1;this.za=0;this.ud=r}var jd="TRIANGLES";id.prototype.__defineSetter__("type",function(a){return this.Ia=a});id.prototype.__defineGetter__("type",v("Ia"));id.prototype.__defineGetter__("texture",function(){this.I||(this.I=new hd);return this.I});id.prototype.__defineGetter__("transform",v("ka"));id.prototype.__defineGetter__("points",v("h"));
id.prototype.__defineSetter__("points",ba("h"));id.prototype.__defineGetter__("normals",v("n"));id.prototype.__defineSetter__("normals",ba("n"));id.prototype.__defineGetter__("colors",v("ra"));id.prototype.__defineSetter__("colors",ba("ra"));id.prototype.__defineGetter__("color",v("B"));id.prototype.__defineSetter__("color",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid color."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].color=a;this.B=a;this.j=r});
id.prototype.__defineGetter__("opacity",v("Aa"));id.prototype.__defineSetter__("opacity",function(a){(!y(a)||1<a||0>a)&&m(Error("Invalid opacity."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=t&&(b[e].opacity=a);this.Aa=a;this.j=r});id.prototype.__defineGetter__("caption",v("Fc"));id.prototype.__defineSetter__("caption",function(a){this.Fc=a;this.j=r});id.prototype.__defineGetter__("visible",v("P"));
id.prototype.__defineSetter__("visible",function(a){for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=t&&(b[e].visible=a);this.P=a;this.j=r});id.prototype.__defineGetter__("pointsize",v("vd"));id.prototype.__defineSetter__("pointsize",function(a){y(a)||m(Error("Invalid point size."));this.vd=a;this.j=r});id.prototype.__defineGetter__("magicmode",v("rd"));id.prototype.__defineSetter__("magicmode",function(a){"boolean"!=typeof a&&m(Error("Invalid magic mode setting."));this.rd=a;this.j=r});
id.prototype.__defineGetter__("linewidth",v("Nc"));id.prototype.__defineSetter__("linewidth",function(a){y(a)||m(Error("Invalid line width."));this.Nc=a;this.j=r});id.prototype.__defineGetter__("pickable",v("ud"));id.prototype.__defineSetter__("pickable",function(a){"boolean"!=typeof a&&m(Error("Invalid pickable setting."));this.ud=a;this.j=r});id.prototype.__defineGetter__("textureCoordinateMap",v("tc"));id.prototype.__defineSetter__("textureCoordinateMap",ba("Gl"));function kd(){this.pa=Infinity;this.R=this.fa=-Infinity;this.T=Infinity;this.Yb=[0,0,0];this.Wb=[1,1,1]}kd.prototype.__defineGetter__("lowerThreshold",v("R"));kd.prototype.__defineSetter__("lowerThreshold",ba("R"));kd.prototype.__defineGetter__("upperThreshold",v("T"));kd.prototype.__defineSetter__("upperThreshold",ba("T"));kd.prototype.__defineGetter__("min",v("pa"));kd.prototype.__defineGetter__("max",v("fa"));kd.prototype.__defineGetter__("minColor",v("Yb"));
kd.prototype.__defineSetter__("minColor",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid min. color."));this.Yb=a});kd.prototype.__defineGetter__("maxColor",v("Wb"));kd.prototype.__defineSetter__("maxColor",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid max. color."));this.Wb=a});function ld(){J.call(this);this.f="scalars";this.md=this.K=t;this.Bg=r;this.Re=0;Fa(this,new yc);Fa(this,new kd);this.Yb=[0,1,0];this.Wb=[1,0,0]}E(ld,J);ld.prototype.__defineGetter__("array",v("K"));ld.prototype.__defineSetter__("array",function(a){this.md=this.K=a;this.j=r});ld.prototype.__defineGetter__("interpolation",v("Re"));ld.prototype.__defineSetter__("interpolation",ba("Re"));C("X.scalars",ld);function W(a){J.call(this);this.f="object";this.c=[];this.H=this.ya=t;Fa(this,new id);a!=t&&this.xc(a)}E(W,J);
W.prototype.xc=function(a){this.Ia=a.Ia;this.ka=new fd;this.ka.S=new Float32Array(a.ka.S);this.B=a.B.slice();a.h&&(this.h=new T(a.h.length,a.h));a.n&&(this.n=new T(a.n.length,a.n));a.ra&&(this.ra=new T(a.ra.length,a.ra));this.I=a.I;this.tc=a.tc;a.s&&(this.s=new xc((new String(a.s.td)).toString()));this.Aa=a.Aa;this.c.length=0;var b=a.c;if(b)for(var c=b.length,e=0,e=0;e<c;e++)this.c.push(new F[b[e].f](b[e]));this.P=a.P;this.vd=a.vd;this.Nc=a.Nc;a.Fc&&(this.Fc=(new String(a.Fc)).toString());this.rd=
a.rd;this.ud=a.ud;this.Uc=a.Uc.slice();this.j=r};W.prototype.__defineGetter__("colortable",function(){this.ya||(this.ya=new Ec);return this.ya});W.prototype.__defineGetter__("scalars",function(){this.H||(this.H=new ld);return this.H});W.prototype.__defineGetter__("children",v("c"));W.prototype.q=function(){var a=new md;a.F=this;this.dispatchEvent(a)};W.prototype.remove=function(){var a=new nd;a.F=this;this.dispatchEvent(a)};
W.prototype.Wa=function(){ec(this);if(0<this.c.length)for(var a=this.c,b=a.length,c=0,c=0;c<b;c++)"undefined"!=typeof a[c]&&this.c[c].Wa();this.c.length=0;this.H=this.ya=t};function od(a,b){(a==t||b==t||!(a instanceof W)||!(b instanceof W))&&m(Error("Fatal: Two valid X.objects are required for comparison."));return 1==a.Aa?-1:1==b.Aa?1:a.za!=t&&b.za!=t&&a.za>b.za?-1:1}C("X.object",W);C("X.object.prototype.modified",W.prototype.q);C("X.object.prototype.remove",W.prototype.remove);
C("X.object.prototype.destroy",W.prototype.Wa);function pd(){}function qd(a){for(var b=a.h.count,c=[],e=0,e=0;e<b;e+=3){var d=a.h.get(e),f=a.h.get(e+1),g=a.h.get(e+2),h=a.n.get(e),l=a.n.get(e+1),j=a.n.get(e+2),k=a.B;a.ra&&0<a.ra.length&&(k=a.ra.get(e));var n=[];n.push(new lc(d,h));n.push(new lc(f,l));n.push(new lc(g,j));c.push(new nc(n,k))}return vc(c)}
function rd(a,b){(b==t||!(b instanceof uc))&&m(Error("Invalid CSG object."));var c=new wc,e=[];Lb(b.ba,function(a){var b=[],g=a.He,b=Lb(a.Pb,function(a){a.color=g;return c.add(a)});for(a=a=2;a<b.length;a++)e.push([b[0],b[a-1],b[a]])}.bind(a));a.ci=Lb(c.unique(),function(a){return[a.$a.x(),a.$a.y(),a.$a.d()]});a.bi=Lb(c.unique(),function(a){return[a.va.x(),a.va.y(),a.va.d()]});a.ai=Lb(c.unique(),function(a){return!a.color?t:[a.color[0],a.color[1],a.color[2]]});a.h=new T(9*e.length);a.n=new T(9*e.length);
a.ra=new T(9*e.length);Lb(e,function(a){var b=a[0],c=a[1];a=a[2];var e=this.ci,l=this.bi,j=this.ai;this.h.add(e[b][0],e[b][1],e[b][2]);this.h.add(e[c][0],e[c][1],e[c][2]);this.h.add(e[a][0],e[a][1],e[a][2]);this.n.add(l[b][0],l[b][1],l[b][2]);this.n.add(l[c][0],l[c][1],l[c][2]);this.n.add(l[a][0],l[a][1],l[a][2]);j[b]&&this.ra.add(j[b][0],j[b][1],j[b][2]);j[c]&&this.ra.add(j[c][0],j[c][1],j[c][2]);j[a]&&this.ra.add(j[a][0],j[a][1],j[a][2])}.bind(a));0==a.ra.r&&(a.ra=t);a.Ia=jd}
pd.prototype.dg=function(a){(a==t||!(a instanceof uc)&&!(a instanceof W))&&m(Error("Invalid object."));var b=a;a instanceof W&&(b=qd(b));a=new W;Fa(a,new pd);rd(a,qd(this).dg(b));return a};pd.prototype.wa=function(a){(a==t||!(a instanceof uc)&&!(a instanceof W))&&m(Error("Invalid object."));var b=a;a instanceof W&&(b=qd(b));a=new W;Fa(a,new pd);rd(a,qd(this).wa(b));return a};
pd.prototype.Af=function(a){(a==t||!(a instanceof uc)&&!(a instanceof W))&&m(Error("Invalid object."));var b=a;a instanceof W&&(b=qd(b));a=new W;Fa(a,new pd);rd(a,qd(this).Af(b));return a};pd.prototype.inverse=function(){var a=new W;Fa(a,new pd);rd(a,qd(this).inverse());return a};C("X.constructable",pd);C("X.constructable.prototype.intersect",pd.prototype.Af);C("X.constructable.prototype.inverse",pd.prototype.inverse);C("X.constructable.prototype.subtract",pd.prototype.wa);
C("X.constructable.prototype.union",pd.prototype.dg);F.debug={};var sd=0,td;function ud(a){if(sd){if(td==p||td.closed){td=0;var b=window.open("","myDebugWin","left=0, top=0, width=500, height=600, titlebar=yes,  scrollbars=yes,status=yes, resizable=yes");b.document.open();b.document.write("<html><head><title>myDebugWin</title></head><body><pre>\n");td=b}(b=td)&&!b.closed&&b.document.write(a+"\n")}};function vd(a){Sb.call(this,a);this.f="event"}E(vd,Sb);var wd=jc("pan"),xd=jc("rotate"),yd=jc("zoom"),zd=jc("scroll");jc("render");var Ad=jc("resetview"),Bd=jc("windowlevel"),Cd=jc("modified"),Dd=jc("remove"),Ed=jc("progress"),Fd=jc("hover"),Gd=jc("hover_end"),Hd=jc("computing"),Id=jc("computing_end"),Jd=jc("computing_progress");function Kd(){vd.call(this,Bd);this.We=this.hf=0}E(Kd,vd);function Ld(){vd.call(this,wd);this.za=new F.m(0,0,0)}E(Ld,vd);
function Md(){vd.call(this,xd);this.za=new F.m(0,0,0)}E(Md,vd);function Nd(){vd.call(this,yd);ud("in ZoomEvent");this.kb=this.xb=u}E(Nd,vd);function Od(){vd.call(this,zd);this.X=u}E(Od,vd);function Pd(){vd.call(this,Fd);this.je=this.ie=0}E(Pd,vd);function Qd(){vd.call(this,Gd)}E(Qd,vd);function Rd(){vd.call(this,Ad)}E(Rd,vd);function md(){vd.call(this,Cd);this.v=this.F=t}E(md,vd);function nd(){vd.call(this,Dd);this.v=this.F=t}E(nd,vd);function Sd(){vd.call(this,Ed);this.Dd=0}E(Sd,vd);
function Td(){vd.call(this,Hd);this.F=t}E(Td,vd);function Ud(){vd.call(this,Jd);this.Dd=0}E(Ud,vd);function Vd(){vd.call(this,Id);this.F=t}E(Vd,vd);C("X.event.events.PAN",wd);C("X.event.events.ROTATE",xd);C("X.event.events.ZOOM",yd);C("X.event.events.SCROLL",zd);function Wd(a,b,c){a==t&&m(Error("Invalid GL Buffer."));b==t&&m(Error("Invalid number of items."));c==t&&m(Error("Invalid item size."));J.call(this);this.f="buffer";this.Q=a;this.nd=b;this.Vb=c}E(Wd,J);var Xd;function Yd(a,b){var c;c=a.className;c=la(c)&&c.match(/\S+/g)||[];for(var e=Ob(arguments,1),d=c.length+e.length,f=c,g=0;g<e.length;g++)0<=Jb(f,e[g])||f.push(e[g]);a.className=c.join(" ");return c.length==d};function Zd(a,b){this.width=a;this.height=b}w=Zd.prototype;w.l=function(){return new Zd(this.width,this.height)};w.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};w.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};w.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};w.scale=function(a,b){var c=y(b)?b:a;this.width*=a;this.height*=c;return this};var $d=!jb||jb&&9<=Fb;!kb&&!jb||jb&&jb&&9<=Fb||kb&&Db("1.9.1");jb&&Db("9");function ae(a,b){this.x=ia(a)?a:0;this.y=ia(b)?b:0}w=ae.prototype;w.l=function(){return new ae(this.x,this.y)};function be(a,b){return new ae(a.x-b.x,a.y-b.y)}w.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};w.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};w.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};
w.translate=function(a,b){a instanceof ae?(this.x+=a.x,this.y+=a.y):(this.x+=a,y(b)&&(this.y+=b));return this};w.scale=function(a,b){var c=y(b)?b:a;this.x*=a;this.y*=c;return this};function ce(a){return a?new de(ee(a)):Xd||(Xd=new de)}function fe(a){return la(a)?document.getElementById(a):a}var ge={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function he(a,b,c){return ie(document,arguments)}
function ie(a,b){var c=b[0],e=b[1];if(!$d&&e&&(e.name||e.type)){c=["<",c];e.name&&c.push(' name="',Ra(e.name),'"');if(e.type){c.push(' type="',Ra(e.type),'"');var d={};Qa(d,e);delete d.type;e=d}c.push(">");c=c.join("")}var f=a.createElement(c);e&&(la(e)?f.className=e:ja(e)?Yd.apply(t,[f].concat(e)):Na(e,function(a,b){"style"==b?f.style.cssText=a:"class"==b?f.className=a:"for"==b?f.htmlFor=a:b in ge?f.setAttribute(ge[b],a):0==b.lastIndexOf("aria-",0)||0==b.lastIndexOf("data-",0)?f.setAttribute(b,a):
f[b]=a}));if(2<b.length){e=function(b){b&&f.appendChild(la(b)?a.createTextNode(b):b)};for(c=2;c<b.length;c++){var g=b[c];if(ka(g)&&!(pa(g)&&0<g.nodeType)){var d=Kb,h;a:{if((h=g)&&"number"==typeof h.length){if(pa(h)){h="function"==typeof h.item||"string"==typeof h.item;break a}if(oa(h)){h="function"==typeof h.item;break a}}h=u}if(h)if(h=g.length,0<h){for(var l=Array(h),j=0;j<h;j++)l[j]=g[j];g=l}else g=[];d(g,e)}else e(g)}}return f}function je(a){return"CSS1Compat"==a.compatMode}
function ke(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function le(a){for(;a&&1!=a.nodeType;)a=a.nextSibling;return a}function me(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function ee(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function de(a){this.la=a||ea.document||document}w=de.prototype;w.qe=ce;
w.u=function(a){return la(a)?this.la.getElementById(a):a};w.Uh=de.prototype.u;w.cd=function(a,b,c){return ie(this.la,arguments)};w.createElement=function(a){return this.la.createElement(a)};w.createTextNode=function(a){return this.la.createTextNode(String(a))};function ne(a){return je(a.la)}
function oe(a){var b=a.la;a=!lb&&je(b)?b.documentElement:b.body;b=b.parentWindow||b.defaultView;return jb&&Db("10")&&b.pageYOffset!=a.scrollTop?new ae(a.scrollLeft,a.scrollTop):new ae(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}w.appendChild=function(a,b){a.appendChild(b)};w.contains=me;function pe(a,b,c,e){this.top=a;this.right=b;this.bottom=c;this.left=e}w=pe.prototype;w.l=function(){return new pe(this.top,this.right,this.bottom,this.left)};w.contains=function(a){return!this||!a?u:a instanceof pe?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom};
w.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};w.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};w.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};
w.translate=function(a,b){a instanceof ae?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,y(b)&&(this.top+=b,this.bottom+=b));return this};w.scale=function(a,b){var c=y(b)?b:a;this.left*=a;this.right*=a;this.top*=c;this.bottom*=c;return this};function qe(a,b,c,e){this.left=a;this.top=b;this.width=c;this.height=e}w=qe.prototype;w.l=function(){return new qe(this.left,this.top,this.width,this.height)};w.ah=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var e=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(e<=a)return this.left=b,this.top=e,this.width=c-b,this.height=a-e,r}return u};
w.contains=function(a){return a instanceof qe?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};function re(a,b){var c=b.x<a.left?a.left-b.x:Math.max(b.x-(a.left+a.width),0),e=b.y<a.top?a.top-b.y:Math.max(b.y-(a.top+a.height),0);return c*c+e*e}w.wf=function(a){return Math.sqrt(re(this,a))};
w.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};w.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};w.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};
w.translate=function(a,b){a instanceof ae?(this.left+=a.x,this.top+=a.y):(this.left+=a,y(b)&&(this.top+=b));return this};w.scale=function(a,b){var c=y(b)?b:a;this.left*=a;this.width*=a;this.top*=c;this.height*=c;return this};function se(a,b){var c=ee(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,t))?c[b]||c.getPropertyValue(b)||"":""}function te(a,b){return se(a,b)||(a.currentStyle?a.currentStyle[b]:t)||a.style&&a.style[b]}function ue(a){a=a?ee(a):document;return jb&&!(jb&&9<=Fb)&&!ne(ce(a))?a.body:a.documentElement}
function ve(a){var b=a.getBoundingClientRect();jb&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function we(a){if(jb&&!(jb&&8<=Fb))return a.offsetParent;var b=ee(a),c=te(a,"position"),e="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=te(a,"position"),e=e&&"static"==c&&a!=b.documentElement&&a!=b.body,!e&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return t}
function xe(a){for(var b=new pe(0,Infinity,Infinity,0),c=ce(a),e=c.la.body,d=c.la.documentElement,f=!lb&&je(c.la)?c.la.documentElement:c.la.body;a=we(a);)if((!jb||0!=a.clientWidth)&&(!lb||0!=a.clientHeight||a!=e)&&a!=e&&a!=d&&"visible"!=te(a,"overflow")){var g=ye(a),h;h=a;if(kb&&!Db("1.9")){var l=parseFloat(se(h,"borderLeftWidth"));if(ze(h))var j=h.offsetWidth-h.clientWidth-l-parseFloat(se(h,"borderRightWidth")),l=l+j;h=new ae(l,parseFloat(se(h,"borderTopWidth")))}else h=new ae(h.clientLeft,h.clientTop);
g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}e=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,e);b.top=Math.max(b.top,f);c=(c.la.parentWindow||c.la.defaultView||window).document;c=je(c)?c.documentElement:c.body;c=new Zd(c.clientWidth,c.clientHeight);b.right=Math.min(b.right,e+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?
b:t}
function ye(a){var b,c=ee(a),e=te(a,"position"),d=kb&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==e&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new ae(0,0),g=ue(c);if(a==g)return f;if(a.getBoundingClientRect)b=ve(a),a=oe(ce(c)),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!d)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);
if(lb&&"fixed"==te(b,"position")){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(ib||lb&&"absolute"==e)f.y-=c.body.offsetTop;for(b=a;(b=we(b))&&b!=c.body&&b!=g;)if(f.x-=b.scrollLeft,!ib||"TR"!=b.tagName)f.y-=b.scrollTop}return f}
function Ae(a){var b=new ae;if(1==a.nodeType){if(a.getBoundingClientRect){var c=ve(a);b.x=c.left;b.y=c.top}else{var c=oe(ce(a)),e=ye(a);b.x=e.x-c.x;b.y=e.y-c.y}if(kb&&!Db(12)){var d;jb?d="-ms-transform":lb?d="-webkit-transform":ib?d="-o-transform":kb&&(d="-moz-transform");var f;d&&(f=te(a,d));f||(f=te(a,"transform"));f?(a=f.match(Be),a=!a?new ae(0,0):new ae(parseFloat(a[1]),parseFloat(a[2]))):a=new ae(0,0);b=new ae(b.x+a.x,b.y+a.y)}}else d=oa(a.Oi),f=a,a.targetTouches?f=a.targetTouches[0]:d&&a.ub.targetTouches&&
(f=a.ub.targetTouches[0]),b.x=f.clientX,b.y=f.clientY;return b}function Ce(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}function De(a){if("none"!=te(a,"display"))return Ee(a);var b=a.style,c=b.display,e=b.visibility,d=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";a=Ee(a);b.display=c;b.position=d;b.visibility=e;return a}
function Ee(a){var b=a.offsetWidth,c=a.offsetHeight,e=lb&&!b&&!c;return(!ia(b)||e)&&a.getBoundingClientRect?(a=ve(a),new Zd(a.right-a.left,a.bottom-a.top)):new Zd(b,c)}function Fe(a,b){a.style.display=b?"":"none"}function ze(a){return"rtl"==te(a,"direction")}function Ge(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var d=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=e;return d}
function He(a,b){var c=a.currentStyle?a.currentStyle[b]:t;return c?Ge(a,c):0}var Ie={thin:2,medium:4,thick:6};function Je(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:t))return 0;var c=a.currentStyle?a.currentStyle[b+"Width"]:t;return c in Ie?Ie[c]:Ge(a,c)}var Be=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;function Ke(a,b){kc.call(this);this.J=a;var c=pa(this.J)&&1==this.J.nodeType?this.J:this.J?this.J.body:t;this.ij=!!c&&ze(c);this.Yl=I(this.J,kb?"DOMMouseScroll":"mousewheel",this,b)}E(Ke,kc);
Ke.prototype.handleEvent=function(a){var b=0,c=0,e=0;a=a.ub;if("mousewheel"==a.type){c=1;if(jb||lb&&(bb||Db("532.0")))c=40;e=Le(-a.wheelDelta,c);ia(a.wheelDeltaX)?(b=Le(-a.wheelDeltaX,c),c=Le(-a.wheelDeltaY,c)):c=e}else e=a.detail,100<e?e=3:-100>e&&(e=-3),ia(a.axis)&&a.axis===a.HORIZONTAL_AXIS?b=e:c=e;y(this.gh)&&(b=Math.min(Math.max(b,-this.gh),this.gh));y(this.hh)&&(c=Math.min(Math.max(c,-this.hh),this.hh));this.ij&&(b=-b);b=new Me(e,a,b,c);this.dispatchEvent(b)};
function Le(a,b){return lb&&(ab||cb)&&0!=a%b?a:a/b}function Me(a,b,c,e){b&&this.Da(b,p);this.type="mousewheel";this.detail=a;this.Nl=c;this.ed=e}E(Me,Ub);jb||lb&&Db("525");function Ne(a){J.call(this);this.f="interactor";this.Qa=a;this.Xe=this.vg=this.ug=this.wg=this.tg=this.xg=t;this.ae=r;this.cc=this.Xb=this.yb=u;this.ua=[0,0];this.Se=new F.m(0,0,0);this.pd=new F.m(0,0,0);this.dh=0;this.Eg=this.Zd=t;this.Dg=u;this.U={MOUSEWHEEL_ENABLED:r,MOUSECLICKS_ENABLED:r,KEYBOARD_ENABLED:r,HOVERING_ENABLED:r,CONTEXTMENU_ENABLED:u,TOUCH_ENABLED:r,TOUCH_BOUNCING_ENABLED:u}}E(Ne,J);Ne.prototype.__defineGetter__("config",v("U"));Ne.prototype.__defineGetter__("leftButtonDown",v("yb"));
Ne.prototype.__defineGetter__("middleButtonDown",v("Xb"));Ne.prototype.__defineGetter__("rightButtonDown",v("cc"));
Ne.prototype.Da=function(){this.U.MOUSEWHEEL_ENABLED?(this.Xe=new Ke(this.Qa),this.xg=I(this.Xe,"mousewheel",this.Nd.bind(this))):(cc(this.xg),this.Xe=t);this.U.MOUSECLICKS_ENABLED?(this.tg=I(this.Qa,"mousedown",this.Gj.bind(this)),this.wg=I(this.Qa,"mouseup",this.Lj.bind(this))):(cc(this.tg),cc(this.wg));this.Qa.oncontextmenu=this.U.CONTEXTMENU_ENABLED?t:function(){return u};window.onkeydown=this.U.KEYBOARD_ENABLED?this.qh.bind(this):t;this.U.TOUCH_ENABLED?(this.U.TOUCH_BOUNCING_ENABLED||document.body.addEventListener("touchmove",
function(a){a.preventDefault()},u),this.ki=I(this.Qa,"touchstart",this.$j.bind(this)),this.ji=I(this.Qa,"touchmove",this.Yj.bind(this)),this.ii=I(this.Qa,"touchend",this.Uj.bind(this))):(cc(this.ki),cc(this.ji),cc(this.ii));cc(this.ug);cc(this.vg);this.ug=I(this.Qa,"mousemove",this.Ij.bind(this));this.vg=I(this.Qa,"mouseout",this.Jj.bind(this))};
Ne.prototype.Gj=function(a){0==a.button?this.yb=r:1==a.button?this.Xb=r:2==a.button&&(this.cc=r);eval("this.onMouseDown("+this.yb+","+this.Xb+","+this.cc+")");Oe(this);a.preventDefault()};Ne.prototype.Fj=aa();Ne.prototype.Lj=function(a){0==a.button?this.yb=u:1==a.button?this.Xb=u:2==a.button&&(this.cc=u);eval("this.onMouseUp("+this.yb+","+this.Xb+","+this.cc+")");Oe(this);a.preventDefault()};Ne.prototype.__defineGetter__("mousePosition",v("ua"));w=Ne.prototype;w.Kj=aa();
w.Jj=function(a){this.ae=u;this.U.KEYBOARD_ENABLED&&(window.onkeydown=t);this.cc=this.Xb=this.yb=u;Oe(this);this.Se=new F.m(0,0,0);a.preventDefault()};w.Hj=aa();w.$j=function(a){a.preventDefault();a.Da(a.ub.targetTouches[0],a.currentTarget);eval("this.onTouchStart("+a.clientX+","+a.clientY+")");this.pd=new F.m(a.clientX,a.clientY,0);this.Eg=setTimeout(this.Wj.bind(this,a),500)};w.Zj=aa();
w.Wj=function(a){eval("this.onTouchHover("+a.clientX+","+a.clientY+")");a=new Nd;a.xb=r;a.kb=this instanceof Pe;this.dispatchEvent(a);this.ee=r};w.Vj=aa();function Qe(a){clearTimeout(a.Eg);if(a.ee){var b=new Nd;b.xb=u;b.kb=a instanceof Pe;a.dispatchEvent(b)}a.ee=u}w.Uj=function(a){a.preventDefault();eval("this.onTouchEnd()");Qe(this)};w.Tj=aa();
w.Yj=function(a){a.preventDefault();this.ee||Qe(this);this.touchmoveEvent=a=a.ub;eval("this.onTouchMove(this['touchmoveEvent'])");var b=a.targetTouches;if(1==b.length){a=b[0];var c=[a.clientX,a.clientY];a=new F.m(c[0],c[1],0);var b=c[0]>3*this.Qa.clientWidth/4,e=c[0]<this.Qa.clientWidth/4,d=c[1]<this.Qa.clientHeight/4,c=c[1]>3*this.Qa.clientHeight/4,c=!b&&!e&&!d&&!c,d=this.pd.wa(a);this.pd=a.l();if(this.ee)a=new Ld,5<d.x?d.x=1:-5>d.x&&(d.x=-1),5<d.y?d.y=1:-5>d.y&&(d.y=-1),a.za=d,this.dispatchEvent(a);
else if(this instanceof Re&&(b||e))a=new Od,a.X=0>d.y,this.dispatchEvent(a);else if(this instanceof Pe||c)d.scale(3),a=new Md,a.za=d,this.dispatchEvent(a)}else 2==b.length&&(a=b[0],b=b[1],a=[a.clientX,a.clientY],b=[b.clientX,b.clientY],a=new F.m(a[0],a[1],0),b=new F.m(b[0],b[1],0),d=Hc(a,b),b=d-this.dh,this.dh=d,this.pd.wa(a),this.pd=a.l(),10<Math.abs(b)&&(a=new Nd,a.xb=0<b,a.kb=this instanceof Pe,this.dispatchEvent(a)))};w.Xj=aa();
w.Ij=function(a){this.mousemoveEvent=a;eval("this.onMouseMove(this['mousemoveEvent'])");this.ae=r;this.U.KEYBOARD_ENABLED&&window.onkeydown==t&&(window.onkeydown=this.qh.bind(this));a.preventDefault();var b=a.shiftKey;this.Dg=b;this.ua=[a.offsetX,a.offsetY];var c=new F.m(this.ua[0],this.ua[1],0);a=this.Se.wa(c);this.Se=c.l();this.U.HOVERING_ENABLED&&((0<Math.abs(a.x)||0<Math.abs(a.y)||this.Xb||this.yb||this.cc)&&Oe(this),this.Zd=setTimeout(function(){Oe(this);var a=new Pd;a.ie=c.x;a.je=c.y;this.dispatchEvent(a);
this.Zd=t}.bind(this),300));0!=a.Mb()&&(this.yb&&!b?(b=new Md,a.scale(3),b.za=a,this.dispatchEvent(b)):this.Xb||this.yb&&b?(b=new Ld,b.za=a,this.dispatchEvent(b)):this.cc&&(b=new Nd,b.xb=0<a.y,b.kb=u,this.dispatchEvent(b)))};function Oe(a){a.Zd&&clearTimeout(a.Zd);a.dispatchEvent(new Qd)}w.Mj=aa();w.Nd=function(a){this.mouseWheelEvent=a;eval("this.onMouseWheel(this['mouseWheelEvent'])");Oe(this);a.preventDefault()};w.Dj=aa();
w.qh=function(a){if(this.ae){this.keyEvent=a;eval("this.onKey(this['keyEvent'])");Oe(this);var b=a.altKey,c=a.ctrlKey,e=a.metaKey,d=a.shiftKey,f=a.keyCode;82==f&&!b&&!c&&!e&&!d?(a.preventDefault(),a=new Rd,this.dispatchEvent(a)):37<=f&&40>=f&&(a.preventDefault(),d?a=new Ld:b?a=new Nd:(a=new Md,this instanceof Re&&(a=new Od)),a&&(c=new F.m(0,0,0),37==f?(c.x=5,a.X=u,b&&(a.X=r,a.xb=r,a.kb=u)):39==f?(c.x=-5,a.X=r,b&&(a.xb=u,a.kb=u)):38==f?(c.y=5,a.X=r,b&&(a.xb=r,a.kb=r)):40==f&&(c.y=-5,a.X=u,b&&(a.xb=
u,a.kb=r)),a.za=c,this.dispatchEvent(a)))}};C("X.interactor",Ne);C("X.interactor.prototype.init",Ne.prototype.Da);C("X.interactor.prototype.onMouseDown",Ne.prototype.Fj);C("X.interactor.prototype.onMouseUp",Ne.prototype.Kj);C("X.interactor.prototype.onMouseMove",Ne.prototype.Hj);C("X.interactor.prototype.onMouseWheel",Ne.prototype.Mj);C("X.interactor.prototype.onKey",Ne.prototype.Dj);C("X.interactor.prototype.onTouchStart",Ne.prototype.Zj);C("X.interactor.prototype.onTouchMove",Ne.prototype.Xj);
C("X.interactor.prototype.onTouchEnd",Ne.prototype.Tj);C("X.interactor.prototype.onTouchHover",Ne.prototype.Vj);function Re(a){Ne.call(this,a);this.f="interactor2D"}E(Re,Ne);Re.prototype.Nd=function(a){Re.w.Nd.call(this,a);var b=new Od;a.ed==t&&(a.ed=0);b.X=0>a.ed;this.dispatchEvent(b)};function Se(a,b){(!y(a)||!y(b))&&m(Error("A camera needs valid width and height values."));J.call(this);this.f="camera";this.oc=new F.m(0,100,0);this.Hc=new F.m(0,0,0);this.X=new F.m(0,0,1);this.L=a;this.D=b;this.o=this.xe(this.oc,this.Hc)}E(Se,J);Se.prototype.observe=function(a){(a==t||!(a instanceof Ne))&&m(Error("Could not observe the interactor."));I(a,xd,this.Qj.bind(this));I(a,wd,this.Nj.bind(this));I(a,yd,this.ck.bind(this))};
Se.prototype.Qj=function(a){a instanceof Md||m(Error("Received no valid rotate event."));this.rotate(a.za)};Se.prototype.ck=function(a){a instanceof Nd||m(Error("Received no valid zoom event."));a.xb?this.gg(a.kb):this.hg(a.kb)};Se.prototype.Nj=function(a){a instanceof Ld||m(Error("Received no valid pan event."));this.Rf(a.za)};Se.prototype.__defineGetter__("view",v("o"));
Se.prototype.__defineSetter__("view",function(a){(a==t||!(a instanceof Float32Array))&&m(Error("Invalid view matrix."));this.o=a});Se.prototype.__defineGetter__("position",function(){return[this.oc.x,this.oc.y,this.oc.d]});Se.prototype.__defineSetter__("position",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid position."));this.oc=new F.m(a[0],a[1],a[2]);this.reset()});Se.prototype.__defineGetter__("focus",function(){return[this.Hc.x,this.Hc.y,this.Hc.d]});
Se.prototype.__defineSetter__("focus",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid focus"));this.Hc=new F.m(a[0],a[1],a[2]);this.reset()});Se.prototype.__defineGetter__("up",function(){return[this.X.x,this.X.y,this.X.d]});Se.prototype.__defineSetter__("up",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid up vector."));this.X=new F.m(a[0],a[1],a[2]);this.reset()});w=Se.prototype;w.reset=function(){this.o=this.xe(this.oc,this.Hc)};
w.rotate=function(a){ja(a)&&2==a.length?a=new F.m(a[0],a[1],0):a instanceof F.m||m(Error("Invalid distance vector for rotate operation."));return a};w.Rf=function(a){ja(a)&&2==a.length?a=new F.m(a[0],a[1],0):a instanceof F.m||m(Error("Invalid distance vector for pan operation."));this.o[12]-=a.x;this.o[13]+=a.y};w.gg=function(a){var b=20;a!=t&&!a&&(b=1);this.o[14]+=b};w.hg=function(a){var b=20;a!=t&&!a&&(b=1);this.o[14]-=b};
w.xe=function(a,b){(!(a instanceof F.m)||!(b instanceof F.m))&&m(Error("3D vectors required for calculating the view."));return F.g.gd()};C("X.camera",Se);C("X.camera.prototype.pan",Se.prototype.Rf);C("X.camera.prototype.rotate",Se.prototype.rotate);C("X.camera.prototype.zoomIn",Se.prototype.gg);C("X.camera.prototype.zoomOut",Se.prototype.hg);function Te(a,b){Se.call(this,a,b);this.f="camera3D";this.Qe=45;this.ce=F.g.ye(F.g.gd(),this.Qe,a/b,1,1E4)}E(Te,Se);Te.prototype.rotate=function(a){a=Te.w.rotate.call(this,a);var b=-a.x/5*Math.PI/180;a=-a.y/5*Math.PI/180;var c=new F.m(this.o[1],this.o[5],this.o[9]),e=new F.m(this.o[0],this.o[4],this.o[8]);c.normalize();e.normalize();F.g.rotate(this.o,b,c.x,c.y,c.d);F.g.rotate(this.o,a,e.x,e.y,e.d)};Te.prototype.xe=function(a,b){var c=Te.w.xe.call(this,a,b);F.g.fh(c,a,b,this.X);return c};
function Ue(a,b,c,e){var d=new Float32Array(4),f=new Float32Array(4),g=new Float32Array(16),h=new Float32Array(16);new Float32Array(16);F.g.multiply(a.ce,a.o,h);F.g.aa(h,g);d[0]=b;d[1]=c;d[2]=2*e-1;d[3]=1;F.g.jh(g,d,f);f[3]=1/f[3];f[0]*=f[3];f[1]*=f[3];f[2]*=f[3];return f}Te.prototype.clip=function(a,b,c){this.ce=F.g.ye(F.g.gd(),this.Qe,a/b,c,1E4)};C("X.camera3D",Te);C("X.camera3D.prototype.clip",Te.prototype.clip);function Y(){J.call(this);this.f="parser";this.z=t;this.r=0;this.gi=0<(new Int8Array((new Int16Array([1])).buffer))[0];this.nc=r;this.El=-Infinity;this.Dl=Infinity}E(Y,J);Y.prototype.parse=function(){m(Error("The function parse() should be overloaded."))};function Ve(a){for(var b=Infinity,c=-Infinity,e=a.length,d=0,d=0;d<e;d++)if(!isNaN(a[d]))var f=a[d],b=Math.min(b,f),c=Math.max(c,f);return[b,c]}
function We(a,b,c){b===p&&(b=0);c===p&&(c=a.length);for(var e="",d=0,d=b;d<c;++d)e+=String.fromCharCode(a[d]);return e}
function Z(a,b,c){c!=t||(c=1);var e=1,d=Uint8Array;switch(b){case "schar":d=Int8Array;break;case "ushort":d=Uint16Array;e=2;break;case "sshort":d=Int16Array;e=2;break;case "uint":d=Uint32Array;e=4;break;case "sint":d=Int32Array;e=4;break;case "float":d=Float32Array;e=4;break;case "complex":d=Float64Array;e=8;break;case "double":d=Float64Array,e=8}b=new d(a.z.slice(a.r,a.r+=c*e));if(a.gi!=a.nc){a=b;b=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);for(d=0;d<a.byteLength;d+=e)for(var f=d+e-1,g=d;f>
g;f--,g++){var h=b[g];b[g]=b[f];b[f]=h}b=a}return 1==c?b[0]:b}
function Xe(a,b){var c=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE],e=Rc(0,0,0,1),d=Qc();cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,0,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,b[1]-
1,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,0,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,b[1]-1,0,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];
c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,0,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(0,b[1]-1,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Rc(b[0]-1,b[1]-1,b[2]-1,1);cd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:
c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];return c}
function Ye(a,b){var c=Tc();if(!(a.length==b.length&&a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2])){var e=Math.acos(a[2]),d=Nc(),f=a[0],g=a[1],h=a[2],l=b[0],j=b[1],k=b[2];d[0]=g*k-h*j;d[1]=h*l-f*k;d[2]=f*j-g*l;Pc(d,d);f=Math.cos(e/2);g=Math.sin(e/2)*d[0];h=Math.sin(e/2)*d[1];e=Math.sin(e/2)*d[2];Q(c,0,f*f+g*g-h*h-e*e,2*(g*h-f*e),2*(g*e+f*h),0);Q(c,1,2*(g*h+f*e),f*f+h*h-g*g-e*e,2*(h*e-f*g),0);Q(c,2,2*(g*e-f*h),2*(h*e+f*g),f*f+e*e-h*h-g*g,0)}e=Sc();ad(c,e);return[c,e]}
function Ze(a,b,c,e,d,f,g,h,l){var j=new $e;Pc(c,c);for(var k=[],n=[],s=0;6>s;s++)for(var q=Math.floor(s/2),x=(q+1)%3,z=(q+2)%3,B=(4+2*q)%6,A=0;2>A;A++){var G=(2+A+2*q)%6,D=-(c[q]*(d[s]-a[q])+c[x]*(d[G]-a[x]))/c[z]+a[z];if(D>=d[B]&&D<=d[B+1]||D<=d[B]&&D>=d[B+1]){var H=[];H[q]=d[s];H[x]=d[G];H[z]=D;k.push(H)}else H=[],H[q]=d[s],H[x]=d[G],H[z]=D,n.push(H)}a=Oc(0,0,1);a=Ye(c,a);d=a[0];a=a[1];q=[];for(n=0;n<k.length;++n)s=Rc(k[n][0],k[n][1],k[n][2],1),x=Qc(),cd(d,s,x),q.push([x[0],x[1],x[2]]);d=Oc(1,
0,0);k=Nc();bd(a,d,k);n=Oc(0,1,0);d=Nc();bd(a,n,d);s=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];for(n=n=0;n<q.length;++n)q[n][0]<s[0]&&(s[0]=q[n][0]),q[n][0]>s[1]&&(s[1]=q[n][0]),q[n][1]<s[2]&&(s[2]=q[n][1]),q[n][1]>s[3]&&(s[3]=q[n][1]),q[n][2]<s[4]&&(s[4]=q[n][2]),q[n][2]>s[5]&&(s[5]=q[n][2]);n=Rc(s[0]+(s[1]-s[0])/2,s[2]+(s[3]-s[2])/2,s[4]+(s[5]-s[4])/2,0);q=Qc();$c(a,n,q);x=Math.floor(s[0]);z=Math.ceil(s[1]);x==z&&z++;B=z-x;A=Math.floor(s[2]);
G=Math.ceil(s[3]);A==G&&G++;D=G-A;H=b[0];b=b[1];var n=Math.ceil(B/H),K=Math.ceil(D/b),N=new Uint8Array(4*n*K),R=new hd;R.bf=n;R.af=K;var K=Qc(),O=Rc(0,0,s[4],1),S=Sc();$c(g.jg,a,S);for(var da=G-1E-7,L=z-1E-7,ca=0,na=0,U=0,V=A,V=A;V<=da;V+=b){U++;na=0;O[1]=V;for(n=x;n<=L;n+=H){na++;O[0]=n;cd(S,O,K);var Ha=4*ca,wb=Math.floor(K[2]),xb=Math.floor(K[1]),yb=Math.floor(K[0]);if(0<=yb&&yb<g.da[0]&&0<=xb&&xb<g.da[1]&&0<=wb&&wb<g.da[2]){var mb=f[wb][xb][yb],dd=yb=xb=wb=0;l?((mb=l.get(mb))||(mb=[0,0.61,0,0,
1]),wb=255*mb[1],xb=255*mb[2],yb=255*mb[3],dd=255*mb[4]):(wb=xb=yb=255*((mb-g.pa)/(g.fa-g.pa)),dd=255);N[Ha]=wb;N[++Ha]=xb;N[++Ha]=yb;N[++Ha]=dd}else N[Ha]=0,N[++Ha]=0,N[++Ha]=0,N[++Ha]=0;ca++}}R.bc=N;j.I=R;j.mi=s;j.$h=a;j.Zh=S;j.fi=A;j.Bl=G;j.li=x;j.Hl=z;j.qg=na;j.pg=U;j.bd=H;j.L=B;j.Ic=b;j.D=D;j.C=[q[0],q[1],q[2]];j.lc=[c[0],c[1],c[2]];j.Vc=[k[0],k[1],k[2]];j.X=[d[0],d[1],d[2]];j.P=u;j.Ab=g;j.Eb=g.Ab!=t&&!h?u:r;j.jc=e;j.Bb();j.P=u;return j}
function af(a,b,c,e){var d;d=e.na;for(var f=[],g=[],h=0;6>h;h++){var l=Math.floor(h/2),j=(l+1)%3,k=(l+2)%3,n=(2+2*l)%6,s=(4+2*l)%6,q=(d[h]-b[l])*(1/c[l]);if(Infinity!=q&&-Infinity!=q){var x=b[j]+c[j]*q,q=b[k]+c[k]*q;x>=d[n]&&x<=d[n+1]&&q>=d[s]&&q<=d[s+1]?(n=[],n[l]=d[h],n[j]=x,n[k]=q,f.push(n)):(n=[],n[l]=d[h],n[j]=x,n[k]=q,g.push(n))}}d=[f,g];b=d[0];e.b[a].k=d;d=Gc(new P(b[0][0],b[0][1],b[0][2]),new P(b[1][0],b[1][1],b[1][2]));e.b[a].Al=d;f=Oc(0,0,1);g=Ye(c,f)[0];h=Rc(e.Ec[0],e.Ec[1],e.Ec[2],0);
f=Qc();cd(g,h,f);g=Qc();h=f[2];g[0]=c[0]*h;g[1]=c[1]*h;g[2]=c[2]*h;g[3]=c[3]*h;f[0]/=e.de;f[1]/=e.de;e.b[a].Ga=[Math.abs(f[0]),Math.abs(f[1])];e.b[a].Zc=f[2];e.b[a].G=g;d=Math.floor(Math.abs(d/f[2]));e.xd[a]=d+1;e.b[a].p=d+1;e.b[a].k[0][0][0]>e.b[a].k[0][1][0]?0<g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][0]<e.b[a].k[0][1][0]?0>g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]>e.b[a].k[0][1][1]?0<g[1]&&(d=e.b[a].k[0][0],
e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]<e.b[a].k[0][1][1]?0>g[1]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]>e.b[a].k[0][1][2]?0<g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]<e.b[a].k[0][1][2]&&0>g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d);e.b[a].Ze=-(c[0]*b[0][0]+c[1]*b[0][1]+c[2]*b[0][2])}
function bf(a,b){var c;c=b.z;for(var e=b.da,d=b.fa,f=b.pa,g=Array(e[2]),h=Array(e[2]),l=e[1]*e[0],j=0,k=0,n=0,s=0,q=0,s=0;s<e[2];s++){var x=c.subarray(s*l,(s+1)*l),q=0;h[s]=Array(e[1]);g[s]=Array(e[1]);for(n=0;n<e[1];n++){h[s][n]=new c.constructor(e[0]);g[s][n]=new c.constructor(e[0]);for(k=0;k<e[0];k++)j=x[q],h[s][n][k]=255*((j-f)/(d-f)),g[s][n][k]=j,q++}}c=[g,h];b.ca=c[0];b.ig=c[1];F.La(a.f+".reslice");b.M=b.e!=t;b.ya&&(b.ld=b.ya.Ma);b.gm=[0,0,0];b.t=[b.xa[0]+(b.fb[0]-1)/2,b.xa[1]+(b.fb[1]-1)/2,
b.xa[2]+(b.fb[2]-1)/2];b.na=[Math.min(b.xa[0],b.xa[0]+b.fb[0]-1),Math.max(b.xa[0],b.xa[0]+b.fb[0]-1),Math.min(b.xa[1],b.xa[1]+b.fb[1]-1),Math.max(b.xa[1],b.xa[1]+b.fb[1]-1),Math.min(b.xa[2],b.xa[2]+b.fb[2]-1),Math.max(b.xa[2],b.xa[2]+b.fb[2]-1)];b.b=[{},{},{}];c=Oc(b.t[0],b.t[1],b.t[2]);b.b[0].yd=c;e=Oc(1,0,0);Pc(e,e);b.b[0].i=e;d=[1,0,0];b.b[0].B=d;af(0,c,e,b);b.c[0].c=Array(b.b[0].p);c[0]=b.b[0].k[0][0][0]+b.b[0].G[0]*Math.floor(b.b[0].p/2);c[1]=b.b[0].k[0][0][1]+b.b[0].G[1]*Math.floor(b.b[0].p/
2);c[2]=b.b[0].k[0][0][2]+b.b[0].G[2]*Math.floor(b.b[0].p/2);c=Ze(c,b.b[0].Ga,b.b[0].i,b.b[0].B,b.na,b.ca,b,b.M,b.ld);b.M&&(c.e=b.e.c[0].c[Math.floor(b.b[0].p/2)].I);b.c[0].c[Math.floor(b.b[0].p/2)]=c;b.Fb=Math.floor(b.b[0].p/2);b.Jc=Math.floor(b.b[0].p/2);c=Oc(b.t[0],b.t[1],b.t[2]);b.b[1].yd=c;e=Oc(0,1,0);Pc(e,e);b.b[1].i=e;d=[0,1,0];b.b[1].B=d;af(1,c,e,b);b.c[1].c=Array(b.b[1].p);c[0]=b.b[1].k[0][0][0]+b.b[1].G[0]*Math.floor(b.b[1].p/2);c[1]=b.b[1].k[0][0][1]+b.b[1].G[1]*Math.floor(b.b[1].p/2);
c[2]=b.b[1].k[0][0][2]+b.b[1].G[2]*Math.floor(b.b[1].p/2);c=Ze(c,b.b[1].Ga,b.b[1].i,b.b[1].B,b.na,b.ca,b,b.M,b.ld);b.M&&(c.e=b.e.c[1].c[Math.floor(b.b[1].p/2)].I);b.c[1].c[Math.floor(b.b[1].p/2)]=c;b.Gb=Math.floor(b.b[1].p/2);b.Kc=Math.floor(b.b[1].p/2);c=Oc(b.t[0],b.t[1],b.t[2]);b.b[2].yd=c;e=Oc(0,0,1);Pc(e,e);b.b[2].i=e;d=[0,0.392,0.804];b.b[2].B=d;af(2,c,e,b);b.c[2].c=Array(b.b[2].p);c[0]=b.b[2].k[0][0][0]+b.b[2].G[0]*Math.floor(b.b[2].p/2);c[1]=b.b[2].k[0][0][1]+b.b[2].G[1]*Math.floor(b.b[2].p/
2);c[2]=b.b[2].k[0][0][2]+b.b[2].G[2]*Math.floor(b.b[2].p/2);c=Ze(c,b.b[2].Ga,b.b[2].i,b.b[2].B,b.na,b.ca,b,b.M,b.ld);b.M&&(c.e=b.e.c[2].c[Math.floor(b.b[2].p/2)].I);b.c[2].c[Math.floor(b.b[2].p/2)]=c;b.Hb=Math.floor(b.b[2].p/2);b.Lc=Math.floor(b.b[2].p/2);F.Ea(a.f+".reslice");return b.ca};function cf(){Y.call(this);this.f="parserIMAGE"}E(cf,Y);cf.prototype.parse=function(a,b,c,e){c instanceof ArrayBuffer||m(Error());for(var d=new Uint8Array(c),f=d.length,g=Array(f);f--;)g[f]=String.fromCharCode(d[f]);d=window.btoa(g.join(""));f=new Image;ac(f,"load",this.ek.bind(this,f,a,b,c,e));f.src="data:image/"+e+";base64,"+d};cf.prototype.ek=function(a,b,c){b.Ra=a;b.bc=t;a=new md;a.F=c;a.v=b;this.dispatchEvent(a)};C("X.parserIMAGE",cf);C("X.parserIMAGE.prototype.parse",cf.prototype.parse);function df(a,b){Se.call(this,a,b);this.f="camera2D"}E(df,Se);df.prototype.rotate=function(a){a=df.w.rotate.call(this,a);var b=new Kd;0<a.x?b.hf--:0>a.x&&b.hf++;0<a.y?b.We++:0>a.y&&b.We--;this.dispatchEvent(b)};df.prototype.gg=function(a){var b=20;a!=t&&!a&&(b=0.02);this.o[14]+=b};df.prototype.hg=function(a){var b=20;a!=t&&!a&&(b=0.02);this.o[14]-=b};
df.prototype.Rf=function(a){ja(a)&&2==a.length?a=new F.m(a[0],a[1],0):a instanceof F.m||m(Error("Invalid distance vector for pan operation."));this.o[12]-=a.x/this.o[14];this.o[13]+=a.y/this.o[14]};function gf(){J.call(this);this.f="shaders";this.fe="";var a;a="precision mediump float;\n\n";a+="attribute vec3 vertexPosition;\n";a+="attribute vec3 vertexNormal;\n";a+="attribute vec3 vertexColor;\n";a+="attribute vec2 vertexTexturePos;\n";a+="attribute float vertexScalar;\n";a+="\n";a+="uniform mat4 view;\n";a+="uniform mat4 perspective;\n";a+="uniform vec3 center;\n";a+="uniform mat4 objectTransform;\n";a+="uniform bool useObjectColor;\n";a+="uniform bool useScalars;\n";a+="uniform bool scalarsReplaceMode;\n";
a+="uniform float scalarsMin;\n";a+="uniform float scalarsMax;\n";a+="uniform vec3 scalarsMinColor;\n";a+="uniform vec3 scalarsMaxColor;\n";a+="uniform float scalarsMinThreshold;\n";a+="uniform float scalarsMaxThreshold;\n";a+="uniform int scalarsInterpolation;\n";a+="uniform vec3 objectColor;\n";a+="uniform float pointSize;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";
a+="varying vec3 fTransformedVertexNormal;\n";a+="\n";a+="void main(void) {\n";a+="  fTransformedVertexNormal = mat3(view[0].xyz,view[1].xyz,view[2].xyz) * ";a+="mat3(objectTransform[0].xyz,objectTransform[1].xyz,objectTransform[2].xyz) * ";a+="vertexNormal;\n";a+="  fVertexNormal = vertexNormal;\n";a+="  fDiscardNow = 0.0;\n";a+="  vec3 vertexPosition2 = vertexPosition - center;\n";a+="  fVertexPosition = view * objectTransform * vec4(vertexPosition2, 1.0);\n";a+="  fragmentTexturePos = vertexTexturePos;\n";
a+="  if (useScalars) {\n";a+="    float scalarValue = vertexScalar;\n";a+="    if (scalarValue < scalarsMinThreshold || scalarValue > scalarsMaxThreshold) {\n";a+="      if (scalarsReplaceMode) {\n";a+="        fragmentColor = objectColor;\n";a+="      } else {\n";a+="        fDiscardNow = 1.0;\n";a+="      }\n";a+="    } else {\n";a+="      if (scalarsReplaceMode) {\n";a+="        if (scalarsInterpolation == 1) {\n";a+="            vec3 zeroMaxColor;\n";a+="            vec3 zeroMinColor;\n";a+=
"            zeroMaxColor[0] = scalarsMaxColor[0]*0.33;\n";a+="            zeroMaxColor[1] = scalarsMaxColor[1]*0.33;\n";a+="            zeroMaxColor[2] = scalarsMaxColor[2]*0.33;\n";a+="            zeroMinColor[0] = scalarsMinColor[0]*0.33;\n";a+="            zeroMinColor[1] = scalarsMinColor[1]*0.33;\n";a+="            zeroMinColor[2] = scalarsMinColor[2]*0.33;\n";a+="            if(scalarValue < 0.0) {fragmentColor = scalarValue/(scalarsMin) * scalarsMinColor + (1.0 - scalarValue/(scalarsMin)) * (zeroMinColor);}\n";
a+="            else {fragmentColor = scalarValue/(scalarsMax) * scalarsMaxColor + (1.0 - scalarValue/(scalarsMax)) * (zeroMaxColor);}\n";a+="        } else {\n";a+="            fragmentColor = scalarValue * scalarsMaxColor + (1.0 - scalarValue) * scalarsMinColor;\n";a+="          }\n";a+="      } else {\n";a+="        fragmentColor = vertexColor;\n";a+="      }\n";a+="    }\n";a+="  } else if (useObjectColor) {\n";a+="    fragmentColor = objectColor;\n";a+="  } else {\n";a+="    fragmentColor = vertexColor;\n";
a+="  }\n";a+="  gl_PointSize = pointSize;\n";a+="  gl_Position = perspective * fVertexPosition;\n";this.fe=a+="}\n";this.Xd="";a="precision mediump float;\n\n";a+="uniform bool usePicking;\n";a+="uniform bool useTexture;\n";a+="uniform bool volumeTexture;\n";a+="uniform bool useLabelMapTexture;\n";a+="uniform sampler2D textureSampler;\n";a+="uniform sampler2D textureSampler2;\n";a+="uniform float objectOpacity;\n";a+="uniform float labelmapOpacity;\n";a+="uniform vec4 labelmapColor;\n";a+="uniform float volumeLowerThreshold;\n";
a+="uniform float volumeUpperThreshold;\n";a+="uniform float volumeScalarMin;\n";a+="uniform float volumeScalarMax;\n";a+="uniform vec3 volumeScalarMinColor;\n";a+="uniform vec3 volumeScalarMaxColor;\n";a+="uniform float volumeWindowLow;\n";a+="uniform float volumeWindowHigh;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";a+="varying vec3 fTransformedVertexNormal;\n";
a+="\n";a+="void main(void) {\n";a+=" if (fDiscardNow > 0.0) {\n";a+="   discard;\n";a+=" }\n";a+=" if (usePicking) {\n";a+="   gl_FragColor = vec4(fragmentColor, 1.0);\n";a+=" } else if (useTexture) {\n";a+="   vec4 texture1 = texture2D(textureSampler,fragmentTexturePos);\n";a+="   vec4 textureSum = texture1;\n";a+="   if (volumeTexture) {\n";a+="     float _windowLow = ((volumeWindowLow - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n";a+="     float _windowHigh = ((volumeWindowHigh - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n";
a+="     vec3 _minrange = vec3(_windowLow,_windowLow,_windowLow);\n";a+="     vec3 _maxrange = vec3(_windowHigh,_windowHigh,_windowHigh);\n";a+="     vec3 fac = _maxrange - _minrange;\n";a+="     textureSum = vec4((textureSum.r - _minrange)/fac,1);\n";a+="     textureSum = textureSum.r * vec4(volumeScalarMaxColor,1) + (1.0 - textureSum.r) * vec4(volumeScalarMinColor,1);\n";a+="   }\n";a+="   if (useLabelMapTexture) {\n";a+="     vec4 texture2 = texture2D(textureSampler2,fragmentTexturePos);\n";a+=
"     if (texture2.a > 0.0) {\n";a+="         if (labelmapColor.a != -255.0) {\n";a+="           if (all(equal(floor(texture2 * vec4(255)), labelmapColor))) {\n";a+="             if (labelmapOpacity < 1.0) {\n";a+="               textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";a+="             } else {\n";a+="               textureSum = texture2;\n";a+="             }\n";a+="           }\n";a+="         } else {\n";a+="           if (labelmapOpacity < 1.0) {\n";a+="             textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";
a+="           } else {\n";a+="             textureSum = texture2;\n";a+="           }\n";a+="         }\n";a+="     }\n";a+="   }\n";a+="   if (volumeTexture) {\n";a+="     float _volumeLowerThreshold = (volumeLowerThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n";a+="     float _volumeUpperThreshold = (volumeUpperThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n";a+="     if (texture1.r < _volumeLowerThreshold ||\n";a+="         texture1.r > _volumeUpperThreshold ||\n";
a+="         texture1.a == 0.0 ) {\n";a+="       discard;\n";a+="     };\n";a+="   };\n";a+="   gl_FragColor = textureSum;\n";a+="   gl_FragColor.a = objectOpacity;\n";a+=" } else {\n";a+="   vec3 nNormal = normalize(fTransformedVertexNormal);\n";a+="   if (fVertexNormal == vec3(0.0,0.0,0.0)) {\n";a+="     gl_FragColor = vec4(fragmentColor,1.0);\n";a+="     return;\n";a+="   }\n";a+="   vec3 light = vec3(0.0, 0.0, 1.0);\n";a+="   vec3 lightDirection = vec3(0,0,-10);\n";a+="   lightDirection = normalize(lightDirection);\n";
a+="   vec3 eyeDirection = normalize(-fVertexPosition.xyz);\n";a+="   vec3 reflectionDirection = reflect(-lightDirection, nNormal);\n";a+="   float specular = pow(max(dot(reflectionDirection, eyeDirection), 0.0), 10.0);\n";a+="   float diffuse = 0.8 * max(dot(nNormal, light), 0.0);\n";a+="   float ambient = 0.3;\n";a+="   gl_FragColor = vec4(fragmentColor * ambient +\n";a+="                       fragmentColor * diffuse +\n";a+="                       vec3(0.2, 0.2, 0.2) * specular,\n";a+="                       objectOpacity);\n";
a+=" }\n";this.Xd=a+="}\n"}E(gf,J);
var hf={ml:"vertexPosition",ll:"vertexNormal",kl:"vertexColor",ol:"vertexTexturePos",nl:"vertexScalar"},jf={pl:"view",Uk:"perspective",Lk:"center",Tk:"objectTransform",gl:"useObjectColor",Rk:"objectColor",il:"useScalars",cl:"scalarsReplaceMode",$k:"scalarsMin",Xk:"scalarsMax",al:"scalarsMinColor",Yk:"scalarsMaxColor",bl:"scalarsMinThreshold",Zk:"scalarsMaxThreshold",Wk:"scalarsInterpolation",Vk:"pointSize",Sk:"objectOpacity",Qk:"normal",hl:"usePicking",jl:"useTexture",fl:"useLabelMapTexture",Ok:"labelmapOpacity",
Nk:"labelmapColor",dl:"textureSampler",el:"textureSampler2",ql:"volumeLowerThreshold",wl:"volumeUpperThreshold",tl:"volumeScalarMin",rl:"volumeScalarMax",ul:"volumeScalarMinColor",sl:"volumeScalarMaxColor",yl:"volumeWindowLow",xl:"volumeWindowHigh",vl:"volumeTexture"};function kf(a){function b(a,b){a*=2*Math.PI;b*=Math.PI;var d=new ya(Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b));g.push(new lc(za(c,Aa(d,e)),d))}this.ba=[];a=a||{};var c=new ya(a.qf||[0,0,0]),e=a.Cb||1,d=a.ta||16;a=a.yk||8;for(var f=[],g=[],h=0;h<d;h++)for(var l=0;l<a;l++)g=[],b(h/d,l/a),0<l&&b((h+1)/d,l/a),l<a-1&&b((h+1)/d,(l+1)/a),b(h/d,(l+1)/a),f.push(new nc(g));return vc(f)}E(kf,uc);function lf(){W.call(this);this.f="sphere";this.C=[0,0,0];this.pc=5;this.ib=32;this.hi=16;Fa(this,new pd)}E(lf,W);lf.prototype.__defineGetter__("center",v("C"));lf.prototype.__defineSetter__("center",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid center"));this.C=a});lf.prototype.__defineGetter__("radius",v("pc"));lf.prototype.__defineSetter__("radius",function(a){y(a)||m(Error("Invalid radius."));this.pc=a});
lf.prototype.q=function(){rd(this,new kf({qf:this.C,Cb:this.pc,ta:this.ib,yk:this.hi}));lf.w.q.call(this)};C("X.sphere",lf);C("X.sphere.prototype.modified",lf.prototype.q);function mf(a,b,c){oa(a)?c&&(a=va(a,c)):a&&"function"==typeof a.handleEvent?a=va(a.handleEvent,a):m(Error("Invalid listener argument"));return 2147483647<b?-1:ea.setTimeout(a,b||0)};function nf(a){function b(a,b,e){b=2*b*Math.PI;b=za(Aa(l,Math.cos(b)),Aa(j,Math.sin(b)));a=za(za(c,Aa(d,a)),Aa(b,f));e=za(Aa(b,1-Math.abs(e)),Aa(g,e));return new lc(a,e)}this.ba=[];a=a||{};var c=new ya(a.start||[0,-1,0]),e=new ya(a.end||[0,1,0]),d=Ba(e,c),f=a.Cb||1;a=a.ta||16;for(var g=Ca(d),h=0.5<Math.abs(g.y()),l=Ca((new ya(h,!h,0)).yc(g)),j=Ca(l.yc(g)),h=new lc(c,Ea(g)),e=new lc(e,Ca(g)),k=[],n=0;n<a;n++){var s=n/a,q=(n+1)/a;k.push(new nc([h,b(0,s,-1),b(0,q,-1)]));k.push(new nc([b(0,q,0),b(0,s,
0),b(1,s,0),b(1,q,0)]));k.push(new nc([e,b(1,q,1),b(1,s,1)]))}return vc(k)}E(nf,uc);function of(){W.call(this);this.f="cylinder";this.ff=[-10,-10,-10];this.Pe=[10,10,10];this.pc=10;this.ib=32;Fa(this,new pd)}E(of,W);of.prototype.__defineGetter__("start",v("ff"));of.prototype.__defineSetter__("start",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid start"));this.ff=a});of.prototype.__defineGetter__("end",v("Pe"));of.prototype.__defineSetter__("end",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid end"));this.Pe=a});of.prototype.__defineGetter__("radius",v("pc"));
of.prototype.__defineSetter__("radius",function(a){y(a)||m(Error("Invalid radius."));this.pc=a});of.prototype.q=function(){rd(this,new nf({start:this.ff,end:this.Pe,Cb:this.pc,ta:this.ib}));of.w.q.call(this)};C("X.cylinder",of);C("X.cylinder.prototype.modified",of.prototype.q);function $e(a){W.call(this);this.f="slice";this.C=[0,0,0];this.lc=[0,0,1];this.X=[0,1,0];this.Vc=[1,0,0];this.D=this.L=10;this.tc=[0,1,0,0,1,1,1,1,1,0,0,0];this.e=this.Ab=t;this.Eb=r;this.jc=[1,1,1];a!=t&&this.xc(a)}E($e,W);$e.prototype.xc=function(a){this.C=a.C.slice();this.lc=a.lc.slice();this.X=a.X.slice();this.L=a.L;this.D=a.D;this.Ab=a.Ab;this.e=a.e;this.Eb=a.Eb;this.jc=a.jc;this.ei=a.ei;$e.w.xc.call(this,a)};$e.prototype.__defineSetter__("height",ba("D"));
$e.prototype.__defineSetter__("width",ba("L"));$e.prototype.__defineGetter__("up",v("X"));$e.prototype.__defineGetter__("right",v("Vc"));$e.prototype.create=function(){this.Bb()};$e.prototype.Wa=function(){$e.w.Wa.call(this);this.C.length=0;this.lc.length=0;this.X.length=0;this.Vc.length=0;this.tc.length=0;this.e=this.Ab=t;this.jc.length=0};
$e.prototype.Bb=function(){var a=(new P(this.lc[0],this.lc[1],this.lc[2])).normalize(),b=new P(this.X[0],this.X[1],this.X[2]),c=new P(this.Vc[0],this.Vc[1],this.Vc[2]),e=new P(this.C[0],this.C[1],this.C[2]),d=Ic(c.l().aa().scale(this.L/2),b.l().aa().scale(this.D/2)),f=new P(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().aa().scale(this.L/2),b.l().scale(this.D/2)),g=new P(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().scale(this.L/2),b.l().aa().scale(this.D/2)),h=new P(d.x+e.x,d.y+e.y,d.d+e.d),d=Ic(c.l().scale(this.L/2),
b.l().scale(this.D/2)),b=new P(d.x+e.x,d.y+e.y,d.d+e.d);this.h=new T(18);this.n=new T(18);this.h.add(f.x,f.y,f.d);this.h.add(g.x,g.y,g.d);this.h.add(h.x,h.y,h.d);this.h.add(h.x,h.y,h.d);this.h.add(b.x,b.y,b.d);this.h.add(g.x,g.y,g.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.n.add(a.x,a.y,a.d);this.Eb&&(a=new W,a.h=new T(24),a.n=new T(24),a.h.add(f.x,f.y,f.d),a.h.add(g.x,g.y,g.d),a.h.add(g.x,g.y,g.d),a.h.add(b.x,b.y,
b.d),a.h.add(b.x,b.y,b.d),a.h.add(h.x,h.y,h.d),a.h.add(h.x,h.y,h.d),a.h.add(f.x,f.y,f.d),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.n.add(0,0,0),a.B=[this.jc[0],this.jc[1],this.jc[2]],a.Ia="LINES",a.Nc=2,this.c.push(a))};C("X.slice",$e);C("X.slice.prototype.create",$e.prototype.create);C("X.slice.prototype.destroy",$e.prototype.Wa);function M(a){W.call(this);this.f="volume";this.C=[0,0,0];this.da=[10,10,10];this.na=[1,1,1];this.xd=[10,10,10];this.sb=[1,1,1];this.Ra=[];this.Lc=this.Hb=this.Kc=this.Gb=this.Jc=this.Fb=0;this.qc=new W;this.rc=new W;this.sc=new W;this.he=this.Ua=u;this.Y=-1;this.ge=[];this.e=t;this.Eb=r;this.$=Infinity;this.Z=-Infinity;this.Cg=r;this.de=1;this.fa=0;this.z=t;this.b=[];this.t=[0,0,0];this.fb=[0,0,0];this.Ec=[0,0,0];this.ca=[];this.ig=[];this.gb=t;Fa(this,new yc);Fa(this,new kd);a!=t&&this.xc(a)}
E(M,W);M.prototype.xc=function(a){this.C=a.C.slice();this.da=a.da.slice();this.sb=a.sb.slice();this.Fb=a.Fb;this.Jc=a.Jc;this.Gb=a.Gb;this.Kc=a.Kc;this.Hb=a.Hb;this.Lc=a.Lc;this.lg=a.lg.slice();this.qc=new W(a.qc);this.rc=new W(a.rc);this.sc=new W(a.sc);this.fa=a.fa;this.z=a.z;this.Ua=a.Ua;this.he=a.he;this.Y=a.Y;this.e=a.e;this.Eb=a.Eb;M.w.xc.call(this,a)};
M.prototype.Bb=function(a){this.c.length=0;this.qc.c.length=0;this.rc.c.length=0;this.sc.c.length=0;this.c.push(this.qc);this.c.push(this.rc);this.c.push(this.sc);this.xa=a.Rb;this.Ec=a.Sb;this.fb=a.Qb;this.ic=a.Ja;this.jg=a.Ka;this.fa=a.max;this.z=a.data;this.j=r};
M.prototype.Wa=function(){M.w.Wa.call(this);this.Ra.length=0;this.c.length=0;this.qc.c.length=0;this.qc.length=0;this.rc.c.length=0;this.rc.length=0;this.sc.c.length=0;this.sc.length=0;this.z=t;this.na.length=0;this.b.length=0;this.t.length=0;this.fb.length=0;this.Ec.length=0;this.ca.length=0;this.ig.length=0;this.gb=t};
M.prototype.q=function(a){a="undefined"!==typeof a?a:r;if(0<this.c.length){this.Ua!=this.he&&(!this.Ua&&-1!=this.Y&&(this.c[this.Y].visible=u),this.j=r,this.he=this.Ua);if(!this.P)return;for(var b=0,b=0;3>b;b++){var c=this.c[b],e=0,d=0;0==b?(e=this.Fb,d=this.Jc,this.Jc=this.Fb):1==b?(e=this.Gb,d=this.Kc,this.Kc=this.Gb):2==b&&(e=this.Hb,d=this.Lc,this.Lc=this.Hb);if(this.c[b].c[parseInt(e,10)]==t){var f=Nc();f[0]=this.b[b].k[0][0][0]+this.b[b].G[0]*parseInt(e,10);f[1]=this.b[b].k[0][0][1]+this.b[b].G[1]*
parseInt(e,10);f[2]=this.b[b].k[0][0][2]+this.b[b].G[2]*parseInt(e,10);if(this.M){var g=Ze(f,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.e.ca,this.e,this.e.M,this.e.ya.Ma);this.e.c[b].c[parseInt(e,10)]=g;this.e.c[b].q(r)}f=Ze(f,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.ca,this,r,t);this.M&&(f.e=f.I,f.e=this.e.c[b].c[parseInt(e,10)].I);c.c[parseInt(e,10)]=f;this.c[b].q(r)}d=c.c[parseInt(d,10)];this.Ua||(d.visible=u);c=c.c[parseInt(e,10)];c.visible=r;c.Aa=1;this.Ua&&(c.c[0].P=u,b!=this.Y&&
(c.visible=u,c.Aa=0))}this.Ua&&-1!=this.Y&&pf(this,this.Y)}a&&M.w.q.call(this)};M.prototype.__defineGetter__("dimensions",v("da"));M.prototype.__defineSetter__("dimensions",ba("da"));M.prototype.__defineGetter__("spacing",v("sb"));M.prototype.__defineSetter__("spacing",ba("sb"));M.prototype.__defineGetter__("bbox",v("na"));M.prototype.__defineGetter__("range",v("xd"));M.prototype.__defineGetter__("dimensionsRAS",v("lg"));M.prototype.__defineGetter__("volumeRendering",v("Ua"));
M.prototype.__defineSetter__("volumeRendering",function(a){this.Ua=a;this.q(u)});M.prototype.__defineGetter__("visible",v("P"));M.prototype.__defineSetter__("visible",function(a){if(a)this.P=a,this.q(u);else{for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].visible=a;this.P=a;this.j=r}});M.prototype.__defineGetter__("center",v("C"));M.prototype.__defineSetter__("center",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid center."));this.C=a});
M.prototype.__defineGetter__("volumeRenderingCache",v("ge"));M.prototype.__defineSetter__("volumeRenderingCache",function(a){(a==t||!ja(a)||!(3>=a.length))&&m(Error("Invalid volumeRederingCache."));this.ge=a});M.prototype.__defineGetter__("image",v("Ra"));M.prototype.__defineGetter__("labelmap",function(){this.e||(this.e=new qf(this));return this.e});M.prototype.__defineGetter__("indexX",v("Fb"));M.prototype.__defineSetter__("indexX",function(a){y(a)&&(0<=a&&a<this.qc.c.length)&&(this.Fb=a,this.q(u))});
M.prototype.__defineGetter__("indexY",v("Gb"));M.prototype.__defineSetter__("indexY",function(a){y(a)&&(0<=a&&a<this.rc.c.length)&&(this.Gb=a,this.q(u))});M.prototype.__defineGetter__("indexZ",v("Hb"));M.prototype.__defineSetter__("indexZ",function(a){y(a)&&(0<=a&&a<this.sc.c.length)&&(this.Hb=a,this.q(u))});M.prototype.__defineGetter__("windowLow",v("$"));M.prototype.__defineSetter__("windowLow",function(a){ud("reset -> WindowLow, from "+this.$+" to "+a);this.$=a});
M.prototype.__defineGetter__("windowHigh",v("Z"));M.prototype.__defineSetter__("windowHigh",function(a){ud("reset -> WindowHigh, from "+this.Z+" to "+a);this.Z=a});M.prototype.__defineGetter__("borders",v("Eb"));M.prototype.__defineSetter__("borders",ba("Eb"));M.prototype.__defineGetter__("reslicing",v("Cg"));M.prototype.__defineSetter__("reslicing",ba("Cg"));M.prototype.__defineGetter__("resolutionFactor",v("de"));M.prototype.__defineSetter__("resolutionFactor",ba("de"));
M.prototype.__defineSetter__("xNormX",function(a){this.b[0].i[0]=a});M.prototype.__defineGetter__("xNormX",function(){return this.b[0].i[0]});M.prototype.__defineSetter__("xNormY",function(a){this.b[0].i[1]=a});M.prototype.__defineGetter__("xNormY",function(){return this.b[0].i[1]});M.prototype.__defineSetter__("xNormZ",function(a){this.b[0].i[2]=a});M.prototype.__defineGetter__("xNormZ",function(){return this.b[0].i[2]});M.prototype.__defineSetter__("xColor",function(a){this.b[0].B=a});
M.prototype.__defineGetter__("xColor",function(){return this.b[0].B});M.prototype.__defineSetter__("yNormX",function(a){this.b[1].i[0]=a});M.prototype.__defineGetter__("yNormX",function(){return this.b[1].i[0]});M.prototype.__defineSetter__("yNormY",function(a){this.b[1].i[1]=a});M.prototype.__defineGetter__("yNormY",function(){return this.b[1].i[1]});M.prototype.__defineSetter__("yNormZ",function(a){this.b[1].i[2]=a});M.prototype.__defineGetter__("yNormZ",function(){return this.b[1].i[2]});
M.prototype.__defineSetter__("yColor",function(a){this.b[1].B=a});M.prototype.__defineGetter__("yColor",function(){return this.b[1].B});M.prototype.__defineSetter__("zNormX",function(a){this.b[2].i[0]=a});M.prototype.__defineGetter__("zNormX",function(){return this.b[2].i[0]});M.prototype.__defineSetter__("zNormY",function(a){this.b[2].i[1]=a});M.prototype.__defineGetter__("zNormY",function(){return this.b[2].i[1]});M.prototype.__defineSetter__("zNormZ",function(a){this.b[2].i[2]=a});
M.prototype.__defineGetter__("zNormZ",function(){return this.b[2].i[2]});M.prototype.__defineSetter__("zColor",function(a){this.b[2].B=a});M.prototype.__defineGetter__("zColor",function(){return this.b[2].B});
M.prototype.tk=function(a){this.c[a].visible=u;for(var b=0;b<this.c[a].c.length;b++)"undefined"!=typeof this.c[a].c[b]&&(this.M&&(this.e.c[a].c[b].remove(),this.e.c[a].c[b]=t),this.c[a].c[b].remove(),this.c[a].c[b]=t);Pc(this.b[a].i,this.b[a].i);af(a,this.b[a].yd,this.b[a].i,this);this.c[a].c=[];this.c[a].c=Array(this.b[a].p);this.M&&(b=Ze(this.b[a].yd,this.b[a].Ga,this.b[a].i,this.b[a].B,this.na,this.e.ca,this.e,this.e.M,this.e.ya.Ma),this.e.c[a].c=[],this.e.c[a].c=Array(this.b[a].p),this.e.c[a].c[Math.floor(this.b[a].p/
2)]=b,this.e.c[a].q());b=Ze(this.b[a].yd,this.b[a].Ga,this.b[a].i,this.b[a].B,this.na,this.ca,this,r,t);window.console.log("modified!");this.M&&(b.e=b.I,b.e=this.e.c[a].c[Math.floor(this.b[a].p/2)].I);this.c[a].c[Math.floor(this.b[a].p/2)]=b;0==a?(this.Fb=Math.floor(this.b[a].p/2),this.Jc=Math.floor(this.b[a].p/2)):1==a?(this.Gb=Math.floor(this.b[a].p/2),this.Kc=Math.floor(this.b[a].p/2)):(this.Hb=Math.floor(this.b[a].p/2),this.Lc=Math.floor(this.b[a].p/2));this.c[a].q();this.c[a].c[Math.floor(this.b[a].p/
2)].P=r};
function pf(a,b){if(!a.Vd)if(!a.Ua||!a.j&&b==a.Y)a.Y=b;else if(-1==a.ge.indexOf(b)){a.ge.push(b);a.Vd=r;var c=new Td;c.F=a;a.dispatchEvent(c);a.onComputing(b);setTimeout(function(){var a=t;0<=this.Y&&(a=this.c[this.Y],a.visible=u);var a=this.c[b],c=a.c.length,d=Math.floor(c/4),e;for(e=0;e<1*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].G[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].G[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].G[2]*e;if(this.M){var k=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,
this.na,this.e.ca,this.e,this.e.M,this.e.ya.Ma);this.e.c[b].c[e]=k;this.e.c[b].q(r)}j=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.ca,this,r,t);j.c[0].P=u;this.M&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].P=r}rf(this,0.25);setTimeout(function(){for(;e<2*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].G[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].G[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].G[2]*e;if(this.M){var k=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.e.ca,
this.e,this.e.M,this.e.ya.Ma);this.e.c[b].c[e]=k;this.e.c[b].q(r)}j=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.ca,this,r,t);j.c[0].P=u;this.M&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].P=r}rf(this,0.5);setTimeout(function(){for(;e<3*d;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].G[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].G[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].G[2]*e;if(this.M){var k=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.e.ca,this.e,this.e.M,
this.e.ya.Ma);this.e.c[b].c[e]=k;this.e.c[b].q(r)}j=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.ca,this,r,t);j.c[0].P=u;this.M&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].P=r}rf(this,0.75);setTimeout(function(){for(e=3*d;e<c;e++){if(a.c[e]==t){var j=Nc();j[0]=this.b[b].k[0][0][0]+this.b[b].G[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].G[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].G[2]*e;if(this.M){var k=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.e.ca,this.e,this.e.M,this.e.ya.Ma);
this.e.c[b].c[e]=k;this.e.c[b].q(r)}j=Ze(j,this.b[b].Ga,this.b[b].i,this.b[b].B,this.na,this.ca,this,r,t);j.c[0].P=u;this.M&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].P=r}rf(this,1);setTimeout(function(){this.Vd&&this.c[b].q(r);this.Y=b;this.j=u;if(this.Vd){var a=new Vd;a.F=this;this.dispatchEvent(a);this.onComputingEnd(b)}this.Vd=u}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(a),10)}else{c=a.c[a.Y];c.visible=u;var c=a.c[b],e=c.c.length,d;for(d=0;d<e;d++)c.c[d].P=r;
a.Y=b;a.j=u}}function rf(a,b){var c=new Ud;c.Dd=b;a.dispatchEvent(c);a.onComputingProgress(100*b)}M.prototype.Lf=aa();M.prototype.Nf=aa();M.prototype.Mf=aa();C("X.volume",M);C("X.volume.prototype.modified",M.prototype.q);C("X.volume.prototype.destroy",M.prototype.Wa);C("X.volume.prototype.sliceInfoChanged",M.prototype.tk);C("X.volume.prototype.onComputing",M.prototype.Lf);C("X.volume.prototype.onComputingProgress",M.prototype.Nf);C("X.volume.prototype.onComputingEnd",M.prototype.Mf);function qf(a){M.call(this);this.f="labelmap";this.Ab=a;this.ef=new Float32Array([-255,-255,-255,-255])}E(qf,M);qf.prototype.q=function(){var a=new md;a.F=this;this.dispatchEvent(a);this.Ab.q()};qf.prototype.__defineSetter__("showOnly",function(a){var b=[-1,-1,-1,-1];a!=t&&(ja(a)&&4==a.length?b=a:(this.ya||m(Error("No colortable assigned.")),b=this.ya.Ma.get(a).slice(1,5)));this.ef=new Float32Array([Math.floor(255*b[0]),Math.floor(255*b[1]),Math.floor(255*b[2]),Math.floor(255*b[3])])});
C("X.labelmap",qf);function sf(a){this.ba=[];a=a||{};var b=new ya(a.qf||[0,0,0]),c=!a.Cb?[1,1,1]:a.Cb.length?a.Cb:[a.Cb,a.Cb,a.Cb];return vc([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(a){return new nc(a[0].map(function(d){d=new ya(b.x()+c[0]*(2*!!(d&1)-1),b.y()+c[1]*(2*!!(d&2)-1),b.d()+c[2]*(2*!!(d&4)-1));return new lc(d,new ya(a[1]))}))}))}E(sf,uc);function tf(){W.call(this);this.f="cube";this.C=[0,0,0];this.Ve=this.Ue=this.Te=20;this.tc=[0,1,1,1,1,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0];Fa(this,new pd)}E(tf,W);tf.prototype.__defineGetter__("center",v("C"));tf.prototype.__defineSetter__("center",function(a){(a==t||!ja(a)||3!=a.length)&&m(Error("Invalid center"));this.C=a});tf.prototype.__defineGetter__("lengthX",v("Te"));
tf.prototype.__defineSetter__("lengthX",function(a){y(a)||m(Error("Invalid lengthX."));this.Te=a});tf.prototype.__defineGetter__("lengthY",v("Ue"));tf.prototype.__defineSetter__("lengthY",function(a){y(a)||m(Error("Invalid lengthY."));this.Ue=a});tf.prototype.__defineGetter__("lengthZ",v("Ve"));tf.prototype.__defineSetter__("lengthZ",function(a){y(a)||m(Error("Invalid lengthZ."));this.Ve=a});tf.prototype.q=function(){rd(this,new sf({qf:this.C,Cb:[this.Te/2,this.Ue/2,this.Ve/2]}));tf.w.q.call(this)};
C("X.cube",tf);C("X.cube.prototype.modified",tf.prototype.q);function Pe(a){Ne.call(this,a);this.f="interactor3D";this.zl=u}E(Pe,Ne);Pe.prototype.Nd=function(a){Pe.w.Nd.call(this,a);var b=new Nd;a.ed==t&&(a.ed=0);b.xb=0>a.ed;b.kb=r;this.dispatchEvent(b)};function uf(a){J.call(this);this.f="array";this.K=[];this.kg=a}E(uf,J);function vf(a,b,c){for(var e=0;4>e;e++)if(a[e+0]!==b[e+c])return u;return r}uf.prototype.add=function(a){this.K.push(a);return r};uf.prototype.remove=function(a){a=this.K.indexOf(a);-1<a&&this.K.splice(a,1);return r};uf.prototype.clear=function(){this.K.length=0};
function wf(a,b,c){var e=c-b;if(!(2>e)){e=b+Math.floor(e/2);wf(a,b,e);for(wf(a,e,c);b<e;++b)if(0<a.kg(a.K[b],a.K[e])){var d=a.K[b];a.K[b]=a.K[e];for(var f=a,g=e,h=c;g+1<h&&0>f.kg(f.K[g+1],d);){var l=f,j=g+1,k=l.K[g];l.K[g]=l.K[j];l.K[j]=k;++g}f.K[g]=d}}}uf.prototype.sort=function(){wf(this,0,this.K.length)};function xf(){Y.call(this);this.f="parserOFF"}E(xf,Y);
xf.prototype.parse=function(a,b,c){function e(){l===d&&m(Error("End of file reached unexpectedly."));for(var a=l;a<d;++a)if(10===f[a]){var b=We(f,l,a);l=a+1;return b}l=d;return We(f,l,d-1)}F.La(this.f+".parse");this.z=c;var d=c.byteLength,f=Z(this,"uchar",d);c=[];b.h=new T(d);b.n=new T(d);for(var g=b.h,h=b.n,l=0,j=e(),j=("OFF"===j?e():j).split(" "),k=j[0],j=j[1];k--;){var n=e(),n=n.split(" ");c.push([parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])])}for(;j--;){var n=e(),n=n.split(" "),s=c[parseInt(n[1],
10)],k=c[parseInt(n[2],10)],n=c[parseInt(n[3],10)];g.add(s[0],s[1],s[2]);g.add(k[0],k[1],k[2]);g.add(n[0],n[1],n[2]);s=new P(s[0],s[1],s[2]);n=new P(n[0],n[1],n[2]);k=Jc((new P(k[0],k[1],k[2])).wa(s),n.wa(s));k.normalize();h.add(k.x,k.y,k.d);h.add(k.x,k.y,k.d);h.add(k.x,k.y,k.d)}F.Ea(this.f+".parse");c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};C("X.parserOFF",xf);C("X.parserOFF.prototype.parse",xf.prototype.parse);function yf(){Y.call(this);this.f="parserDCM"}E(yf,Y);
yf.prototype.parse=function(a,b,c){b.Dc={};b.Dc.Cf=0;this.Nb(c,b);if(b.s.length==t||b.ta.length==b.s.length){b.Dc.Cf=b.s.length;var e={};c={};for(var d=0;d<b.ta.length;d++)e.hasOwnProperty(b.ta[d].series_instance_uid)||(e[b.ta[d].series_instance_uid]=[],c[b.ta[d].series_instance_uid]={}),c[b.ta[d].series_instance_uid].hasOwnProperty(b.ta[d].sop_instance_uid)||(c[b.ta[d].series_instance_uid][b.ta[d].sop_instance_uid]=r,e[b.ta[d].series_instance_uid].push(b.ta[d]));var f=Object.keys(e)[0],d=e[f],g=
d.length;c={};var h="image_position_patient";1==g?(h="image_position_patient",e[f][0].dist=0):d[0].image_position_patient[0]!=d[1].image_position_patient[0]||d[0].image_position_patient[1]!=d[1].image_position_patient[1]||d[0].image_position_patient[2]!=d[1].image_position_patient[2]?(h="image_position_patient",e=new P(d[0].image_orientation_patient[0],d[0].image_orientation_patient[1],d[0].image_orientation_patient[2]),f=new P(d[0].image_orientation_patient[3],d[0].image_orientation_patient[4],d[0].image_orientation_patient[5]),
e=Jc(e,f),d.map(function(a,b){b.dist=b.image_position_patient[0]*a.x+b.image_position_patient[1]*a.y+b.image_position_patient[2]*a.d;return b}.bind(t,e)),d.sort(function(a,b){return a.dist-b.dist})):d[0].instance_number!=d[1].instance_number?(h="instance_number",d.sort(function(a,b){return a.instance_number-b.instance_number})):window.console.log("Could not resolve the ordering mode");isNaN(d[0].pixel_spacing[0])&&(d[0].pixel_spacing[0]=1);isNaN(d[0].pixel_spacing[1])&&(d[0].pixel_spacing[1]=1);if(1<
g)switch(h){case "image_position_patient":var l=d[0].image_position_patient,e=d[1].image_position_patient,f=e[0]-l[0],j=e[1]-l[1],k=e[2]-l[2];d[0].pixel_spacing[2]=Math.sqrt(f*f+j*j+k*k);break;case "instance_number":d[0].pixel_spacing[2]=1;break;default:window.console.log("Unkown ordering mode - returning: "+h)}else d[0].pixel_spacing[2]=1;e=1;switch(h){case "image_position_patient":var l=d[0].image_position_patient,n=d[g-1].image_position_patient,f=n[0]-l[0],j=n[1]-l[1],k=n[2]-l[2],f=Math.sqrt(f*
f+j*j+k*k),e=e+Math.round(f/d[0].pixel_spacing[2]);break;case "instance_number":e+=Math.abs(d[g-1].instance_number-d[0].instance_number);break;default:window.console.log("Unkown ordering mode - returning: "+h)}l=d[0].columns*d[0].rows;f=l*e;n=t;switch(d[0].lf){case 8:n=new Uint8Array(f);break;case 16:n=new Uint16Array(f);break;case 32:n=new Uint32Array(f);default:window.console.log("Unknown number of bits allocated - using default: 32 bits")}b.sb=d[0].pixel_spacing;for(var s=0;s<g;s++){var q=d[s].data,
f=0;switch(h){case "image_position_patient":f=d[s].image_position_patient[0]-d[0].image_position_patient[0];j=d[s].image_position_patient[1]-d[0].image_position_patient[1];k=d[s].image_position_patient[2]-d[0].image_position_patient[2];f=Math.round(Math.sqrt(f*f+j*j+k*k)/d[0].pixel_spacing[2]);break;case "instance_number":f=d[s].instance_number-d[0].instance_number;break;default:window.console.log("Unkown ordering mode - returning: "+h)}n.set(q,f*l)}c.data=n;b.z=n;b.da=[d[0].columns,d[0].rows,e];
c.Ol=b.da;e=Ve(n);g=e[0];e=e[1];c.min=b.pa=b.$=g;c.max=b.fa=b.Z=e;-Infinity==b.R&&(b.R=g);Infinity==b.T&&(b.T=e);j=d[0].image_position_patient;g=Sc();if("false"==b.reslicing||b.reslicing==u)Q(g,0,d[0].pixel_spacing[0],0,0,0),Q(g,1,0,d[0].pixel_spacing[1],0,0),Q(g,2,0,0,d[0].pixel_spacing[2],0),Q(g,3,0,0,0,1);else switch(h){case "image_position_patient":e=new P(d[0].image_orientation_patient[0],d[0].image_orientation_patient[1],d[0].image_orientation_patient[2]);f=new P(d[0].image_orientation_patient[3],
d[0].image_orientation_patient[4],d[0].image_orientation_patient[5]);e=Jc(e,f);Q(g,0,-d[0].image_orientation_patient[0]*d[0].pixel_spacing[0],-d[0].image_orientation_patient[3]*d[0].pixel_spacing[1],-e.x*d[0].pixel_spacing[2],-j[0]);Q(g,1,-d[0].image_orientation_patient[1]*d[0].pixel_spacing[0],-d[0].image_orientation_patient[4]*d[0].pixel_spacing[1],-e.y*d[0].pixel_spacing[2],-j[1]);Q(g,2,d[0].image_orientation_patient[2]*d[0].pixel_spacing[0],d[0].image_orientation_patient[5]*d[0].pixel_spacing[1],
e.d*d[0].pixel_spacing[2],j[2]);Q(g,3,0,0,0,1);break;case "instance_number":Q(g,0,-1,0,0,-j[0]);Q(g,1,-0,-1,-0,-j[1]);Q(g,2,0,0,1,j[2]);Q(g,3,0,0,0,1);break;default:window.console.log("Unkown ordering mode - returning: "+h)}c.Ja=g;c.Ka=Sc();ad(c.Ja,c.Ka);h=Rc(0,0,0,1);d=Qc();cd(g,h,d);h=Rc(1,1,1,1);e=Qc();cd(g,h,e);c.Sb=[e[0]-d[0],e[1]-d[1],e[2]-d[2]];d=Xe(g,[b.da[0],b.da[1],b.da[2]]);c.Qb=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.Rb=[d[0],d[2],d[4]];b.Bb(c);b.Ra=bf(this,b)}c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
function zf(a,b,c,e){switch(c){case 16975:case 20819:case 20053:case 22351:c=function(a){for(var b="",c=128;1<=c;c/=2)b+=a&c?"1":"0";return b};e=a[b++];a=a[b++];e=parseInt(c((a&65280)>>8)+c(a&255)+(c((e&65280)>>8)+c(e&255)),2);4294967295==e&&(e=0);b+=e/2;break;default:b+=e/2}return b}
yf.prototype.Nb=function(a,b){this.z=a;if("undefined"==typeof b.ta||b.ta==t)b.ta=[];for(var c={pixel_spacing:[0.1,0.1,Infinity],image_orientation_patient:[1,0,0,0,1,0],image_position_patient:[0,0,0],transfer_syntax_uid:"no_transfer_syntax_uid"},e=Z(this,"ushort",this.z.byteLength),d=66,f=t,g=t,h=t,l=t;d<e.length;)switch(f=e[d++],g=e[d++],h=e[d++],l=e[d++],"1.2.840.10008.1.2"==c.transfer_syntax_uid&&0==l&&(l=h),f){case 2:switch(g){case 16:for(var j="",f=f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>
8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.transfer_syntax_uid=j.replace(/\0/g,"");break;default:d=zf(e,d,h,l)}break;case 40:switch(g){case 16:c.rows=e[d];d+=l/2;break;case 17:c.columns=e[d];d+=l/2;break;case 256:c.lf=e[d];d+=l/2;break;case 257:c.bits_stored=e[d];d+=l/2;break;case 2:c.number_of_images=e[d];d+=l/2;break;case 48:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.pixel_spacing=[parseFloat(j[0]),parseFloat(j[1]),
Infinity];break;default:d=zf(e,d,h,l)}break;case 32:switch(g){case 14:c.series_instance_uid="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.series_instance_uid+=String.fromCharCode(g),c.series_instance_uid+=String.fromCharCode(h);break;case 19:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.instance_number=parseInt(j,10);break;case 50:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);
j=j.split("\\");c.image_position_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2])];break;case 55:j="";for(f=0;f<l/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.image_orientation_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3]),parseFloat(j[4]),parseFloat(j[5])];break;default:d=zf(e,d,h,l)}break;case 65534:switch(g){default:l=0,d+=l/2}break;case 8:switch(g){case 24:c.sop_instance_uid="";for(f=0;f<l/
2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.sop_instance_uid+=String.fromCharCode(g),c.sop_instance_uid+=String.fromCharCode(h);break;default:d=zf(e,d,h,l)}break;case 16:switch(g){case 8720:for(f=0;f<l/2;f++)d++;break;default:d=zf(e,d,h,l)}break;default:d=zf(e,d,h,l)}switch(c.lf){case 8:c.data=new Uint8Array(c.columns*c.rows);break;case 16:c.data=new Uint16Array(c.columns*c.rows);break;case 32:c.data=new Uint32Array(c.columns*c.rows)}this.r=this.z.byteLength-2*c.columns*c.rows;e=t;switch(c.lf){case 8:e=
Z(this,"uchar",c.columns*c.rows);break;case 16:e=Z(this,"ushort",c.columns*c.rows);break;case 32:e=Z(this,"uint",c.columns*c.rows)}c.data=e;b.ta.push(c);return b};C("X.parserDCM",yf);C("X.parserDCM.prototype.parse",yf.prototype.parse);function Af(){Y.call(this);this.f="parserVTK"}E(Af,Y);
Af.prototype.parse=function(a,b,c){F.La(this.f+".parse");var e=b.h,d=b.n,f=new Uint8Array(c),g="";b.h=e=new T(c.byteLength);b.n=d=new T(c.byteLength);c=0;for(var h=f.length;c<h;c+=32768)g+=We(f,c,Math.min(c+32768,h));f=g.split("\n");g=f.length;this.Bd=this.Cd=t;this.mc=[];this.Sa=jd;this.Ye=this.$b=this.Ub=this.ac=u;c=0;for(h=g%8;h--;)Bf(this,f[c]),c++;for(h=0.125*g^0;h--;)Bf(this,f[c]),c++,Bf(this,f[c]),c++,Bf(this,f[c]),c++,Bf(this,f[c]),c++,Bf(this,f[c]),c++,Bf(this,f[c]),c++,Bf(this,f[c]),c++,
Bf(this,f[c]),c++;c=this.Cd;var f=this.Bd,g=f.length,l=h=this.mc.length;do{var j=this.mc[h-l],k=j.length,n;for(n=0;n<k&&!("LINES"==this.Sa&&n+1>=k);n++){var s=parseInt(j[n],10),q=c.get(s);e.add(q[0],q[1],q[2]);var x=s,z=q;"LINES"==this.Sa?(x=parseInt(j[n+1],10),z=c.get(x),e.add(z[0],z[1],z[2])):"TRIANGLE_STRIPS"==this.Sa&&(0==n||n==k-1)&&e.add(q[0],q[1],q[2]);s<g?(z=f.get(s),d.add(z[0],z[1],z[2]),"LINES"==this.Sa?(x=f.get(x),d.add(x[0],x[1],x[2])):"TRIANGLE_STRIPS"==this.Sa&&(0==n||n==k-1)&&d.add(z[0],
z[1],z[2])):(x=new P(q[0],q[1],q[2]),x.normalize(),d.add(x.x,x.y,x.d),"LINES"==this.Sa?(x=new P(z[0],z[1],z[2]),x.normalize(),d.add(x.x,x.y,x.d)):"TRIANGLE_STRIPS"==this.Sa&&(0==n||n==k-1)&&d.add(x.x,x.y,x.d))}l--}while(0<l);b.Ia=this.Sa;F.Ea(this.f+".parse");e=new md;e.F=b;e.v=a;this.dispatchEvent(e)};
function Bf(a,b){b=b.replace(/^\s+|\s+$/g,"");var c=b.split(" "),e=c.length,d=c[0];switch(d){case "POINTS":a.ac=r;a.Ub=u;a.$b=u;c=parseInt(c[1],10);a.Cd=new T(3*c);a.Bd=new T(3*c);return;case "VERTICES":a.Ub=r;a.ac=u;a.$b=u;c=parseInt(c[1],10);3<=c?a.Sa=jd:1==c?a.Sa="POINTS":m(Error("This VTK file is not supported!"));a.mc=[];return;case "TRIANGLE_STRIPS":a.Ub=r;a.ac=u;a.$b=u;a.Sa="TRIANGLE_STRIPS";a.mc=[];return;case "LINES":a.Ub=r;a.ac=u;a.$b=u;a.Sa="LINES";a.mc=[];return;case "POLYGONS":a.Ub=r;
a.ac=u;a.$b=u;a.Sa="POLYGONS";a.mc=[];return;case "POINT_DATA":a.$b=r;a.ac=u;a.Ub=u;return}if(a.ac)if(1==e||isNaN(parseFloat(d)))a.ac=u;else{if(3<=e){var d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]);a.Cd.add(d,f,g)}6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.Cd.add(d,f,g));9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.Cd.add(e,d,c))}else a.Ub?1==e||isNaN(parseFloat(d))?a.Ub=u:(c=c.slice(1),a.mc.push(c)):a.$b&&("NORMALS"==d?a.Ye=r:1==e||isNaN(parseFloat(d))?
(a.$b=u,a.Ye=u):a.Ye&&(3<=e&&(d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]),a.Bd.add(d,f,g)),6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.Bd.add(d,f,g)),9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.Bd.add(e,d,c))))}C("X.parserVTK",Af);C("X.parserVTK.prototype.parse",Af.prototype.parse);function Cf(){Y.call(this);this.f="parserFSM";this.nc=u}E(Cf,Y);
Cf.prototype.parse=function(a,b,c){F.La(this.f+".parse");this.z=c;var e=b.h,d=b.n;b.Uc=[];var f=b.Uc;c=0;var g;do g=Z(this,"uchar"),c++;while(200>c&&10!=g);Z(this,"uchar");d=Z(this,"uint");c=Z(this,"uint");var h=Z(this,"float",3*d);g=Z(this,"uint",3*c);var l=new Uint32Array(d),j=new Float32Array(9*c);b.h=e=new T(9*c);b.n=d=new T(9*c);var k;for(k=0;k<c;k++){var n=3*k,s=g[n],q=g[n+1],x=g[n+2];f.push(s);f.push(q);f.push(x);l[s]+=1;l[q]+=1;l[x]+=1;var n=3*s,z=3*q,B=3*x,A=h[n],G=h[n+1],D=h[n+2],q=h[z],
x=h[z+1],s=h[z+2],H=h[B],K=h[B+1],N=h[B+2];e.add(A,G,D);e.add(q,x,s);e.add(H,K,N);A=new P(A,G,D);H=new P(H,K,N);q=(new P(q,x,s)).l().wa(A);x=H.l().wa(A);q=Jc(q,x).normalize();j[n]+=q.x;j[n+1]+=q.y;j[n+2]+=q.d;j[z]+=q.x;j[z+1]+=q.y;j[z+2]+=q.d;j[B]+=q.x;j[B+1]+=q.y;j[B+2]+=q.d}for(k=0;k<c;k++)n=3*k,s=g[n],q=g[n+1],x=g[n+2],n=3*s,z=3*q,B=3*x,f=new P(j[z],j[z+1],j[z+2]),h=new P(j[B],j[B+1],j[B+2]),n=(new P(j[n],j[n+1],j[n+2])).scale(1/l[s]).normalize(),f=f.scale(1/l[q]).normalize(),h=h.scale(1/l[x]).normalize(),
d.add(n.x,n.y,n.d),d.add(f.x,f.y,f.d),d.add(h.x,h.y,h.d);c=Z(this,"uchar",this.z.byteLength-this.r);g=t;for(n=0;n<c.length;n++)if(99==c[n]&&114==c[n+1]&&97==c[n+2]&&115==c[n+3]){for(d=g=n+9;10!=c[n]&&n<c.length;)d++,n++;g=We(c.subarray(g,d)).split(" ");break}g&&(b.ka.Mh(parseFloat(g[0])),b.ka.Nh(parseFloat(g[1])),b.ka.Oh(parseFloat(g[2])));b.Ia=jd;F.Ea(this.f+".parse");c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};C("X.parserFSM",Cf);C("X.parserFSM.prototype.parse",Cf.prototype.parse);var Df={pf:function(a,b,c){return Df.update(a,0,b,c)},update:function(a,b,c,e){var d=Df.Vh,f="number"===typeof c?c:c=0;e="number"===typeof e?e:a.length;b^=4294967295;for(f=e&7;f--;++c)b=b>>>8^d[(b^a[c])&255];for(f=e>>3;f--;c+=8)b=b>>>8^d[(b^a[c])&255],b=b>>>8^d[(b^a[c+1])&255],b=b>>>8^d[(b^a[c+2])&255],b=b>>>8^d[(b^a[c+3])&255],b=b>>>8^d[(b^a[c+4])&255],b=b>>>8^d[(b^a[c+5])&255],b=b>>>8^d[(b^a[c+6])&255],b=b>>>8^d[(b^a[c+7])&255];return(b^4294967295)>>>0}};
Df.Vh=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function Ef(a){var b=a.length,c=0,e=Number.POSITIVE_INFINITY,d,f,g,h,l,j,k,n,s;for(n=0;n<b;++n)a[n]>c&&(c=a[n]),a[n]<e&&(e=a[n]);d=1<<c;f=new Uint32Array(d);g=1;h=0;for(l=2;g<=c;){for(n=0;n<b;++n)if(a[n]===g){j=0;k=h;for(s=0;s<g;++s)j=j<<1|k&1,k>>=1;for(s=j;s<d;s+=l)f[s]=g<<16|n;++h}++g;h<<=1;l<<=1}return[f,c,e]};function Ff(a,b){this.mf=[];this.nf=32768;this.tb=this.Ed=this.N=this.bg=0;this.input=new Uint8Array(a);this.Hg=u;this.of=Gf;this.ab=u;if(b||!(b={}))b.index&&(this.N=b.index),b.bufferSize&&(this.nf=b.bufferSize),b.bufferType&&(this.of=b.bufferType),b.resize&&(this.ab=b.resize);switch(this.of){case Hf:this.ma=32768;this.Ya=new Uint8Array(32768+this.nf+258);break;case Gf:this.ma=0;this.Ya=new Uint8Array(this.nf);this.zc=this.Fi;this.Kg=this.ui;this.vf=this.zi;break;default:m(Error("invalid inflate mode"))}}
var Hf=0,Gf=1;
Ff.prototype.Kb=function(){for(;!this.Hg;){var a=If(this,3);a&1&&(this.Hg=r);a>>>=1;switch(a){case 0:var a=this.input,b=this.N,c=this.Ya,e=this.ma,d=p,f=p,g=p,h=c.length,d=p;this.tb=this.Ed=0;d=a[b++];d===p&&m(Error("invalid uncompressed block header: LEN (first byte)"));f=d;d=a[b++];d===p&&m(Error("invalid uncompressed block header: LEN (second byte)"));f|=d<<8;d=a[b++];d===p&&m(Error("invalid uncompressed block header: NLEN (first byte)"));g=d;d=a[b++];d===p&&m(Error("invalid uncompressed block header: NLEN (second byte)"));g|=
d<<8;f===~g&&m(Error("invalid uncompressed block header: length verify"));b+f>a.length&&m(Error("input buffer is broken"));switch(this.of){case Hf:for(;e+f>c.length;)d=h-e,f-=d,c.set(a.subarray(b,b+d),e),e+=d,b+=d,this.ma=e,c=this.zc(),e=this.ma;break;case Gf:for(;e+f>c.length;)c=this.zc({Rg:2});break;default:m(Error("invalid inflate mode"))}c.set(a.subarray(b,b+f),e);e+=f;this.N=b+=f;this.ma=e;this.Ya=c;break;case 1:this.vf(Jf,Kf);break;case 2:Lf(this);break;default:m(Error("unknown BTYPE: "+a))}}return this.Kg()};
var Mf=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Of=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Pf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Qf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rf=new Uint8Array(288),
Sf,Tf;Sf=0;for(Tf=Rf.length;Sf<Tf;++Sf)Rf[Sf]=143>=Sf?8:255>=Sf?9:279>=Sf?7:8;var Jf=Ef(Rf),Uf=new Uint8Array(30),Vf,Wf;Vf=0;for(Wf=Uf.length;Vf<Wf;++Vf)Uf[Vf]=5;var Kf=Ef(Uf);function If(a,b){for(var c=a.Ed,e=a.tb,d=a.input,f=a.N,g;e<b;)g=d[f++],g===p&&m(Error("input buffer is broken")),c|=g<<e,e+=8;g=c&(1<<b)-1;a.Ed=c>>>b;a.tb=e-b;a.N=f;return g}
function Xf(a,b){for(var c=a.Ed,e=a.tb,d=a.input,f=a.N,g=b[0],h=b[1],l;e<h;)l=d[f++],l===p&&m(Error("input buffer is broken")),c|=l<<e,e+=8;d=g[c&(1<<h)-1];g=d>>>16;a.Ed=c>>g;a.tb=e-g;a.N=f;return d&65535}
function Lf(a){function b(a,b,c){var d,e,f;for(f=0;f<a;)switch(d=Xf(this,b),d){case 16:for(d=3+If(this,2);d--;)c[f++]=e;break;case 17:for(d=3+If(this,3);d--;)c[f++]=0;e=0;break;case 18:for(d=11+If(this,7);d--;)c[f++]=0;e=0;break;default:e=c[f++]=d}return c}var c=If(a,5)+257,e=If(a,5)+1,d=If(a,4)+4,f=new Uint8Array(Mf.length),g;for(g=0;g<d;++g)f[Mf[g]]=If(a,3);d=Ef(f);f=new Uint8Array(c);g=new Uint8Array(e);a.vf(Ef(b.call(a,c,d,f)),Ef(b.call(a,e,d,g)))}w=Ff.prototype;
w.vf=function(a,b){var c=this.Ya,e=this.ma;this.Ng=a;for(var d=c.length-258,f,g,h;256!==(f=Xf(this,a));)if(256>f)e>=d&&(this.ma=e,c=this.zc(),e=this.ma),c[e++]=f;else{f-=257;h=Nf[f];0<Of[f]&&(h+=If(this,Of[f]));f=Xf(this,b);g=Pf[f];0<Qf[f]&&(g+=If(this,Qf[f]));e>=d&&(this.ma=e,c=this.zc(),e=this.ma);for(;h--;)c[e]=c[e++-g]}for(;8<=this.tb;)this.tb-=8,this.N--;this.ma=e};
w.zi=function(a,b){var c=this.Ya,e=this.ma;this.Ng=a;for(var d=c.length,f,g,h;256!==(f=Xf(this,a));)if(256>f)e>=d&&(c=this.zc(),d=c.length),c[e++]=f;else{f-=257;h=Nf[f];0<Of[f]&&(h+=If(this,Of[f]));f=Xf(this,b);g=Pf[f];0<Qf[f]&&(g+=If(this,Qf[f]));e+h>d&&(c=this.zc(),d=c.length);for(;h--;)c[e]=c[e++-g]}for(;8<=this.tb;)this.tb-=8,this.N--;this.ma=e};
w.zc=function(){var a=new Uint8Array(this.ma-32768),b=this.ma-32768,c=this.Ya;a.set(c.subarray(32768,a.length));this.mf.push(a);this.bg+=a.length;c.set(c.subarray(b,b+32768));this.ma=32768;return c};w.Fi=function(a){var b=this.input.length/this.N+1|0,c=this.input,e=this.Ya;a&&("number"===typeof a.Rg&&(b=a.Rg),"number"===typeof a.ni&&(b+=a.ni));2>b?(a=(c.length-this.N)/this.Ng[2],a=258*(a/2)|0,a=a<e.length?e.length+a:e.length<<1):a=e.length*b;a=new Uint8Array(a);a.set(e);return this.Ya=a};
w.Kg=function(){var a=0,b=this.Ya,c=this.mf,e,d=new Uint8Array(this.bg+(this.ma-32768)),f,g,h,l;if(0===c.length)return this.Ya.subarray(32768,this.ma);f=0;for(g=c.length;f<g;++f){e=c[f];h=0;for(l=e.length;h<l;++h)d[a++]=e[h]}f=32768;for(g=this.ma;f<g;++f)d[a++]=b[f];this.mf=[];return this.buffer=d};w.ui=function(){var a,b=this.ma;this.ab?(a=new Uint8Array(b),a.set(this.Ya.subarray(0,b))):a=this.Ya.subarray(0,b);return this.buffer=a};new Uint8Array(256);var Yf;for(Yf=0;256>Yf;++Yf)for(var Zf=Yf,$f=7,Zf=Zf>>>1;Zf;Zf>>>=1)--$f;var ag=[],bg;for(bg=0;288>bg;bg++)switch(r){case 143>=bg:ag.push([bg+48,8]);break;case 255>=bg:ag.push([bg-144+400,9]);break;case 279>=bg:ag.push([bg-256+0,7]);break;case 287>=bg:ag.push([bg-280+192,8]);break;default:m("invalid literal: "+bg)}
function cg(){var a=dg;switch(r){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-
31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:m("invalid length: "+a)}}var eg=[],dg,fg;
for(dg=3;258>=dg;dg++)fg=cg(),eg[dg]=fg[2]<<24|fg[1]<<16|fg[0];new Uint32Array(eg);function gg(){};function hg(a){this.input=a;this.N=0;this.member=[]}
hg.prototype.Kb=function(){for(var a=this.input.length;this.N<a;){var b=new gg,c=p,e=p,d=p,f=c=d=p,g=p,c=c=p,h=this.input,e=this.N;b.Xg=h[e++];b.Yg=h[e++];(31!==b.Xg||139!==b.Yg)&&m(Error("invalid file signature:",b.Xg,b.Yg));b.Jg=h[e++];switch(b.Jg){case 8:break;default:m(Error("unknown compression method: "+b.Jg))}b.pe=h[e++];c=h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24;b.am=new Date(1E3*c);b.lm=h[e++];b.fm=h[e++];0<(b.pe&4)&&(b.Ke=h[e++]|h[e++]<<8,e+=b.Ke);if(0<(b.pe&8)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=
String.fromCharCode(c);b.name=g.join("")}if(0<(b.pe&16)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=String.fromCharCode(c);b.comment=g.join("")}0<(b.pe&2)&&(b.vi=Df.pf(h,0,e)&65535,b.vi!==(h[e++]|h[e++]<<8)&&m(Error("invalid header crc16")));c=h[h.length-4]|h[h.length-3]<<8|h[h.length-2]<<16|h[h.length-1]<<24;h.length-e-4-4<512*c&&(d=c);e=new Ff(h,{index:e,bufferSize:d});b.data=d=e.Kb();e=e.N;b.Ll=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;Df.pf(d)!==c&&m(Error("invalid CRC-32 checksum: 0x"+Df.pf(d).toString(16)+
" / 0x"+c.toString(16)));b.Ul=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;(d.length&4294967295)!==c&&m(Error("invalid input size: "+(d.length&4294967295)+" / "+c));this.member.push(b);this.N=e}a=this.member;b=d=e=0;for(h=a.length;b<h;++b)d+=a[b].data.length;d=new Uint8Array(d);for(b=0;b<h;++b)d.set(a[b].data,e),e+=a[b].data.length;return d};function ig(){Y.call(this);this.f="parserMGZ";this.nc=u}E(ig,Y);
ig.prototype.parse=function(a,b,c,e){F.La(this.f+".parse");window.console.log(b);e&&(c=(new hg(new Uint8Array(c))).Kb(),c=c.buffer);e=this.Nb(c);var d=[e.Gf,e.Hf,e.If];b.da=d;var f=e.Ph;b.sb=f;c=e.min;var g=e.max;b.pa=b.$=c;b.fa=b.Z=g;-Infinity==b.R&&(b.R=c);Infinity==b.T&&(b.T=g);c=Sc();if("false"==b.reslicing||b.reslicing==u)Q(c,0,b.sb[0],0,0,0),Q(c,1,0,b.sb[1],0,0),Q(c,2,0,0,b.sb[2],0),Q(c,3,0,0,0,1),Vc(c,0,0,0,1);else{Q(c,0,e.jb[0][0],e.jb[1][0],e.jb[2][0],0);Q(c,1,e.jb[0][1],e.jb[1][1],e.jb[2][1],
0);Q(c,2,e.jb[0][2],e.jb[1][2],e.jb[2][2],0);Q(c,3,0,0,0,1);for(var g=d[0]/2,h=d[1]/2,d=d[2]/2,l=[0,0,0],j=0;3>j;++j)l[j]=e.jb[3][j]-(c[j+0]*f[0]*g+c[j+4]*f[1]*h+c[j+8]*f[2]*d);Vc(c,l[0],l[1],l[2],1)}e.Ja=c;e.Ka=Sc();ad(e.Ja,e.Ka);g=Rc(0,0,0,1);f=Qc();cd(c,g,f);h=Rc(1,1,1,1);g=Qc();cd(c,h,g);c=Xe(c,b.da);e.Sb=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];e.Qb=[c[1]-c[0]+1,c[3]-c[2]+1,c[5]-c[4]+1];e.Rb=[c[0],c[2],c[4]];b.Bb(e);F.Ea(this.f+".parse");b.Ra=bf(this,b);e=new md;e.F=b;e.v=a;this.dispatchEvent(e)};
ig.prototype.Nb=function(a){this.z=a;a={version:0,Yh:0,Wh:0,Mi:0,Xh:0,Gf:0,Hf:0,If:0,yj:0,type:0,Di:0,Dh:0,Pk:t,jb:t,Ph:t,data:t,min:Infinity,max:-Infinity};a.version=Z(this,"uint");a.Gf=Z(this,"uint");a.Hf=Z(this,"uint");a.If=Z(this,"uint");a.yj=Z(this,"uint");a.type=Z(this,"uint");a.Di=Z(this,"uint");a.Dh=Z(this,"ushort");if(0<a.Dh){a.Ph=Z(this,"float",3);var b=[];b.push(Z(this,"float",3));b.push(Z(this,"float",3));b.push(Z(this,"float",3));b.push(Z(this,"float",3));a.jb=b}this.r=284;b=a.Gf*a.Hf*
a.If;switch(a.type){case 0:a.data=Z(this,"uchar",b);break;case 1:a.data=Z(this,"uint",b);break;case 3:a.data=Z(this,"float",b);break;case 4:a.data=Z(this,"ushort",b);break;default:m(Error("Unsupported MGH/MGZ data type: "+a.type))}b=Ve(a.data);a.min=b[0];a.max=b[1];this.r+16<this.z.byteLength&&(a.Yh=Z(this,"float"),a.Mi=Z(this,"float"),a.Wh=Z(this,"float"),a.Xh=Z(this,"float"));return a};C("X.parserMGZ",ig);C("X.parserMGZ.prototype.parse",ig.prototype.parse);function jg(){Y.call(this);this.f="parserLBL"}E(jg,Y);
jg.prototype.parse=function(a,b,c){F.La(this.f+".parse");var e=b.Uc,d=e.length;0==d&&m(Error("No _pointIndices defined on the X.object."));this.z=c;var f=[],g=Z(this,"uchar",c.byteLength),h=g.length,l=u,j=0;for(c=1;c<h;c++)10==g[c-1]?(j=c,l=r):l&&32==g[c]&&(f.push(parseInt(We(g,j,c),10)),l=u);g=b.H.K?b.H.K:new Float32Array(d);h=f.length;for(c=0;c<h;c++)g[f[c]]=1;f=new Float32Array(3*d);for(c=h=0;c<d;c++)l=e[c],l>d&&m(Error("Could not find scalar for vertex.")),l=g[l],f[h++]=l,f[h++]=l,f[h++]=l;b.H.K=
g;b.H.md=f;b.H.j=r;F.Ea(this.f+".parse");e=new md;e.F=b;e.v=a;this.dispatchEvent(e)};C("X.parserLBL",jg);C("X.parserLBL.prototype.parse",jg.prototype.parse);function kg(){Y.call(this);this.f="parserCRV";this.nc=u}E(kg,Y);
kg.prototype.parse=function(a,b,c){F.La(this.f+".parse");var e=b.Uc;0==e.length&&m(Error("No _pointIndices defined on the X.object."));this.z=c;this.r=3;var d=Z(this,"uint");Z(this,"uint");Z(this,"uint");var f=0,g=0,h=0,l=0,j=0,k=0,n=0,s=0,q=0,x=0,z=0;c=Array(2);var B=Array(2),A=Z(this,"float",d),G;for(G=0;G<d;G++){var D=A[G];0==G&&(c[0]=B[0]=D);0<=D?(f++,l+=D):(g++,h+=D);q+=D;z++;B[0]=Math.max(D,B[0]);c[0]=Math.min(D,c[0]);A[G]=D}0!=f&&(j=l/f);0!=g&&(k=h/g);0!=z&&(x=q/z);for(z=q=h=l=0;z<d;z++)D=
A[z],G=0,0<=D?(G=Math.pow(D-j,2),l+=G):(G=Math.pow(D-k,2),h+=G),G=Math.pow(D-x,2),q+=G;1<f&&(n=Math.sqrt(l/(f-1)));1<g&&(s=Math.sqrt(h/(g-1)));c[1]=k-2.5*s;B[1]=j+2.5*n;d=e.length;f=new Float32Array(3*d);for(z=0;z<d;z++)g=A[e[z]],h=3*z,f[h]=g,f[h+1]=g,f[h+2]=g;b.H.pa=c[1];b.H.fa=B[1];-Infinity==b.H.R&&(b.H.R=c[1]);Infinity==b.H.T&&(b.H.T=B[1]);b.H.K=A;b.H.md=f;b.H.j=r;F.Ea(this.f+".parse");e=new md;e.F=b;e.v=a;this.dispatchEvent(e)};C("X.parserCRV",kg);C("X.parserCRV.prototype.parse",kg.prototype.parse);function lg(a,b){var c,e;this.input=a;this.N=0;if(b||!(b={}))b.index&&(this.N=b.index),b.verify&&(this.Gk=b.verify);c=a[this.N++];e=a[this.N++];switch(c&15){case 8:this.method=8;break;default:m(Error("unsupported compression method"))}0!==((c<<8)+e)%31&&m(Error("invalid fcheck flag:"+((c<<8)+e)%31));e&32&&m(Error("fdict flag is not supported"));this.Eh=new Ff(a,{index:this.N,bufferSize:b.bufferSize,bufferType:b.bufferType,resize:b.resize})}
lg.prototype.Kb=function(){var a=this.input,b;b=this.Eh.Kb();this.N=this.Eh.N;if(this.Gk){var a=(a[this.N++]<<24|a[this.N++]<<16|a[this.N++]<<8|a[this.N++])>>>0,c=b;if("string"===typeof c){var c=c.split(""),e,d;e=0;for(d=c.length;e<d;e++)c[e]=(c[e].charCodeAt(0)&255)>>>0}e=1;d=0;for(var f=c.length,g,h=0;0<f;){g=1024<f?1024:f;f-=g;do e+=c[h++],d+=e;while(--g);e%=65521;d%=65521}a!==(d<<16|e)>>>0&&m(Error("invalid adler-32 checksum"))}return b};function mg(){Y.call(this);this.f="parserRAW"}E(mg,Y);
mg.prototype.parse=function(a,b,c,e){F.La(this.f+".parse");e&&(c=(new lg(new Uint8Array(c))).Kb(),c=c.buffer);e={};e.data=new Uint8Array(c);var d=Ve(e.data);c=d[0];d=d[1];e.min=b.pa=b.$=c;e.max=b.fa=b.Z=d;-Infinity==b.R&&(b.R=c);Infinity==b.T&&(b.T=d);d=Tc();e.Ja=d;e.Ka=Tc();var f=Rc(0,0,0,1);c=Qc();cd(d,f,c);var g=Rc(1,1,1,1),f=Qc();cd(d,g,f);d=Xe(d,b.da);e.Sb=[f[0]-c[0],f[1]-c[1],f[2]-c[2]];e.Qb=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];e.Rb=[d[0],d[2],d[4]];b.Bb(e);F.Ea(this.f+".parse");b.Ra=bf(this,
b);e=new md;e.F=b;e.v=a;this.dispatchEvent(e)};C("X.parserRAW",mg);C("X.parserRAW.prototype.parse",mg.prototype.parse);var ng=[];function og(){Y.call(this);this.f="parserTIFF"}E(og,Y);og.prototype.parse=function(a,b,c){c=this.Nb(c);var e=pg(b);ng.push({fk:this,Jf:e,Ff:c});qg(c,b);b.Bb(c);b.Ra=bf(this,b);c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
function qg(a,b){var c=a.min,e=a.max;b.pa=b.$=c;b.fa=b.Z=e;-Infinity==b.R&&(b.R=c);Infinity==b.T&&(b.T=e);c=Sc();Q(c,3,0,0,0,1);if("false"==b.reslicing||b.reslicing==u){var d=e=1,f=1;0<a.A[1]&&(e=a.A[1]);0<a.A[2]&&(d=a.A[2]);0<a.A[2]&&(f=a.A[3]);0>a.A[0]&&(f=-f);Q(c,0,e,0,0,0);Q(c,1,0,d,0,0);Q(c,2,0,0,f,0)}else Q(c,0,a.A[1],0,0,0),Q(c,1,0,a.A[2],0,0),Q(c,2,0,0,a.A[3],0);a.Ja=c;a.Ka=Sc();ad(a.Ja,a.Ka);d=Rc(0,0,0,1);e=Qc();cd(c,d,e);f=Rc(1,1,1,1);d=Qc();cd(c,f,d);f=[a.Xa[1],a.Xa[2],a.Xa[3]];c=Xe(c,
f);a.Sb=[d[0]-e[0],d[1]-e[1],d[2]-e[2]];a.Qb=[c[1]-c[0]+1,c[3]-c[2]+1,c[5]-c[4]+1];a.Rb=[c[0],c[2],c[4]];b.da=f}
var rg={NEW_SUBFILE_TYPE:254,IMAGE_WIDTH:256,IMAGE_LENGTH:257,BITS_PER_SAMPLE:258,COMPRESSION:259,PHOTO_INTERP:262,FILL_ORDER:266,IMAGE_DESCRIPTION:270,STRIP_OFFSETS:273,ORIENTATION:274,SAMPLES_PER_PIXEL:277,ROWS_PER_STRIP:278,STRIP_BYTE_COUNT:279,X_RESOLUTION:282,Y_RESOLUTION:283,PLANAR_CONFIGURATION:284,RESOLUTION_UNIT:296,SOFTWARE:305,DATE_TIME:306,ARTEST:315,HOST_COMPUTER:316,PREDICTOR:317,COLOR_MAP:320,TILE_WIDTH:322,SAMPLE_FORMAT:339,JPEG_TABLES:347,YCBCR_SUBSAMPLING:530,YCBCR_POSITIONING:531,
METAMORPH1:33628,METAMORPH2:33629,IPLAB:34122,NIH_IMAGE_HDR:43314,META_DATA_BYTE_COUNTS:50838,META_DATA:50839};function sg(){this.Ne=this.Fl=-1;this.z=t}var tg={mj:r,Df:0,Xa:t,dd:0,A:t,rf:1,Fh:u,d:-1,data:[],Og:[],Hd:[],min:Infinity,max:-Infinity};
og.prototype.Nb=function(a){function b(a){return-1!=Object.prototype.toString.call(a).match(/[object .*Array]/)?a.length:0}this.z=a;tg.A=[0,1,1,1,0,0,0,0];a=Z(this,"ushort");tg.mj=this.nc=18761==a;tg.Df=Z(this,"ushort");"42"!=tg.Df&&m(Error("Invalid TIFF file. Magicnumber: "+tg.Df));for(this.r=Z(this,"uint");;){var c=new sg;c.Ne=Z(this,"ushort");var e=this.r;for(a=0;a<c.Ne;a+=1){var d=Z(this,"ushort"),f=Z(this,"ushort"),g=Z(this,"uint"),h="uint",l=-1,j=t;switch(f){case 1:case 2:h="uchar";l=1;break;
case 3:h="ushort";l=2;break;case 4:h="uint";l=4;break;case 5:h="uint",l=4,g=2}if(4<g*l)j=Z(this,"uint"),f=this.r,this.r=j,j=Z(this,h,g),this.r=f;else if(j=Z(this,h,g),273==d||279==d)g=[],g.push(j),j=g;this.r=e+(12*a+12);for(var k in rg)if(rg[k]==d){c[k]=j;break}}a=c.STRIP_OFFSETS;g=c.STRIP_BYTE_COUNT;d=c.BITS_PER_SAMPLE;b(d)&&(d=d[0]);h="uchar";j=1;f=Uint8Array;switch(d){case 16:h="ushort";j=2;f=Uint16Array;break;case 32:h="float",j=4,f=Uint32Array}l=t;if(1==a.length)this.r=a[0],l=Z(this,h,g[0]/j);
else{for(d=l=0;d<g.length;d+=1)l+=g[d];l/=j;l=new f(l);for(d=0;d<a.length;d+=1)this.r=a[d],f=Z(this,h,g[d]/j),l.set(f,d*(g[d]/j))}d=l;c.z=d;tg.Hd.push(c);this.r=e+12*c.Ne;a=Z(this,"uint");if(0==a){e=tg.Hd[0];a=e.IMAGE_WIDTH;k=e.IMAGE_LENGTH;if(c=e.IMAGE_DESCRIPTION){d=[];g=c.length;for(h=0;h<g;h+=32768)h+32768>g?d.push(String.fromCharCode.apply(t,c.subarray(h,g-1))):d.push(String.fromCharCode.apply(t,c.subarray(h,h+32768)));c=d.join("");-1!=c.search(/^ImageJ=/)?(c=c.match(/spacing=\d[.]\d*/),c!=t&&
(c=c[0],c=c.match(/\d[.]\d*/),c=parseFloat(c[0]),tg.A=[0,c,c,c,0,0,0,0])):-1!=c.search(/xml /)&&(d=p,window.DOMParser?d=(new DOMParser).parseFromString(c,"text/xml"):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async=u,d.loadXML(c)),j=d.getElementsByTagName("Pixels")[0],f=j.getAttributeNode("PhysicalSizeX"),c=NaN==Number(f.nodeValue)?1:Number(f.nodeValue),f=j.getAttributeNode("PhysicalSizeY"),d=NaN==Number(f.nodeValue)?1:Number(f.nodeValue),f=j.getAttributeNode("PhysicalSizeZ"),g=NaN==Number(f.nodeValue)?
1:Number(f.nodeValue),f=j.getAttributeNode("SizeC"),h=NaN==Number(f.nodeValue)?1:Number(f.nodeValue),f=j.getAttributeNode("SizeZ"),j=NaN==Number(f.nodeValue)?-1:Number(f.nodeValue),tg.rf=h,tg.d=j,tg.A=[0,c,d,g,0,0,0,0])}else window.console.log("BAD BAD BAD.. IMAGE_DESCRIPTION");c=-1!=tg.d?tg.d:tg.Hd.length;d=e.BITS_PER_SAMPLE;e=tg.Fh=2==e.PHOTO_INTERP?r:u;tg.Xa=[4,a,k,c,1,1,0,0];tg.dd=e&&b(d)?d[0]:d;g=[];h=a*k*c;k*=a;a:{switch(tg.dd){case 16:j=Uint16Array;break a;case 32:j=Uint32Array;break a}j=Uint8Array}for(var n=
l=f=0,s=0,q=0;;){e?(f=g.push(new j(h))-1,l=g.push(new j(h))-1,n=g.push(new j(h))-1):s=g.push(new j(h))-1;for(a=0;a<c;a++)if(d=q+a,d=tg.Hd[d].z,e){for(var x=new j(k),z=new j(k),B=new j(k),A=0;A<k;A+=1)x[A]=d[A],z[A]=d[A+k],B[A]=d[A+2*k];g[f].set(x,a*k);g[l].set(z,a*k);g[n].set(B,a*k)}else g[s].set(d,a*k);q+=c;if(q>=tg.Hd.length)break}tg.Og=g;tg.data=g[0];a=Ve(tg.data);tg.max=a[1];tg.min=a[0];break}else this.r=a}return tg};
og.prototype.lk=function(a,b){for(var c=pg(a),e=t,d=t,f=0;f<ng.length;f+=1){var g=ng[f];if(g.Jf==c){e=g.Ff;d=g.fk;break}}e==t&&m(Error("Invalid TIFF cache entry"));c=e;e=c.rf;b<e||m(Error("Invalid channel, value out of bound, max is "+e));c.data=c.Og[b];e=Ve(c.data);c.max=e[1];c.min=e[0];e=c;qg(e,a);a.xa=e.Rb;a.Ec=e.Sb;a.fb=e.Qb;a.ic=e.Ja;a.jg=e.Ka;a.fa=e.max;a.z=e.data;a.j=r;c=a.c[0];c.visible=u;c=a.c[1];c.visible=u;c=a.c[2];c.visible=u;a.Ra=bf(d,a)};
function pg(a){return a.s.td.split("/").pop().replace(/\./g,"_")}og.prototype.kj=function(a){a=pg(a);for(var b=t,c=0;c<ng.length;c+=1){var e=ng[c];if(e.Jf==a){b=e.Ff;break}}b==t&&m(Error("Invalid TIFF cache entry"));return b.Fh};og.prototype.jj=function(a){a=pg(a);for(var b=t,c=0;c<ng.length;c+=1){var e=ng[c];if(e.Jf==a){b=e.Ff;break}}b==t&&m(Error("Invalid TIFF cache entry"));return b.rf};C("X.parserTIFF",og);C("X.parserTIFF.prototype.parse",og.prototype.parse);
C("X.parserTIFF.prototype.resetChannel",og.prototype.lk);C("X.parserTIFF.prototype.isTiffRGB",og.prototype.kj);C("X.parserTIFF.prototype.isTiffMultiChannel",og.prototype.jj);function ug(){Y.call(this);this.f="parserLUT"}E(ug,Y);
ug.prototype.parse=function(a,b,c){F.La(this.f+".parse");this.z=c;c=Z(this,"uchar",c.byteLength);var e=c.length,d=0,f;for(f=0;f<e;f++)if(10==c[f]){var g=We(c,d,f),d=f+1,g=g.replace(/^\s+|\s+$/g,"");"#"!=g[0]&&(g=g.split(" "),g=g.filter(function(a){return""!=a}),6==g.length&&(g[2]=parseInt(g[2],10)/255,g[3]=parseInt(g[3],10)/255,g[4]=parseInt(g[4],10)/255,g[5]=parseInt(g[5],10)/255,a.add(parseInt(g[0],10),g[1],g[2],g[3],g[4],g[5],10)))}F.Ea(this.f+".parse");c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
C("X.parserLUT",ug);C("X.parserLUT.prototype.parse",ug.prototype.parse);function vg(){Y.call(this);this.f="parserMRC"}E(vg,Y);
vg.prototype.parse=function(a,b,c){F.La(this.f+".parse");c=this.Nb(c);var e=c.min,d=c.max;b.da=[c.Kd,c.Ld,c.Md];b.sb=[c.Ke/c.kh,c.Sh/c.lh,c.Th/c.mh];b.pa=b.$=e;b.fa=b.Z=d;-Infinity==b.R&&(b.R=e);Infinity==b.T&&(b.T=d);d=Sc();Q(d,3,0,0,0,1);Q(d,0,-1,0,0,c.Kd);Q(d,1,0,0,-1,c.Ld);Q(d,2,0,-1,0,c.Md);c.Ja=d;c.Ka=Sc();ad(c.Ja,c.Ka);var f=Rc(0,0,0,1),e=Qc();cd(d,f,e);var g=Rc(1,1,1,1),f=Qc();cd(d,g,f);g=[c.Kd,c.Ld,c.Md];d=Xe(d,g);c.Sb=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];c.Qb=[d[1]+d[0]+1,d[3]-d[2]+1,d[5]-d[4]+
1];c.Rb=[d[0],d[2],d[4]];b.da=g;b.Bb(c);b.Ra=bf(this,b);F.Ea(this.f+".parse");c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
vg.prototype.Nb=function(a){this.z=a;a={Kd:0,Ld:0,Md:0,mode:0,cm:0,dm:0,em:0,kh:0,lh:0,mh:0,Ke:0,Sh:0,Th:0,alpha:0,qi:0,Ni:0,qj:0,rj:0,sj:0,kf:0,ke:0,wc:0,Wl:0,next:0,wi:0,Hi:t,zj:0,Bj:0,Hi:t,aj:0,Tl:0,Zi:0,lj:0,vj:0,wj:0,Ek:0,Fk:0,Bk:t,Hk:0,Jk:0,Kk:0,Kl:0,km:0,nk:0,Aj:0,data:t,min:Infinity,max:-Infinity,$l:0,Ih:t,jm:t,hm:t,orientation:t,bm:t};this.r=0;a.Kd=Z(this,"sint");a.Ld=Z(this,"sint");a.Md=Z(this,"sint");a.mode=Z(this,"sint");var b=a.Kd*a.Ld*a.Md;this.r=1024;switch(a.mode){case 0:a.data=Z(this,
"schar",b);break;case 1:a.data=Z(this,"sshort",b);break;case 2:a.data=Z(this,"float",b);break;case 3:a.data=Z(this,"uint",b);break;case 4:a.data=Z(this,"double",b);break;case 6:a.data=Z(this,"ushort",b);break;case 16:a.data=Z(this,"uchar",b);break;default:m(Error("Unsupported MRC data type: "+a.mode))}this.r=28;a.kh=Z(this,"sint");a.lh=Z(this,"sint");a.mh=Z(this,"sint");a.Ke=Z(this,"float");a.Sh=Z(this,"float");a.Th=Z(this,"float");a.alpha=Z(this,"float");a.qi=Z(this,"float");a.Ni=Z(this,"float");
a.qj=Z(this,"sint");a.rj=Z(this,"sint");a.sj=Z(this,"sint");a.kf=Z(this,"float");a.ke=Z(this,"float");a.wc=Z(this,"float");a.Vl=Z(this,"sint");a.next=Z(this,"sint");a.wi=Z(this,"short");a.zj=Z(this,"short");a.Bj=Z(this,"short");a.aj=Z(this,"sint");a.Sl=Z(this,"sint");a.Zi=Z(this,"short");a.lj=Z(this,"short");a.vj=Z(this,"short");a.wj=Z(this,"short");a.Ek=Z(this,"short");a.Fk=Z(this,"short");a.Bk=Z(this,"float",6);this.r=196;a.Hk=Z(this,"float");a.Jk=Z(this,"float");a.Kk=Z(this,"float");this.r=216;
a.nk=Z(this,"float");a.Aj=Z(this,"sint");a.Xl=Z(this,"schar",10);if(0!=a.next)switch(this.r=parseInt(a.next+1024,10),a.mode){case 0:a.data=Z(this,"schar",b);break;case 1:a.data=Z(this,"sshort",b);break;case 2:a.data=Z(this,"float",b);break;case 3:a.data=Z(this,"uint",b);break;case 4:a.data=Z(this,"double",b);break;case 6:a.data=Z(this,"ushort",b);break;case 16:a.data=Z(this,"uchar",b);break;default:m(Error("Unsupported MRC data type: "+a.mode))}0>a.wc-(a.ke-a.wc)?(a.min=a.kf,a.max=a.wc+(a.wc-a.kf)):
(a.min=a.wc-(a.ke-a.wc),a.max=a.ke);return a};C("X.parserMRC",vg);C("X.parserMRC.prototype.parse",vg.prototype.parse);function wg(){Y.call(this);this.f="parserNRRD"}E(wg,Y);
wg.prototype.parse=function(a,b,c){F.La(this.f+".parse");this.z=c;c=Z(this,"uchar",c.byteLength);var e=c.length,d=t,f=0,g;for(g=1;g<e;g++)if(10==c[g-1]&&10==c[g]){d=We(c,0,g-2);f=g+1;break}var h,l,j,k,e=d.split(/\r?\n/),d=0;for(g=e.length;d<g;d++)if(h=e[d],h.match(/NRRD\d+/))this.hj=r;else if(!h.match(/^#/)&&(k=h.match(/(.*):(.*)/)))l=k[1].trim(),h=k[2].trim(),(j=this.Ii[l])?j.call(this,h):this[l]=h;this.hj||m(Error("Not an NRRD file"));"raw"!==this.encoding&&("gzip"!==this.encoding&&"gz"!==this.encoding)&&
m(Error("Only raw or gz/gzip encoding is allowed"));if(!this.ja&&(this.ja=[new P(1,0,0),new P(0,1,0),new P(0,0,1)],this.$f)){e=[];for(k=0;2>=k;k++)e.push(!isNaN(this.$f[k])?this.ja[k].scale(this.$f[k]):p)}f=c.subarray(f);if("gzip"==this.encoding||"gz"==this.encoding)f=(new hg(new Uint8Array(f))).Kb();f=f.buffer;c={data:t,min:Infinity,max:-Infinity};c.data=new this.Tb(f);k=Ve(c.data);f=c.min=k[0];k=c.max=k[1];b.pa=b.$=f;b.fa=b.Z=k;b.da=[this.Yf[0],this.Yf[1],this.Yf[2]];e=(new P(this.ja[0][0],this.ja[0][1],
this.ja[0][2])).Mb();d=(new P(this.ja[1][0],this.ja[1][1],this.ja[1][2])).Mb();g=(new P(this.ja[2][0],this.ja[2][1],this.ja[2][2])).Mb();b.sb=[e,d,g];-Infinity==b.R&&(b.R=f);Infinity==b.T&&(b.T=k);e=k=1;"left-posterior-superior"==this.Ih&&(e=k=-1);f=Tc();"false"==b.reslicing||b.reslicing==u?(Q(f,0,k,0,0,0),Q(f,1,0,e,0,0),Q(f,2,0,0,1,0)):(Q(f,0,k*this.ja[0][0],k*this.ja[1][0],k*this.ja[2][0],k*this.Zf[0]),Q(f,1,e*this.ja[0][1],e*this.ja[1][1],e*this.ja[2][1],e*this.Zf[1]),Q(f,2,1*this.ja[0][2],1*this.ja[1][2],
1*this.ja[2][2],1*this.Zf[2]));Q(f,3,0,0,0,1);c.Ja=f;c.Ka=Sc();ad(c.Ja,c.Ka);e=Rc(0,0,0,1);k=Qc();cd(f,e,k);d=Rc(1,1,1,1);e=Qc();cd(f,d,e);f=Xe(f,b.da);c.Sb=[e[0]-k[0],e[1]-k[1],e[2]-k[2]];c.Qb=[f[1]-f[0]+1,f[3]-f[2]+1,f[5]-f[4]+1];c.Rb=[f[0],f[2],f[4]];b.Bb(c);F.Ea(this.f+".parse");b.Ra=bf(this,b);c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
wg.prototype.Ii={type:function(a){switch(a){case "uchar":case "unsigned char":case "uint8":case "uint8_t":this.Tb=Uint8Array;break;case "signed char":case "int8":case "int8_t":this.Tb=Int8Array;break;case "short":case "short int":case "signed short":case "signed short int":case "int16":case "int16_t":this.Tb=Int16Array;break;case "ushort":case "unsigned short":case "unsigned short int":case "uint16":case "uint16_t":this.Tb=Uint16Array;break;case "int":case "signed int":case "int32":case "int32_t":this.Tb=
Int32Array;break;case "uint":case "unsigned int":case "uint32":case "uint32_t":this.Tb=Uint32Array;break;case "float":this.Tb=Float32Array;break;case "double":this.Tb=Float64Array;break;default:m(Error("Unsupported NRRD data type: "+a))}return this.type=a},endian:function(a){return this.Pl=a},encoding:function(a){return this.encoding=a},dimension:function(a){return this.Xa=parseInt(a,10)},sizes:function(a){var b,c,e,d;e=a.split(/\s+/);d=[];b=0;for(c=e.length;b<c;b++)a=e[b],d.push(parseInt(a,10));
return this.Yf=d},space:function(a){return this.Ih=a},"space origin":function(a){return this.Zf=a.split("(")[1].split(")")[0].split(",")},"space directions":function(a){var b,c;a=a.match(/\(.*?\)/g);var e,d,f;f=[];e=0;for(d=a.length;e<d;e++)c=a[e],f.push(function(){var a,d,e,f;e=c.slice(1,-1).split(/,/);f=[];a=0;for(d=e.length;a<d;a++)b=e[a],f.push(parseFloat(b));return f}());return this.ja=f},spacings:function(a){var b;b=a.split(/\s+/);var c,e,d;d=[];c=0;for(e=b.length;c<e;c++)a=b[c],d.push(parseFloat(a));
return this.$f=d}};C("X.parserNRRD",wg);C("X.parserNRRD.prototype.parse",wg.prototype.parse);function xg(){Y.call(this);this.f="parserSTL"}E(xg,Y);
xg.prototype.parse=function(a,b,c){F.La(this.f+".parse");this.z=c;var e=b.h,d=b.n;if("solid"==We(Z(this,"uchar",5))){b.h=e=new T(c.byteLength);b.n=d=new T(c.byteLength);var f=e,e=d,d=Z(this,"uchar",c.byteLength-5);c=d.length;var g=u,h=u,l=0,j;for(j=0;j<c;j++)if(10==d[j]){if(g||h){var k=We(d,l,j).split(" "),h=parseFloat(k[0]),n=parseFloat(k[1]),k=parseFloat(k[2]);g?(e.add(h,n,k),e.add(h,n,k),e.add(h,n,k)):f.add(h,n,k);h=g=u}}else 32==d[j-1]&&(102==d[j]?(l=j+=13,g=r):118==d[j]&&(l=j+=7,h=r))}else{this.r=
80;f=Z(this,"uint");b.h=e=new T(9*f);b.n=d=new T(9*f);for(c=c=0;c<f;c++)g=Z(this,"float",12),l=g[0],j=g[1],h=g[2],d.add(l,j,h),d.add(l,j,h),d.add(l,j,h),e.add(g[3],g[4],g[5]),e.add(g[6],g[7],g[8]),e.add(g[9],g[10],g[11]),this.r+=2}F.Ea(this.f+".parse");f=new md;f.F=b;f.v=a;this.dispatchEvent(f)};C("X.parserSTL",xg);C("X.parserSTL.prototype.parse",xg.prototype.parse);function yg(){Y.call(this);this.f="parserNII"}E(yg,Y);
yg.prototype.parse=function(a,b,c){if(!zg(c))try{c=(new hg(new Uint8Array(c))).Kb().buffer,zg(c)||(this.nc=u)}catch(e){this.nc=u}c=this.Nb(c);var d=c.min,f=c.max;b.pa=b.$=d;b.fa=b.Z=f;-Infinity==b.R&&(b.R=d);Infinity==b.T&&(b.T=f);d=Sc();Q(d,3,0,0,0,1);if("false"==b.reslicing||b.reslicing==u){var g=f=1,h=1;0<c.A[1]&&(f=c.A[1]);0<c.A[2]&&(g=c.A[2]);0<c.A[2]&&(h=c.A[3]);0>c.A[0]&&(h=-h);Q(d,0,f,0,0,0);Q(d,1,0,g,0,0);Q(d,2,0,0,h,0)}else if(0<c.Uf){var l=0,j=c.Ah,k=c.Bh,n=c.Ch,h=g=f=1,s=c.xh,q=c.yh,x=
c.zh,l=1-(j*j+k*k+n*n);1E-7>l?(l=1/Math.sqrt(j*j+k*k+n*n),j*=l,k*=l,n*=l,l=0):l=Math.sqrt(l);0<c.A[1]&&(f=c.A[1]);0<c.A[2]&&(g=c.A[2]);0<c.A[2]&&(h=c.A[3]);0>c.A[0]&&(h=-h);Q(d,0,(l*l+j*j-k*k-n*n)*f,2*(j*k-l*n)*g,2*(j*n+l*k)*h,s);Q(d,1,2*(j*k+l*n)*f,(l*l+k*k-j*j-n*n)*g,2*(k*n-l*j)*h,q);Q(d,2,2*(j*n-l*k)*f,2*(k*n+l*j)*g,(l*l+n*n-k*k-j*j)*h,x)}else 0<c.Gh?(f=c.Jh,g=c.Kh,h=c.Lh,Q(d,0,f[0],f[1],f[2],f[3]),Q(d,1,g[0],g[1],g[2],g[3]),Q(d,2,h[0],h[1],h[2],h[3])):0==c.Uf?(Q(d,0,c.A[1],0,0,0),Q(d,1,0,c.A[2],
0,0),Q(d,2,0,0,c.A[3],0)):window.console.log("UNKNOWN METHOD IN PARSER NII");c.Ja=d;c.Ka=Sc();ad(c.Ja,c.Ka);g=Rc(0,0,0,1);f=Qc();cd(d,g,f);h=Rc(1,1,1,1);g=Qc();cd(d,h,g);h=[c.Xa[1],c.Xa[2],c.Xa[3]];d=Xe(d,h);c.Sb=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];c.Qb=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.Rb=[d[0],d[2],d[4]];b.da=h;b.Bb(c);b.Ra=bf(this,b);c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};
yg.prototype.Nb=function(a){this.z=a;a={sk:0,xi:t,yi:t,Gi:0,qk:0,jk:0,Ci:t,Xa:t,dj:0,ej:0,fj:0,bj:0,dd:0,ri:0,xk:0,A:t,Qh:0,pk:0,ok:0,wk:0,uk:t,Ik:t,si:0,ti:0,vk:0,Ck:0,Pi:0,Qi:0,Ai:t,pi:t,Uf:0,Gh:0,Ah:0,Bh:0,Ch:0,xh:0,yh:0,zh:0,Jh:t,Kh:t,Lh:t,cj:t,nj:t,data:t,min:Infinity,max:-Infinity};a.sk=Z(this,"uint");a.xi=Z(this,"uchar",10);a.yi=Z(this,"uchar",18);a.Gi=Z(this,"uint");a.qk=Z(this,"ushort");a.jk=Z(this,"uchar");a.Ci=Z(this,"uchar");a.Xa=Z(this,"ushort",8);a.dj=Z(this,"float");a.ej=Z(this,"float");
a.fj=Z(this,"float");a.bj=Z(this,"ushort");a.dd=Z(this,"ushort");a.ri=Z(this,"ushort");a.xk=Z(this,"ushort");a.A=Z(this,"float",8);a.Qh=Z(this,"float");a.pk=Z(this,"float");a.ok=Z(this,"float");a.wk=Z(this,"ushort");a.uk=Z(this,"uchar");a.Ik=Z(this,"uchar");a.si=Z(this,"float");a.ti=Z(this,"float");a.vk=Z(this,"float");a.Ck=Z(this,"float");a.Pi=Z(this,"uint",1);a.Qi=Z(this,"uint",1);a.Ai=Z(this,"uchar",80);a.pi=Z(this,"uchar",24);a.Uf=Z(this,"ushort");a.Gh=Z(this,"ushort");a.Ah=Z(this,"float");a.Bh=
Z(this,"float");a.Ch=Z(this,"float");a.xh=Z(this,"float");a.yh=Z(this,"float");a.zh=Z(this,"float");a.Jh=Z(this,"float",4);a.Kh=Z(this,"float",4);a.Lh=Z(this,"float",4);a.cj=Z(this,"uchar",16);a.nj=Z(this,"uchar",4);this.r=parseInt(a.Qh,10);var b=a.Xa[1]*a.Xa[2]*a.Xa[3];switch(a.dd){case 2:a.data=Z(this,"uchar",b);break;case 4:a.data=Z(this,"sshort",b);break;case 8:a.data=Z(this,"sint",b);break;case 16:a.data=Z(this,"float",b);break;case 32:a.data=Z(this,"complex",b);break;case 64:a.data=Z(this,"double",
b);break;case 256:a.data=Z(this,"schar",b);break;case 512:a.data=Z(this,"ushort",b);break;case 768:a.data=Z(this,"uint",b);break;default:m(Error("Unsupported NII data type: "+a.dd))}b=Ve(a.data);a.min=b[0];a.max=b[1];return a};function zg(a){var b=-1,b="undefined"==typeof DataView?(new Int32Array(a,0,1))[0]:(new DataView(a,0)).getInt32(0,r);return 348==b?r:u}C("X.parserNII",yg);C("X.parserNII.prototype.parse",yg.prototype.parse);function Ag(){Y.call(this);this.f="parserTRK"}E(Ag,Y);
Ag.prototype.parse=function(a,b,c){F.La(this.f+".parse");var e=b.h,d=b.n,f=b.ra;this.z=c;Z(this,"uchar",6);Z(this,"ushort",3);var g=Z(this,"float",3);Z(this,"float",3);var h=Z(this,"ushort");Z(this,"uchar",200);Z(this,"ushort");Z(this,"uchar",200);c=Z(this,"float",16);Z(this,"uchar",444);Z(this,"uchar",4);Z(this,"uchar",4);Z(this,"float",6);Z(this,"uchar",2);Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");var l=Z(this,"uint");Z(this,"uint");var j=Z(this,
"uint"),k=0===l?Infinity:l,n=[],s=[],l=Infinity,q=-Infinity,x=t,z=t,B=t,A=t,d=e=t,G=Z(this,"uint",(this.z.byteLength-1E3)/4);this.r=j;for(var D=Z(this,"float",(this.z.byteLength-1E3)/4),H=0,j=f=0;j<k;j++){if("undefined"===typeof G[H]){k=j;break}for(var K=G[H],N=new T(3*K),R=0,O=0;O<K;O++){var S=D[H+3*O+O*h+1],da=D[H+3*O+O*h+2],L=D[H+3*O+O*h+3],S=S/g[0],da=da/g[1],L=L/g[2];N.add(S,da,L);if(0<O)var ca=N.get(O-1),R=R+Math.sqrt(Math.pow(S-ca[0],2)+Math.pow(da-ca[1],2)+Math.pow(L-ca[2],2));O<K-1&&(f+=
6)}H+=3*K+K*h+1;O=N.ob;K=N.lb;S=N.pb;da=N.mb;L=N.qb;ca=N.nb;if(!x||O<x)x=O;if(!z||K>z)z=K;if(!B||S<B)B=S;if(!A||da>A)A=da;if(!e||L<e)e=L;if(!d||ca>d)d=ca;n.push(N);s.push(R)}g=(x+z)/2;h=(B+A)/2;A=(e+d)/2;B=new Float32Array(f);b.h=e=new T(f);b.n=d=new T(f);b.ra=f=new T(f);for(j=x=0;j<k;j++){z=n[j];G=z.count;R=s[j];l=Math.min(l,R);q=Math.max(q,R);for(O=0;O<G-1;O++){H=z.get(O);D=z.get(O+1);e.add(H[0],H[1],H[2]);e.add(D[0],D[1],D[2]);var N=H[0]-g,K=H[1]-h,S=H[2]-A,da=Math.sqrt(N*N+K*K+S*S),L=D[0]-g,ca=
D[1]-h,na=D[2]-A,U=Math.sqrt(L*L+ca*ca+na*na);d.add(N/da,K/da,S/da);d.add(L/U,ca/U,na/U);D=[Math.abs(D[0]-H[0]),Math.abs(D[1]-H[1]),Math.abs(D[2]-H[2])];H=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]/=H;D[1]/=H;D[2]/=H;f.add(D[0],D[1],D[2]);f.add(D[0],D[1],D[2]);B[x++]=R;B[x++]=R;B[x++]=R;B[x++]=R;B[x++]=R}}b.Ia="LINES";k=new ld;k.pa=l;k.fa=q;k.R=l;k.T=q;k.md=B;k.Bg=u;k.j=r;b.H=k;l=u;for(j=0;16>j;j++)if(0!=c[j]){l=r;break}l==u&&(c[0]=c[5]=c[10]=c[15]=1);F.Ea(this.f+".parse");F.g.cg(c,b.ka.S);c=new md;
c.F=b;c.v=a;this.dispatchEvent(c)};C("X.parserTRK",Ag);C("X.parserTRK.prototype.parse",Ag.prototype.parse);function Bg(){Y.call(this);this.f="parserOBJ"}E(Bg,Y);
Bg.prototype.parse=function(a,b,c){F.La(this.f+".parse");try{c=(new hg(new Uint8Array(c))).Kb().buffer}catch(e){}this.z=c;var d=c.byteLength,f=Z(this,"uchar",d),g=[];b.h=new T(d);b.n=new T(d);var h=b.h;c=b.n;var l=0,j,k=new Uint32Array(d/9),n=[],s=Array(d);for(j=0;j<d;++j)if(10==f[j]){var q=We(f,l,j).replace(/\s{2,}/g," ").split(" ");if("v"==q[0])g.push([parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3])]);else if("f"==q[0]){var l=parseInt(q[1],10)-1,x=parseInt(q[2],10)-1,q=parseInt(q[3],10)-1,z=
g[l],B=g[x],A=g[q];n.push(l);n.push(x);n.push(q);k[l]+=1;k[x]+=1;k[q]+=1;h.add(z[0],z[1],z[2]);h.add(B[0],B[1],B[2]);h.add(A[0],A[1],A[2]);z=new P(z[0],z[1],z[2]);A=new P(A[0],A[1],A[2]);A=Jc((new P(B[0],B[1],B[2])).wa(z),A.wa(z));A.normalize();if(s[l]){var B=s[l],z=B.x+A.x,G=B.y+A.y,B=B.d+A.d;s[l]={x:z,y:G,d:B}}else s[l]={x:A.x,y:A.y,d:A.d};s[x]?(B=s[x],z=B.x+A.x,G=B.y+A.y,B=B.d+A.d,s[x]={x:z,y:G,d:B}):s[x]={x:A.x,y:A.y,d:A.d};s[q]?(B=s[q],z=B.x+A.x,G=B.y+A.y,B=B.d+A.d,s[q]={x:z,y:G,d:B}):s[q]={x:A.x,
y:A.y,d:A.d}}l=j+1}d=h.length/9;for(j=0;j<d;j++)B=3*j,h=n[B],f=n[B+1],g=n[B+2],l=s[h],x=s[f],q=s[g],x=new P(x.x,x.y,x.d),q=new P(q.x,q.y,q.d),h=(new P(l.x,l.y,l.d)).scale(1/k[h]).normalize(),f=x.scale(1/k[f]).normalize(),g=q.scale(1/k[g]).normalize(),c.add(h.x,h.y,h.d),c.add(f.x,f.y,f.d),c.add(g.x,g.y,g.d);F.Ea(this.f+".parse");c=new md;c.F=b;c.v=a;this.dispatchEvent(c)};C("X.parserOBJ",Bg);C("X.parserOBJ.prototype.parse",Bg.prototype.parse);function Cg(){J.call(this);this.f="loader";this.Mc=new Ac;this.wd=0}E(Cg,J);function Dg(a,b){a.wd+=b/a.Mc.xf()/3;a.wd=Math.min(1,a.wd);var c=new Sd;c.Dd=a.wd;a.dispatchEvent(c)}
function Eg(a){a=a.s.td;var b=a.split(".").pop().toUpperCase(),c=b.lastIndexOf(":");0<c&&(b=b.substring(0,c));"GZ"==b&&(b=a.split(".").reverse()[1].toUpperCase(),b in Fg||m(Error("The compressed "+b+" file format is not supported.")));b==a.toUpperCase()&&(b="");b in Gg||m(Error("The "+b+" file format is not supported."));return[a,b,Gg[b][0],Gg[b][1],Gg[b][2]]}
Cg.prototype.load=function(a,b){(!a||!b)&&m(Error("No container or object to load."));if(!Dc(this.Mc.ia,a.sa)||this.Mc.get(a.sa)){this.Mc.set(a.sa,u);var c=Eg(a)[0];if(a.gb!=t)this.parse(t,a,b);else{var e=new XMLHttpRequest;I(e,"abort",this.Qg.bind(this,e,a,b));I(e,"error",this.Qg.bind(this,e,a,b));I(e,"load",this.parse.bind(this,e,a,b));e.open("GET",c,r);e.responseType="arraybuffer";e.send(t)}}};
Cg.prototype.parse=function(a,b,c){Dg(this,1);setTimeout(function(){var e=Eg(b),d=e[3],e=new e[2];ac(e,Cd,this.complete.bind(this));var f=b.gb;f==t&&(f=a.response,b.gb=f);e.parse(b,c,f,d)}.bind(this),100)};Cg.prototype.complete=function(a){Dg(this,1);setTimeout(function(){var b=a.v,c=a.F;b.s.j=u;b.j=r;c.q();this.Mc.set(b.sa,r)}.bind(this),100)};Cg.prototype.Qg=function(a,b,c){m(Error("Loading failed: ",b,c))};
var Gg={OBJ:[Bg,t],OFF:[xf,t],STL:[xg,t],VTK:[Af,t],TRK:[Ag,t],MRC:[vg,t],ST:[vg,t],FSM:[Cf,t],INFLATED:[Cf,t],SMOOTHWM:[Cf,t],SPHERE:[Cf,t],PIAL:[Cf,t],ORIG:[Cf,t],NRRD:[wg,t],NII:[yg,t],TIF:[og,t],TIFF:[og,t],DCM:[yf,t],DICOM:[yf,t],"":[yf,t],CRV:[kg,t],LABEL:[jg,t],MGH:[ig,u],MGZ:[ig,r],RAW:[mg,u],RZ:[mg,r],TXT:[ug,t],LUT:[ug,t],PNG:[cf,"png"],JPG:[cf,"jpeg"],JPEG:[cf,"jpeg"],GIF:[cf,"gif"]},Fg={OBJ:[Bg,t],NII:[yg,t]};function Hg(a){Qb.call(this);this.Lb=a;this.V=[]}E(Hg,Qb);var Ig=[];function Kg(a,b,c,e,d){ja(c)||(Ig[0]=c,c=Ig);for(var f=0;f<c.length;f++){var g=I(b,c[f],e||a,d||u,a.Lb||a);a.V.push(g)}}Hg.prototype.Vf=function(){Kb(this.V,cc);this.V.length=0};Hg.prototype.handleEvent=function(){m(Error("EventHandler.handleEvent not implemented"))};function Lg(){}Lg.Sg=function(){return Lg.$g?Lg.$g:Lg.$g=new Lg};Lg.prototype.xj=0;Lg.Sg();function Mg(a){kc.call(this);this.dc=a||ce();this.mk=Ng}E(Mg,kc);Mg.prototype.Yi=Lg.Sg();var Ng=t;w=Mg.prototype;w.Zg=t;w.hd=u;w.J=t;w.mk=t;w.Od=t;w.Fd=t;w.sf=t;w.u=v("J");w.Xf=function(a){this.Od&&this.Od!=a&&m(Error("Method not supported"));Mg.w.Xf.call(this,a)};w.qe=v("dc");w.cd=function(){this.J=this.dc.createElement("div")};w.gc=function(a){this.hc(a)};
w.hc=function(a,b){this.hd&&m(Error("Component already rendered"));this.J||this.cd();a?a.insertBefore(this.J,b||t):this.dc.la.body.appendChild(this.J);(!this.Od||this.Od.hd)&&this.ne()};w.ne=function(){function a(a){!a.hd&&a.u()&&a.ne()}this.hd=r;this.Fd&&Kb(this.Fd,a,p)};w.oe=function(){function a(a){a.hd&&a.oe()}this.Fd&&Kb(this.Fd,a,p);this.Ri&&this.Ri.Vf();this.hd=u};
w.removeChild=function(a,b){if(a){var c=la(a)?a:a.Zg||(a.Zg=":"+(a.Yi.xj++).toString(36)),e;this.sf&&c?(e=this.sf,e=(c in e?e[c]:p)||t):e=t;a=e;c&&a&&(e=this.sf,c in e&&delete e[c],Nb(this.Fd,a),b&&(a.oe(),a.J&&ke(a.J)),c=a,c==t&&m(Error("Unable to set parent component")),c.Od=t,Mg.w.Xf.call(c,t))}a||m(Error("Child is not in parent component"));return a};function Og(){kc.call(this)}E(Og,kc);w=Og.prototype;w.eg=0;w.Jd=0;w.Ef=100;w.Pg=0;w.ag=1;w.gj=u;w.uj=u;w.Rd=function(a){a=Pg(this,a);this.eg!=a&&(this.eg=a+this.Pg>this.Ef?this.Ef-this.Pg:a<this.Jd?this.Jd:a,!this.gj&&!this.uj&&this.dispatchEvent("change"))};w.te=function(){return Pg(this,this.eg)};w.se=function(){return Pg(this,this.Jd)};w.re=function(){return Pg(this,this.Ef)};function Pg(a,b){return a.ag==t?b:a.Jd+Math.round((b-a.Jd)/a.ag)*a.ag};function Qg(a){Mg.call(this,a);this.Pd=new Og;I(this.Pd,"change",this.Si,u,this)}E(Qg,Mg);var Rg={vertical:"progress-bar-vertical",horizontal:"progress-bar-horizontal"};w=Qg.prototype;w.cd=function(){this.Db=this.qe().cd("div","progress-bar-thumb");var a=Rg[this.uh];this.J=this.qe().cd("div",a,this.Db);Sg(this);a=this.se();this.u().setAttribute("aria-valuemin",a);a=this.re();this.u().setAttribute("aria-valuemax",a)};
w.ne=function(){Qg.w.ne.call(this);jb&&7>tb&&I(this.u(),"resize",this.Je,u,this);this.Je();var a=this.u();a.setAttribute("role","progressbar");a.setAttribute("aria-live","polite")};w.oe=function(){Qg.w.oe.call(this);jb&&7>tb&&bc(this.u(),"resize",this.Je,u,this)};w.te=function(){return this.Pd.te()};w.Rd=function(a){this.Pd.Rd(a);this.u()&&Sg(this)};function Sg(a){var b=a.te();a.u().setAttribute("aria-valuenow",b)}w.se=function(){return this.Pd.se()};w.re=function(){return this.Pd.re()};w.uh="horizontal";
w.Si=function(){this.Je();this.dispatchEvent("change")};w.Je=function(){if(this.Db){var a=this.se(),b=this.re(),a=(this.te()-a)/(b-a),b=Math.round(100*a);"vertical"==this.uh?jb&&7>tb?(this.Db.style.top=0,this.Db.style.height="100%",b=this.Db.offsetHeight,a=Math.round(a*b),this.Db.style.top=b-a+"px",this.Db.style.height=a+"px"):(this.Db.style.top=100-b+"%",this.Db.style.height=b+"%"):this.Db.style.width=b+"%"}};function Tg(a,b){a==t&&m(Error("No valid parent element."));b==t&&m(Error("Invalid initial value."));Qg.call(this);this.f="progressbar";this.hb=a;this.$e="";this.Wd=this.Jb=t;this.kc=[];var c;c=".progress-bar-horizontal {\n  position: relative;\n  border: 1px solid #949dad;\n";c+="  background: white;\n";c+="  padding: 1px;\n";c+="  overflow: hidden;\n";c+="  margin: 2px;\n";c+="  width: 100px;\n";c+="  height: 5px;\n";c+="}";var e;e=".progress-bar-thumb {\n  position: relative;\n  background: #F62217;\n";
e+="  overflow: hidden;\n";e+="  width: 0%;\n";e+="  height: 100%;\n";e+="}";var d;d=".progress-bar-thumb-done {\n  background: #57E964;\n}";this.kc=[c,e,d];this.Rd(b);this.zf()}E(Tg,Qg);
Tg.prototype.zf=function(){var a=se(this.hb,"position");if("static"==a||""==a)this.$e=this.hb.style.position,this.hb.style.position="relative";var a=document.getElementsByTagName("head")[0],b=he("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.kc[0])),e=document.createTextNode(String(this.kc[1])),d=document.createTextNode(String(this.kc[2]));a.appendChild(b);b.appendChild(c);b.appendChild(e);b.appendChild(d);this.Jb=b;this.gc(this.hb);a=this.u();a.style.position=
"absolute";a.style.top=(this.hb.clientHeight-5)/2+"px";a.style.left=(this.hb.clientWidth-100)/2+"px";a.classList.add("xtk-progress-bar")};function Ug(a){var b=a.u().style.top,c=a.u().style.left;ke(a.u());var e=new Tg(a.hb,100),d=e.u();d.style.position="absolute";d.style.top=b;d.style.left=c;d.classList.add("xtk-progress-bar");(d.firstElementChild!=p?d.firstElementChild:le(d.firstChild)).classList.add("progress-bar-thumb-done");a.Wd=e}
Tg.prototype.Id=function(){this.Jb&&ke(this.Jb);this.u()&&ke(this.u());this.Wd&&ke(this.Wd.u());this.Wd=this.Jb=t;this.$e&&(this.hb.style.position=this.$e)};function Vg(){J.call(this);this.f="renderer";this.v=window.document.body;this.L=this.v.clientWidth;this.D=this.v.clientHeight;this.W=this.O=this.oa=t;this.rb=new uf(od);this.Ha=[];this.ea=t;this.be=this.qd=this.$d=u;this.a=this.Ib=this.Na=t;this.U={PROGRESSBAR_ENABLED:r,INTERMEDIATE_RENDERING:u,SLICENAVIGATORS:r};this.Le=-1;window.console.log("XTK release 10 -- 2018-06-26 11:10:45 -- http://www.goXTK.com -- @goXTK")}E(Vg,J);w=Vg.prototype;
w.Lf=function(){window.cancelAnimationFrame(this.Le);this.U.PROGRESSBAR_ENABLED&&(this.Ib==t?this.Ib=new Tg(this.v,3):ud("BAD, renderer, onComputing, can not assign new progressBar2 "))};w.Mf=function(){this.U.PROGRESSBAR_ENABLED&&this.Ib&&(Ug(this.Ib),this.Td=mf(function(){this.Td=t;this.Ib&&(this.Ib.Id(),this.Ib=t);this.qd=this.be=r;this.gc()}.bind(this),700))};w.Nf=function(a){this.Ib&&this.Ib.Rd(100*a.Dd)};w.Oj=function(a){this.Na&&this.Na.Rd(100*a.Dd)};
w.Ej=function(a){a!=t&&a instanceof md&&a.F&&this.wb(a.F)};w.Pj=function(a){a!=t&&a instanceof nd&&a.F&&this.remove(a.F)};w.Pf=function(a){(a==t||!(a instanceof Pd))&&m(Error("Invalid hover event."))};w.ze=function(){this.ab()};w.ab=function(){var a=fe(this.v);this.L=a.clientWidth;this.D=a.clientHeight;a=fe(this.oa);a.width=this.L;a.height=this.D;"renderer3D"==this.f&&(this.a.viewport(0,0,this.L,this.D),this.O.ce=F.g.ye(F.g.gd(),this.O.Qe,this.oa.width/this.oa.height,1,1E4))};
w.Qf=function(a){(a==t||!(a instanceof Od))&&m(Error("Invalid scroll event."))};Vg.prototype.__defineGetter__("config",v("U"));Vg.prototype.__defineGetter__("interactor",v("W"));Vg.prototype.__defineGetter__("camera",v("O"));Vg.prototype.__defineGetter__("loadingCompleted",v("qd"));Vg.prototype.__defineGetter__("container",v("v"));
Vg.prototype.__defineSetter__("container",function(a){a==t&&m(Error("An ID to a valid container (<div>..) is required."));var b=a;la(b)&&(b=fe(a));pa(b)&&1==b.nodeType||m(Error("Could not find the given container."));this.v=b});w=Vg.prototype;w.Qd=function(){this.O.reset()};
w.Da=function(a){var b=he("canvas");this.v.appendChild(b);this.L=this.v.clientWidth;this.D=this.v.clientHeight;b.width=this.L;b.height=this.D;try{var c=b.getContext(a);c||m(Error())}catch(e){var d="Sorry, "+a+' context is <strong>not supported</strong> on this machine! See <a href="http://crash.goXTK.com" target="_blank">http://crash.goXTK.com</a> for requirements..';this.v.innerHTML='<h3 style="color:red;font-family:sans-serif;">Oooops..</h3><p style="color:red;font-family:sans-serif;">'+d+"</p>";
m(Error(d))}this.ea=new Cg;I(this.ea,Ed,this.Oj.bind(this));this.oa=b;this.a=c;b=new Pe(this.oa);"2d"==a&&(b=new Re(this.oa));b.Da();I(b,Ad,this.Qd.bind(this));I(b,Fd,this.Pf.bind(this));I(b,zd,this.Qf.bind(this));this.W=b;b=new Te(this.L,this.D);"2d"==a&&(b=new df(this.L,this.D));b.observe(this.W);this.O=b;I(window,"resize",this.ze,u,this)};w.add=function(a){(a instanceof tf||a instanceof lf||a instanceof of)&&a.q();this.Ha.push(a);this.wb(a)};
w.remove=function(a){(!this.oa||!this.a)&&m(Error("The renderer was not initialized properly."));if(a!=t){ec(a);var b=this.Ha.length,c;for(c=0;c<b;c++)if(this.Ha[c].sa==a.sa)return this.Ha[c]=t,this.Ha.splice(c,1),r}return u};w.wb=function(a){(!this.oa||!this.a)&&m(Error("The renderer was not initialized properly."));a!=t&&(fc(a,Cd)||I(a,Cd,this.Ej.bind(this)),fc(a,Dd)||I(a,Dd,this.Pj.bind(this)),fc(a,Hd)||I(a,Hd,this.Lf.bind(this)),fc(a,Jd)||I(a,Jd,this.Nf.bind(this)),fc(a,Id)||I(a,Id,this.Mf.bind(this)))};
w.get=function(a){a==t&&m(Error("Invalid object id."));for(var b=this.rb.K,c=b.length,e=0,e=0;e<c;e++)if(b[e].sa==a)return b[e];return t};
w.gc=function(){(!this.oa||!this.a)&&m(Error("The renderer was not initialized properly."));if(this.Ag==t){if(Cc(this.ea.Mc)){if(this.U.PROGRESSBAR_ENABLED&&!this.Na&&(this.Na=new Tg(this.v,3)),this.be=this.qd=u,this.Ag=mf(function(){this.Ag=t;this.gc()}.bind(this),100),!this.U.INTERMEDIATE_RENDERING)return}else if(!this.qd&&!this.be&&(this.be=r,eval("this.onShowtime()"),this.qd=r),this.Na){this.U.PROGRESSBAR_ENABLED&&(this.Na&&!this.Td)&&(Ug(this.Na),this.Td=mf(function(){this.Td=t;this.Na&&(this.Na.Id(),
this.Na=t);this.gc()}.bind(this),700));return}this.Le=window.requestAnimationFrame(this.gc.bind(this));eval("this.onRender()");this.hc(u,r);eval("this.afterRender()")}};w.th=aa();w.rh=aa();w.Fg=aa();w.hc=aa();
w.Wa=function(){ec(this);bc(window,"resize",this.ze,u,this);window.cancelAnimationFrame(this.Le);this.ea&&(delete this.ea,this.ea=t);this.Na&&(this.Na.Id(),delete this.Na,this.Na=t);this.rb.clear();delete this.rb;this.Ha.length=0;delete this.Ha;delete this.ea;this.ea=t;delete this.O;this.O=t;delete this.W;this.W=t;delete this.a;this.a=t;ke(this.oa);delete this.oa;this.oa=t};function Wg(a,b,c,e,d,f,g,h){var l,j;if(l=c.offsetParent){var k="HTML"==l.tagName||"BODY"==l.tagName;if(!k||"static"!=te(l,"position"))j=ye(l),k||(k=(k=ze(l))&&kb?-l.scrollLeft:k&&(!jb||!Db("8"))&&"visible"!=te(l,"overflowX")?l.scrollWidth-l.clientWidth-l.scrollLeft:l.scrollLeft,j=be(j,new ae(k,l.scrollTop)))}l=j||new ae;j=ye(a);k=De(a);j=new qe(j.x,j.y,k.width,k.height);(k=xe(a))&&j.ah(new qe(k.left,k.top,k.right-k.left,k.bottom-k.top));var k=ce(a),n=ce(c);if(k.la!=n.la){var s=k.la.body,n=n.la.parentWindow||
n.la.defaultView,q=new ae(0,0),x=ee(s)?ee(s).parentWindow||ee(s).defaultView:window,z=s;do{var B=x==n?ye(z):Ae(z);q.x+=B.x;q.y+=B.y}while(x&&x!=n&&(z=x.frameElement)&&(x=x.parent));s=be(q,ye(s));jb&&!ne(k)&&(s=be(s,oe(k)));j.left+=s.x;j.top+=s.y}a=(b&4&&ze(a)?b^2:b)&-5;b=new ae(a&2?j.left+j.width:j.left,a&1?j.top+j.height:j.top);b=be(b,l);d&&(b.x+=(a&2?-1:1)*d.x,b.y+=(a&1?-1:1)*d.y);var A;if(g&&(A=xe(c)))A.top-=l.y,A.right-=l.x,A.bottom-=l.y,A.left-=l.x;return Xg(b,c,e,f,A,g,h)}
function Xg(a,b,c,e,d,f,g){a=a.l();var h=0,l=(c&4&&ze(b)?c^2:c)&-5;c=De(b);g=g?g.l():c.l();if(e||0!=l)l&2?a.x-=g.width+(e?e.right:0):e&&(a.x+=e.left),l&1?a.y-=g.height+(e?e.bottom:0):e&&(a.y+=e.top);if(f){if(d){h=a;e=0;if(65==(f&65)&&(h.x<d.left||h.x>=d.right))f&=-2;if(132==(f&132)&&(h.y<d.top||h.y>=d.bottom))f&=-5;h.x<d.left&&f&1&&(h.x=d.left,e|=1);h.x<d.left&&(h.x+g.width>d.right&&f&16)&&(g.width=Math.max(g.width-(h.x+g.width-d.right),0),e|=4);h.x+g.width>d.right&&f&1&&(h.x=Math.max(d.right-g.width,
d.left),e|=1);f&2&&(e|=(h.x<d.left?16:0)|(h.x+g.width>d.right?32:0));h.y<d.top&&f&4&&(h.y=d.top,e|=2);h.y<=d.top&&(h.y+g.height<d.bottom&&f&32)&&(g.height=Math.max(g.height-(d.top-h.y),0),h.y=0,e|=8);h.y>=d.top&&(h.y+g.height>d.bottom&&f&32)&&(g.height=Math.max(g.height-(h.y+g.height-d.bottom),0),e|=8);h.y+g.height>d.bottom&&f&4&&(h.y=Math.max(d.bottom-g.height,d.top),e|=2);f&8&&(e|=(h.y<d.top?64:0)|(h.y+g.height>d.bottom?128:0));h=e}else h=256;if(h&496)return h}f=a;d=kb&&(ab||rb)&&Db("1.9");f instanceof
ae?(a=f.x,f=f.y):(a=f,f=p);b.style.left=Ce(a,d);b.style.top=Ce(f,d);if(!(c==g||(!c||!g?0:c.width==g.width&&c.height==g.height)))a=ne(ce(ee(b))),jb&&(!a||!Db("8"))?(c=b.style,a?(jb?(a=He(b,"paddingLeft"),d=He(b,"paddingRight"),f=He(b,"paddingTop"),e=He(b,"paddingBottom"),a=new pe(f,d,e,a)):(a=se(b,"paddingLeft"),d=se(b,"paddingRight"),f=se(b,"paddingTop"),e=se(b,"paddingBottom"),a=new pe(parseFloat(f),parseFloat(d),parseFloat(e),parseFloat(a))),jb?(d=Je(b,"borderLeft"),f=Je(b,"borderRight"),e=Je(b,
"borderTop"),b=Je(b,"borderBottom"),b=new pe(e,f,b,d)):(d=se(b,"borderLeftWidth"),f=se(b,"borderRightWidth"),e=se(b,"borderTopWidth"),b=se(b,"borderBottomWidth"),b=new pe(parseFloat(e),parseFloat(f),parseFloat(b),parseFloat(d))),c.pixelWidth=g.width-b.left-a.left-a.right-b.right,c.pixelHeight=g.height-b.top-a.top-a.bottom-b.bottom):(c.pixelWidth=g.width,c.pixelHeight=g.height)):(b=b.style,kb?b.MozBoxSizing="border-box":lb?b.WebkitBoxSizing="border-box":b.boxSizing="border-box",b.width=Math.max(g.width,
0)+"px",b.height=Math.max(g.height,0)+"px");return h};function Yg(){}Yg.prototype.vb=aa();function Zg(a,b){this.tf=a instanceof ae?a:new ae(a,b)}E(Zg,Yg);Zg.prototype.vb=function(a,b,c,e){Wg(ue(a),0,a,b,this.tf,c,t,e)};function $g(a,b,c){this.element=a;this.Mg=b;this.dk=c}E($g,Yg);$g.prototype.vb=function(a,b,c){Wg(this.element,this.Mg,a,b,p,c,this.dk)};function ah(a,b){kc.call(this);this.Lb=new Hg(this);this.Wf(a||t);b&&(this.jd=b)}E(ah,kc);w=ah.prototype;w.J=t;w.oi=r;w.Gg=t;w.Oa=u;w.rk=u;w.Bf=-1;w.eh=-1;w.Xi=u;w.Ei=r;w.jd="toggle_display";w.u=v("J");w.Wf=function(a){this.Oa&&m(Error("Can not change this state of the popup while showing."));this.J=a};
function bh(a,b){a.Ie&&a.Ie.stop();a.ue&&a.ue.stop();if(b){if(!a.Oa&&a.Kf()){a.J||m(Error("Caller must call setElement before trying to show the popup"));a.vb();var c=ee(a.J);a.Xi&&Kg(a.Lb,c,"keydown",a.Cj,r);if(a.oi)if(Kg(a.Lb,c,"mousedown",a.ph,r),jb){var e;try{e=c.activeElement}catch(d){}for(;e&&"IFRAME"==e.nodeName;){try{var f=e.contentDocument||e.contentWindow.document}catch(g){break}c=f;e=c.activeElement}Kg(a.Lb,c,"mousedown",a.ph,r);Kg(a.Lb,c,"deactivate",a.oh)}else Kg(a.Lb,c,"blur",a.oh);
"toggle_display"==a.jd?(a.J.style.visibility="visible",Fe(a.J,r)):"move_offscreen"==a.jd&&a.vb();a.Oa=r;a.Ie?(ac(a.Ie,"end",a.sh,u,a),a.Ie.play()):a.sh()}}else ch(a)}w.vb=ga;function ch(a,b){if(!a.Oa||!a.dispatchEvent({type:"beforehide",target:b}))return u;a.Lb&&a.Lb.Vf();a.Oa=u;a.eh=xa();a.ue?(ac(a.ue,"end",wa(a.Lg,b),u,a),a.ue.play()):a.Lg(b);return r}w.Lg=function(a){"toggle_display"==this.jd?this.rk?mf(this.Wg,0,this):this.Wg():"move_offscreen"==this.jd&&(this.J.style.top="-10000px");this.Of(a)};
w.Wg=function(){this.J.style.visibility="hidden";Fe(this.J,u)};w.Kf=function(){return this.dispatchEvent("beforeshow")};w.sh=function(){this.Bf=xa();this.eh=-1;this.dispatchEvent("show")};w.Of=function(a){this.dispatchEvent({type:"hide",target:a})};w.ph=function(a){a=a.target;!me(this.J,a)&&((!this.Gg||me(this.Gg,a))&&!(150>xa()-this.Bf))&&ch(this,a)};w.Cj=function(a){27==a.keyCode&&ch(this,a.target)&&(a.preventDefault(),a.stopPropagation())};
w.oh=function(a){if(this.Ei){var b=ee(this.J);if(jb||ib){if(a=b.activeElement,!a||me(this.J,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;150>xa()-this.Bf||ch(this)}};function dh(a,b){this.ik=4;this.Ae=b||p;ah.call(this,a)}E(dh,ah);dh.prototype.vb=function(){if(this.Ae){var a=!this.Oa&&"move_offscreen"!=this.jd,b=this.u();a&&(b.style.visibility="hidden",Fe(b,r));this.Ae.vb(b,this.ik,this.Zl);a&&Fe(b,u)}};function eh(a){this.ia=new Ac;a&&this.jf(a)}function fh(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+qa(a):b.substr(0,1)+a}w=eh.prototype;w.xf=function(){return this.ia.xf()};w.add=function(a){this.ia.set(fh(a),a)};w.jf=function(a){a=zc(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};w.Vf=function(a){a=zc(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};w.remove=function(a){return this.ia.remove(fh(a))};w.clear=function(){this.ia.clear()};
w.contains=function(a){a=fh(a);return Dc(this.ia.ia,a)};w.ah=function(a){var b=new eh;a=zc(a);for(var c=0;c<a.length;c++){var e=a[c];this.contains(e)&&b.add(e)}return b};w.Gd=function(){return this.ia.Gd()};w.l=function(){return new eh(this)};function gh(a,b,c){this.dc=c||(a?ce(fe(a)):ce());dh.call(this,this.dc.cd("div",{style:"position:absolute;display:none;"}));this.uf=new ae(1,1);this.me=new eh;a&&hh(this,a);if(b!=t)if(a=this.u(),"textContent"in a)a.textContent=b;else if(a.firstChild&&3==a.firstChild.nodeType){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{for(;c=a.firstChild;)a.removeChild(c);a.appendChild(ee(a).createTextNode(String(b)))}}E(gh,dh);var ih=[];w=gh.prototype;w.Va=t;w.className="goog-tooltip";
w.Hh=500;w.Wi=0;w.qe=v("dc");function hh(a,b){b=fe(b);a.me.add(b);I(b,"mouseover",a.Vi,u,a);I(b,"mouseout",a.Tg,u,a);I(b,"mousemove",a.Ui,u,a);I(b,"focus",a.Ti,u,a);I(b,"blur",a.Tg,u,a)}w.Wf=function(a){var b=this.u();b&&ke(b);gh.w.Wf.call(this,a);a&&(b=this.dc.la.body,b.insertBefore(a,b.lastChild))};
w.Kf=function(){if(!ah.prototype.Kf.call(this))return u;if(this.anchor)for(var a,b=0;a=ih[b];b++)me(a.u(),this.anchor)||bh(a,u);0<=Jb(ih,this)||ih.push(this);a=this.u();a.className=this.className;jh(this);I(a,"mouseover",this.Vg,u,this);I(a,"mouseout",this.Ug,u,this);kh(this);return r};
w.Of=function(){Nb(ih,this);for(var a=this.u(),b,c=0;b=ih[c];c++)b.anchor&&me(a,b.anchor)&&bh(b,u);this.vh&&lh(this.vh);bc(a,"mouseover",this.Vg,u,this);bc(a,"mouseout",this.Ug,u,this);this.anchor=p;if(0==(this.Ob?this.Oa?4:1:this.fd?3:this.Oa?2:0))this.Fe=u;ah.prototype.Of.call(this)};w.ih=function(a,b){this.anchor==a&&this.me.contains(this.anchor)&&(this.Fe||!this.im?(bh(this,u),this.Oa||(this.anchor=a,this.Ae=b||mh(this,0)||p,this.Oa&&this.vb(),bh(this,r))):this.anchor=p);this.Ob=p};
w.tj=function(a){this.fd=p;a==this.anchor&&(this.Va==t||this.Va!=this.u()&&!this.me.contains(this.Va))&&(!this.Ig||!this.Ig.Va)&&bh(this,u)};function nh(a,b){var c=oe(a.dc);a.uf.x=b.clientX+c.x;a.uf.y=b.clientY+c.y}w.Vi=function(a){var b=oh(this,a.target);this.Va=b;jh(this);b!=this.anchor&&(this.anchor=b,this.Ob||(this.Ob=mf(va(this.ih,this,b,p),this.Hh)),ph(this),nh(this,a))};function oh(a,b){try{for(;b&&!a.me.contains(b);)b=b.parentNode;return b}catch(c){return t}}
w.Ui=function(a){nh(this,a);this.Fe=r};w.Ti=function(a){this.Va=a=oh(this,a.target);this.Fe=r;if(this.anchor!=a){this.anchor=a;var b=mh(this,1);jh(this);this.Ob||(this.Ob=mf(va(this.ih,this,a,b),this.Hh));ph(this)}};function mh(a,b){if(0==b){var c=a.uf.l();return new qh(c)}return new rh(a.Va)}function ph(a){if(a.anchor)for(var b,c=0;b=ih[c];c++)me(b.u(),a.anchor)&&(b.Ig=a,a.vh=b)}
w.Tg=function(a){var b=oh(this,a.target),c=oh(this,a.relatedTarget);b!=c&&(b==this.Va&&(this.Va=t),kh(this),this.Fe=u,this.Oa&&(!a.relatedTarget||!me(this.u(),a.relatedTarget))?lh(this):this.anchor=p)};w.Vg=function(){var a=this.u();this.Va!=a&&(jh(this),this.Va=a)};w.Ug=function(a){var b=this.u();if(this.Va==b&&(!a.relatedTarget||!me(b,a.relatedTarget)))this.Va=t,lh(this)};function kh(a){a.Ob&&(ea.clearTimeout(a.Ob),a.Ob=p)}
function lh(a){if(2==(a.Ob?a.Oa?4:1:a.fd?3:a.Oa?2:0))a.fd=mf(va(a.tj,a,a.anchor),a.Wi)}function jh(a){a.fd&&(ea.clearTimeout(a.fd),a.fd=p)}function qh(a,b){Zg.call(this,a,b)}E(qh,Zg);qh.prototype.vb=function(a,b,c){b=ue(a);b=xe(b);c=c?new pe(c.top+10,c.right,c.bottom,c.left+10):new pe(10,0,0,10);Xg(this.tf,a,4,c,b,9)&496&&Xg(this.tf,a,4,c,b,5)};function rh(a){$g.call(this,a,3)}E(rh,$g);
rh.prototype.vb=function(a,b,c){var e=new ae(10,0);Wg(this.element,this.Mg,a,b,e,c,9)&496&&Wg(this.element,2,a,1,e,c,5)};function sh(a,b,c,e){a==t&&m(Error("No valid parent element."));(!y(b)||!y(c))&&m(Error("Invalid coordinates."));(e==t||!(e instanceof Ne))&&m(Error("Invalid interactor."));gh.call(this);this.f="caption";this.hb=a;this.ie=b;this.je=c;this.W=e;this.Jb=t;this.kc=[];a=".x-tooltip {\n  background: #C0C0FF;\n  color: #000000;\n";a+="  border: 1px solid infotext;\n";a+="  padding: 1px;\n";a+="  font-family: sans-serif;\n";a+="}";this.kc=[a];ac(e,Gd,this.Id.bind(this));this.zf()}E(sh,gh);
sh.prototype.zf=function(){var a=se(this.hb,"position");if("static"==a||""==a)this.hb.style.position="relative";var a=document.getElementsByTagName("head")[0],b=he("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.kc[0]));a.appendChild(b);b.appendChild(c);this.Jb=b;this.Ae=new Zg(this.ie,this.je)||p;this.Oa&&this.vb();bh(this,r);hh(this,this.hb);this.u().classList.add("x-tooltip")};
sh.prototype.Id=function(){bh(this,u);this.Jb&&ke(this.Jb);this.u()&&ke(this.u());this.Jb=t};function th(){Vg.call(this);this.f="renderer3D";this.Qc=this.Tc=this.Pc=this.Sc=this.Oc=this.Rc=this.cf=this.df=t;this.C=[0,0,0];this.kd=[0,0,0];this.yg=t;this.Me=new Ac;this.Ad=new Ac;this.vc=new Ac;this.sd=new Ac;this.Gc=new Ac;this.Wc=new Ac;this.uc=new Ac;this.zd=new Ac;this.U={PROGRESSBAR_ENABLED:r,PICKING_ENABLED:r,ORDERING_ENABLED:r,STATISTICS_ENABLED:u,INTERMEDIATE_RENDERING:u}}E(th,Vg);th.prototype.__defineGetter__("config",v("U"));
th.prototype.kk=function(){this.Qc=this.Tc=this.Pc=this.Sc=this.Oc=this.Rc=t;this.C=[0,0,0]};th.prototype.__defineGetter__("bbox",function(){return[this.Rc,this.Oc,this.Sc,this.Pc,this.Tc,this.Qc]});w=th.prototype;w.Pf=function(a){th.w.Pf.call(this,a);var b=a.ie;a=a.je;var c=this.Tf(b,a);if(c=this.get(c))if(c=c.Fc){var e=Ae(this.v);(new sh(this.v,e.x+b+10,e.y+a+10,this.W)).u().innerHTML=c}};
w.Da=function(){th.w.Da.call(this,"experimental-webgl");try{if(this.a.viewport(0,0,this.L,this.D),this.a.clearColor(this.kd[0],this.kd[1],this.kd[2],0),this.a.enable(this.a.BLEND),this.a.blendEquation(this.a.FUNC_ADD),this.a.blendFunc(this.a.SRC_ALPHA,this.a.ONE_MINUS_SRC_ALPHA),this.a.enable(this.a.DEPTH_TEST),this.a.depthFunc(this.a.LEQUAL),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),this.U.PICKING_ENABLED){var a=this.a.createFramebuffer(),b=this.a.createRenderbuffer(),c=this.a.createTexture();
this.a.bindTexture(this.a.TEXTURE_2D,c);this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGB,this.L,this.D,0,this.a.RGB,this.a.UNSIGNED_BYTE,t);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST);this.a.bindFramebuffer(this.a.FRAMEBUFFER,
a);this.a.bindRenderbuffer(this.a.RENDERBUFFER,b);this.a.renderbufferStorage(this.a.RENDERBUFFER,this.a.DEPTH_COMPONENT16,this.L,this.D);this.a.bindRenderbuffer(this.a.RENDERBUFFER,t);this.a.framebufferTexture2D(this.a.FRAMEBUFFER,this.a.COLOR_ATTACHMENT0,this.a.TEXTURE_2D,c,0);this.a.framebufferRenderbuffer(this.a.FRAMEBUFFER,this.a.DEPTH_ATTACHMENT,this.a.RENDERBUFFER,b);this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);this.yg=a}}catch(e){m(Error("Exception while accessing GL Context!\n"+e))}a=new gf;
(this.oa==t||this.a==t||this.O==t)&&m(Error("Renderer was not initialized properly."));(a==t||!(a instanceof gf))&&m(Error("Could not add shaders."));b=Object.keys(jf);Object.keys(hf).every(function(a){a=hf[a];return-1!=this.fe.search(a)||-1!=this.Xd.search(a)}.bind(a))||m(Error("Could not find all attributes in the shader sources."));b.every(function(a){a=jf[a];return-1!=this.fe.search(a)||-1!=this.Xd.search(a)}.bind(a))||m(Error("Could not find all uniforms in the shader sources."));b=this.a.createShader(this.a.FRAGMENT_SHADER);
c=this.a.createShader(this.a.VERTEX_SHADER);this.a.shaderSource(b,a.Xd);this.a.shaderSource(c,a.fe);this.a.compileShader(b);this.a.compileShader(c);this.a.getShaderParameter(b,this.a.COMPILE_STATUS)||m(Error("Fragement Shader compilation failed!\n"+this.a.getShaderInfoLog(b)));this.a.getShaderParameter(c,this.a.COMPILE_STATUS)||m(Error("Vertex Shader compilation failed!\n"+this.a.getShaderInfoLog(c)));var d=this.a.createProgram();this.a.attachShader(d,c);this.a.attachShader(d,b);this.a.linkProgram(d);
this.a.getProgramParameter(d,this.a.LINK_STATUS)||m(Error("Could not create shader program!\n"+this.a.getShaderInfoLog(b)+"\n"+this.a.getShaderInfoLog(c)+"\n"+this.a.getProgramInfoLog(d)));this.a.useProgram(d);this.cf=d;Object.keys(hf).forEach(function(a){a=hf[a];this.Me.set(a,this.a.getAttribLocation(this.cf,a));this.a.enableVertexAttribArray(this.Me.get(a))}.bind(this));Object.keys(jf).forEach(function(a){a=jf[a];this.Ad.set(a,this.a.getUniformLocation(this.cf,a))}.bind(this));this.df=a};
w.wb=function(a){th.w.wb.call(this,a);var b=u;if(a!=t){this.get(a.sa)&&(b=r);var c=a.sa,e=a.h,d=a.n,f=a.ra,g=a.I,h=a.s,l=a.ka,j=a.ya,k=a.e,n=a.H;if(k!=t&&k.s!=t&&k.s.j)this.wb(k);else if(k!=t&&k.j&&this.wb(k),j!=t&&j.s!=t&&j.s.j)this.ea.load(j,a);else if(g!=t&&g.s!=t&&g.s.j)this.ea.load(g,a);else{if(h!=t&&ja(h))if(a.Dc!=t){if(a.Dc.Cf!=h.length||!a.j)return}else{b=0;c=h.length;for(b=0;b<c;b++)this.ea.load(h[b],a);return}else{if(h!=t&&h.j){this.ea.load(a,a);return}if(n!=t&&n.s!=t&&n.s.j){this.ea.load(n,
a);return}}if(0<a.c.length){h=a.c;j=h.length;for(k=k=0;k<j;k++)this.wb(h[k])}if(e){for(h=0;this.$d;)h++,window.console.log("Possible thread lock avoided: "+h);this.$d=r;j=a instanceof $e&&a.Ab instanceof qf;b&&(g!=t&&g.j)&&(h=this.uc.get(c),h!=t&&this.a.isBuffer(h.Q)&&this.a.deleteBuffer(h.Q));h=t;g!=t&&(!b||g.j?(h=a.tc,h==t&&m(Error("Can not add an object and texture without valid coordinate mapping! Set the textureCoordinateMap!")),k=u,g.bc&&(k=r),this.a.pixelStorei(this.a.UNPACK_FLIP_Y_WEBGL,k),
k=this.a.createTexture(),k.$i=g.Ra,this.zd.set(g.sa,k),this.a.bindTexture(this.a.TEXTURE_2D,k),g.bc?(k=this.a.RGBA,g.og&&(k=this.a.LUMINANCE,this.a.pixelStorei(this.a.UNPACK_ALIGNMENT,1)),this.a.texImage2D(this.a.TEXTURE_2D,0,k,g.bf,g.af,0,k,this.a.UNSIGNED_BYTE,g.bc)):this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGBA,this.a.RGBA,this.a.UNSIGNED_BYTE,k.$i),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,
this.a.CLAMP_TO_EDGE),j?(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST)):(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.LINEAR),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.LINEAR)),this.a.bindTexture(this.a.TEXTURE_2D,t),k=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,k),this.a.bufferData(this.a.ARRAY_BUFFER,new Float32Array(h),
this.a.STATIC_DRAW),h=new Wd(k,h.length,2),this.uc.set(c,h),g.j=u):h=this.uc.get(c));Dg(this.ea,0.1);if(j)this.$d=u,F.Ea(this.f+".update"),Dg(this.ea,0.9);else{if(!b||e.j||l.j){j=l.S;g=F.g.ga(j,e.ob,e.pb,e.qb);j=F.g.ga(j,e.lb,e.mb,e.nb);if(this.Rc===t||g.x<this.Rc)this.Rc=g.x;if(this.Oc===t||j.x>this.Oc)this.Oc=j.x;if(this.Sc===t||g.y<this.Sc)this.Sc=g.y;if(this.Pc===t||j.y>this.Pc)this.Pc=j.y;if(this.Tc===t||g.d<this.Tc)this.Tc=g.d;if(this.Qc===t||j.d>this.Qc)this.Qc=j.d;this.C=[(this.Rc+this.Oc)/
2,(this.Sc+this.Pc)/2,(this.Tc+this.Qc)/2];l.j=u}b&&e.j&&(l=this.vc.get(c),l!=t&&this.a.isBuffer(l.Q)&&this.a.deleteBuffer(l.Q));l=t;!b||e.j?(l=this.a.createBuffer(),e.ab(),this.a.bindBuffer(this.a.ARRAY_BUFFER,l),this.a.bufferData(this.a.ARRAY_BUFFER,e.ha,this.a.STATIC_DRAW),l=new Wd(l,e.count,3),e.j=u):l=this.vc.get(c);Dg(this.ea,0.3);b&&d.j&&(g=this.vc.get(c),g!=t&&this.a.isBuffer(g.Q)&&this.a.deleteBuffer(g.Q));g=t;!b||d.j?(g=this.a.createBuffer(),d.ab(),this.a.bindBuffer(this.a.ARRAY_BUFFER,
g),this.a.bufferData(this.a.ARRAY_BUFFER,d.ha,this.a.STATIC_DRAW),g=new Wd(g,d.count,3),d.j=u):g=this.sd.get(c);Dg(this.ea,0.3);b&&(f&&f.j)&&(d=this.Gc.get(c),d!=t&&this.a.isBuffer(d.Q)&&this.a.deleteBuffer(d.Q));d=t;f&&(!b||f.j?(f.length!=e.length&&m(Error("Mismatch between points and point colors.")),d=this.a.createBuffer(),f.ab(),this.a.bindBuffer(this.a.ARRAY_BUFFER,d),this.a.bufferData(this.a.ARRAY_BUFFER,f.ha,this.a.STATIC_DRAW),d=new Wd(d,f.count,3),f.j=u):d=this.Gc.get(c));Dg(this.ea,0.2);
b&&(n&&n.j)&&(f=this.Wc.get(c),f!=t&&this.a.isBuffer(f.Q)&&this.a.deleteBuffer(f.Q));f=t;n&&(f=n.md,!b||n.j?(f.length!=e.length&&m(Error("Mismatch between points and scalars.")),e=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,e),this.a.bufferData(this.a.ARRAY_BUFFER,f,this.a.STATIC_DRAW),f=new Wd(e,f.length,3),n.j=u):f=this.Wc.get(c));Dg(this.ea,0.1);b||this.rb.add(a);this.vc.set(c,l);this.sd.set(c,g);this.Gc.set(c,d);this.uc.set(c,h);this.Wc.set(c,f);this.$d=a.j=u}}else a.j=u}}};
w.Tf=function(a,b){if(this.U.PICKING_ENABLED){this.hc(r,u);var c=new Uint8Array(4);this.a.readPixels(a,this.D-b,1,1,this.a.RGBA,this.a.UNSIGNED_BYTE,c);return c[0]+255*c[1]+65025*c[2]}return-1};
w.hc=function(a,b){th.w.hc.call(this,a,b);this.a.viewport(0,0,this.L,this.D);this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);var c=this.rb.K,e=c.length;if(0!=e){a?this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.yg):this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);var d=this.O.ce,f=this.O.o;this.a.uniformMatrix4fv(this.Ad.get("perspective"),u,d);this.a.uniformMatrix4fv(this.Ad.get("view"),u,f);d=this.C;this.a.uniform3f(this.Ad.get("center"),parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]));
f=this.Ha.length;for(d=0;d<f;++d){var g=this.Ha[d];if(g instanceof M){var h=F.g.ga(this.O.o,g.t[0]+g.b[0].i[0],g.t[1]+g.b[0].i[1],g.t[2]+g.b[0].i[2]),l=F.g.ga(this.O.o,g.t[0]-g.b[0].i[0],g.t[1]-g.b[0].i[1],g.t[2]-g.b[0].i[2]),j=Math.abs(h.d-l.d),h=F.g.ga(this.O.o,g.t[0]+g.b[1].i[0],g.t[1]+g.b[1].i[1],g.t[2]+g.b[1].i[2]),l=F.g.ga(this.O.o,g.t[0]-g.b[1].i[0],g.t[1]-g.b[1].i[1],g.t[2]+-g.b[1].i[2]),k=Math.abs(h.d-l.d),h=F.g.ga(this.O.o,g.t[0]+g.b[2].i[0],g.t[1]+g.b[2].i[1],g.t[2]+g.b[2].i[2]),l=F.g.ga(this.O.o,
g.t[0]-g.b[2].i[0],g.t[1]-g.b[2].i[1],g.t[2]-g.b[2].i[2]),h=Math.max(j,k,Math.abs(h.d-l.d));h==j?pf(g,0):h==k?pf(g,1):pf(g,2)}}if(this.U.ORDERING_ENABLED){j=u;f=this.Ha;g=f.length-1;do if(d=f[g],d instanceof M&&d.Ua&&-1!=d.Y){var j=d.c[d.Y].c,k=d.Y,h=F.g.ga(this.O.o,d.t[0]+d.b[k].G[0],d.t[1]+d.b[k].G[1],d.t[2]+d.b[k].G[2]),l=F.g.ga(this.O.o,d.t[0]-d.b[k].G[0],d.t[1]-d.b[k].G[1],d.t[2]-d.b[k].G[2]),h=h.d-l.d,l=Math.max(d.ic[d.Y],Math.max(d.ic[d.Y+4],d.ic[d.Y+8])),n=Math.min(d.ic[d.Y],Math.min(d.ic[d.Y+
4],d.ic[d.Y+8]));if(0>h*(l+n))for(h=h=0;h<d.xd[k]-1;h++)j[h]&&(j[h].Aa=d.Aa,j[h].za=d.b[k].Zc*h);else for(h=d.xd[k]-1;0<=h;h--)j[h]&&(j[h].Aa=d.Aa,j[h].za=(d.xd[k]-1)*d.b[k].Zc-d.b[k].Zc*h);j=r}while(g--);f=this.rb.K;g=f.length-1;do if(d=f[g],d.P&&!(1==d.Aa||d instanceof $e))j=d,k=d.h.Ud,d=F.g.ga(d.ka.S,k[0],k[1],k[2]),d=F.g.ga(this.O.o,d.x,d.y,d.d),d=F.m.wf(this.O.oc,d),d=Math.round(1E3*d)/1E3,j.za=d,j=r;while(g--);j&&this.rb.sort()}if(f=!a&&b!=t&&b&&this.U.STATISTICS_ENABLED)var s=0;var d=this.Me,
g=d.get("vertexPosition"),j=d.get("vertexNormal"),k=d.get("vertexColor"),h=d.get("vertexTexturePos"),l=d.get("vertexScalar"),d=this.Ad,n=d.get("usePicking"),q=d.get("useObjectColor"),x=d.get("objectColor"),z=d.get("useScalars"),B=d.get("scalarsReplaceMode"),A=d.get("scalarsMin"),G=d.get("scalarsMax"),D=d.get("scalarsMinColor"),H=d.get("scalarsMaxColor"),K=d.get("scalarsInterpolation"),N=d.get("scalarsMinThreshold"),R=d.get("scalarsMaxThreshold"),O=d.get("objectOpacity"),S=d.get("labelmapOpacity"),
da=d.get("labelmapColor"),L=d.get("useTexture"),ca=d.get("useLabelMapTexture"),na=d.get("textureSampler"),U=d.get("textureSampler2"),V=d.get("volumeLowerThreshold"),Ha=d.get("volumeUpperThreshold"),wb=d.get("volumeScalarMin"),xb=d.get("volumeScalarMax"),yb=d.get("volumeWindowLow"),mb=d.get("volumeWindowHigh"),dd=d.get("volumeScalarMinColor"),xh=d.get("volumeScalarMaxColor"),Jg=d.get("volumeTexture"),yh=d.get("objectTransform"),zh=d.get("pointSize"),d=e;do{var fa=c[e-d];if(fa){var ma=t;fa instanceof
$e&&fa.Ab&&(ma=fa.Ab);if(fa.P&&(!ma||ma.P)&&(!a||fa.ud)){var Da=fa.sa,eb=fa.rd,pb=this.vc.get(Da),qb=this.sd.get(Da),ef=this.Gc.get(Da),Pb=this.Wc.get(Da),ff=this.uc.get(Da);this.a.bindBuffer(this.a.ARRAY_BUFFER,pb.Q);this.a.vertexAttribPointer(g,pb.Vb,this.a.FLOAT,u,0,0);this.a.bindBuffer(this.a.ARRAY_BUFFER,qb.Q);this.a.vertexAttribPointer(j,qb.Vb,this.a.FLOAT,u,0,0);a?this.a.uniform1i(n,r):this.a.uniform1i(n,u);ef&&!a&&!eb?(this.a.uniform1i(q,u),this.a.bindBuffer(this.a.ARRAY_BUFFER,ef.Q),this.a.vertexAttribPointer(k,
ef.Vb,this.a.FLOAT,u,0,0)):(qb=1,eb&&!a&&(qb=0),this.a.uniform1i(q,qb),qb=fa.B,a&&(qb=[Math.floor(Da%65025%255)/255,Math.floor(Da%65025/255)/255,Math.floor(Da/65025)/255]),this.a.uniform3f(x,parseFloat(qb[0]),parseFloat(qb[1]),parseFloat(qb[2])),this.a.vertexAttribPointer(k,pb.Vb,this.a.FLOAT,u,0,0));Pb&&!a&&!eb?(this.a.uniform1i(z,r),this.a.uniform1i(B,fa.H.Bg),Da=fa.H.Yb,eb=fa.H.Wb,this.a.uniform3f(D,parseFloat(Da[0]),parseFloat(Da[1]),parseFloat(Da[2])),this.a.uniform3f(H,parseFloat(eb[0]),parseFloat(eb[1]),
parseFloat(eb[2])),this.a.uniform1f(N,parseFloat(fa.H.R)),this.a.uniform1f(R,parseFloat(fa.H.T)),this.a.uniform1f(A,parseFloat(fa.H.pa)),this.a.uniform1f(G,parseFloat(fa.H.fa)),this.a.uniform1i(K,parseInt(fa.H.Re,10)),this.a.bindBuffer(this.a.ARRAY_BUFFER,Pb.Q),this.a.vertexAttribPointer(l,Pb.Vb,this.a.FLOAT,u,0,0)):(this.a.uniform1i(z,u),this.a.vertexAttribPointer(l,pb.Vb,this.a.FLOAT,u,0,0));this.a.uniform1f(O,parseFloat(fa.Aa));fa.I&&ff&&!a?(this.a.uniform1i(L,r),this.a.activeTexture(this.a.TEXTURE0),
this.a.bindTexture(this.a.TEXTURE_2D,this.zd.get(fa.I.sa)),this.a.uniform1i(na,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,ff.Q),this.a.vertexAttribPointer(h,ff.Vb,this.a.FLOAT,u,0,0),this.a.uniform1i(Jg,u)):(this.a.uniform1i(L,u),this.a.vertexAttribPointer(h,pb.Vb,this.a.FLOAT,u,0,0));ma&&(this.a.uniform1i(Jg,r),this.a.uniform1f(V,ma.R),this.a.uniform1f(Ha,ma.T),this.a.uniform1f(wb,ma.pa),this.a.uniform1f(xb,ma.fa),Da=ma.Yb,eb=ma.Wb,this.a.uniform3f(dd,parseFloat(Da[0]),parseFloat(Da[1]),parseFloat(Da[2])),
this.a.uniform3f(xh,parseFloat(eb[0]),parseFloat(eb[1]),parseFloat(eb[2])),this.a.uniform1f(yb,ma.$),this.a.uniform1f(mb,ma.Z),Pb=ma.e,this.a.uniform1i(ca,u),ma.Ua?this.a.uniform1f(O,parseFloat(ma.Aa)):Pb&&Pb.P&&(ma=fa.e.sa,this.a.uniform1i(ca,r),this.a.activeTexture(this.a.TEXTURE1),this.a.bindTexture(this.a.TEXTURE_2D,this.zd.get(ma)),this.a.uniform1i(U,1),this.a.uniform1f(S,Pb.Aa),this.a.uniform4fv(da,Pb.ef)));this.a.uniformMatrix4fv(yh,u,fa.ka.S);ma=1;"POINTS"==fa.Ia&&(ma=fa.vd);this.a.uniform1f(zh,
ma);ma=-1;fa.Ia==jd?(ma=this.a.TRIANGLES,f&&(s+=pb.nd/3)):"LINES"==fa.Ia?(this.a.lineWidth(fa.Nc),ma=this.a.LINES):"POINTS"==fa.Ia?ma=this.a.POINTS:"TRIANGLE_STRIPS"==fa.Ia?(ma=this.a.TRIANGLE_STRIP,f&&(s+=pb.nd/3)):"POLYGONS"==fa.Ia&&(ma=0==pb.nd%3?this.a.TRIANGLES:this.a.TRIANGLE_FAN,f&&(s+=pb.nd/3));this.a.drawArrays(ma,0,pb.nd)}}}while(--d);f&&Math.round(s)}};
w.remove=function(a){th.w.remove.call(this,a);if(0<a.c.length)for(var b=a.c,c=b.length,e=0,e=0;e<c;e++)"undefined"!=typeof b[e]&&this.remove(b[e]);b=a.sa;c=this.uc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);if(a.I&&(c=this.zd.get(a.I.sa)))this.a.deleteTexture(c),this.zd.remove(a.I.sa);c=this.vc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);c=this.sd.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);c=this.Gc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);
c=this.Wc.get(b);c!=t&&this.a.isBuffer(c.Q)&&this.a.deleteBuffer(c.Q);this.vc.remove(b);this.sd.remove(b);this.Gc.remove(b);this.uc.remove(b);this.Wc.remove(b);this.rb.remove(a);return r};w.Wa=function(){this.df=t;delete this.df;this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);th.w.Wa.call(this)};th.prototype.__defineGetter__("bgColor",v("kd"));th.prototype.__defineSetter__("bgColor",ba("kd"));
th.prototype.gk=function(a,b,c,e,d){c!=t||(c=4);e!=t||(e=2);if(d==t){d=this.Tf(a,b);if(-1==d)return t;d=this.get(d);if(!d)return t}var f=Ue(this.O,2*(a/this.L)-1,2*((this.D-b)/this.D)-1,0);a=Ue(this.O,2*(a/this.L)-1,2*((this.D-b)/this.D)-1,1);f[0]+=this.C[0];f[1]+=this.C[1];f[2]+=this.C[2];a[0]+=this.C[0];a[1]+=this.C[1];a[2]+=this.C[2];b=[d.h.ob,d.h.pb,d.h.qb];var g=[d.h.lb,d.h.pb,d.h.qb],h=[d.h.lb,d.h.mb,d.h.qb],l=[d.h.ob,d.h.mb,d.h.qb],j=[d.h.ob,d.h.mb,d.h.nb],k=[d.h.ob,d.h.pb,d.h.nb],n=[d.h.lb,
d.h.mb,d.h.nb],s=[d.h.lb,d.h.pb,d.h.nb];b=[F.g.ga(d.ka.S,b[0],b[1],b[2]),F.g.ga(d.ka.S,g[0],g[1],g[2]),F.g.ga(d.ka.S,h[0],h[1],h[2]),F.g.ga(d.ka.S,l[0],l[1],l[2]),F.g.ga(d.ka.S,j[0],j[1],j[2]),F.g.ga(d.ka.S,k[0],k[1],k[2]),F.g.ga(d.ka.S,n[0],n[1],n[2]),F.g.ga(d.ka.S,s[0],s[1],s[2])];var g=[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity],q;for(q in b)q=b[q],g=[Math.min(g[0],q.x),Math.max(g[1],q.x),Math.min(g[2],q.y),Math.max(g[3],q.y),Math.min(g[4],q.d),Math.max(g[5],q.d)];q=g;b=[];g=[];
for(h=0;6>h;h++){var l=Math.floor(h/2),j=(l+1)%3,k=(l+2)%3,s=(2+2*l)%6,x=(4+2*l)%6,z=(q[h]-f[l])*(1/a[l]);Infinity!=z&&-Infinity!=z&&(n=f[j]+a[j]*z,z=f[k]+a[k]*z,n>=q[s]&&n<=q[s+1]&&z>=q[x]&&z<=q[x+1]?(s=[],s[l]=q[h],s[j]=n,s[k]=z,b.push(s)):(s=[],s[l]=q[h],s[j]=n,s[k]=z,g.push(s)))}a=[b,g];a=a[0];if(0==a.length)return t;g=Array(2);for(q=0;2>q;q++)b=a[q],g[q]=Math.sqrt((b[0]-f[0])*(b[0]-f[0])+(b[1]-f[1])*(b[1]-f[1])+(b[2]-f[2])*(b[2]-f[2]));f=b=q=t;g[0]<g[1]?(q=a[0],b=a[1]):(q=a[1],b=a[0]);f=Math.sqrt((q[0]-
b[0])*(q[0]-b[0])+(q[1]-b[1])*(q[1]-b[1])+(q[2]-b[2])*(q[2]-b[2]));f/=c;a=q;q=[b[0]-q[0],b[1]-q[1],b[2]-q[2]];b=Math.sqrt(q[0]*q[0]+q[1]*q[1]+q[2]*q[2]);g=[q[0]/b,q[1]/b,q[2]/b];h=d.h.ha;l=h.length;j=[];for(q=0;q<f;q+=c){a=[a[0]+c*g[0],a[1]+c*g[1],a[2]+c*g[2]];k=[];n=[];for(b=s=0;b<l;b+=3){var z=h[b],B=h[b+1],A=h[b+2],x=new F.m(z,B,A),x=F.g.ga(d.ka.S,z,B,A),A=Math.sqrt((a[0]-x.x)*(a[0]-x.x)+(a[1]-x.y)*(a[1]-x.y)+(a[2]-x.d)*(a[2]-x.d));if(A<=e){z=k;B=n;x=[x.x,x.y,x.d];if(0==z.length)z.push(x),B.push(A);
else for(var G=0;G<z.length&&5>G;G++)if(A==B[G]){z[G][0]==x[0]&&z[G][1]==x[1]&&z[G][2]==x[2]||(z.splice(G,0,x),B.splice(G,0,A));break}else if(A<B[G]){z.splice(G,0,x);B.splice(G,0,A);break}s++}}j.push([[a],k.slice(0,5)]);if(0<k.length)return j}return t};C("X.renderer3D",th);C("X.renderer3D.prototype.init",th.prototype.Da);C("X.renderer3D.prototype.add",th.prototype.add);C("X.renderer3D.prototype.onShowtime",th.prototype.th);C("X.renderer3D.prototype.onRender",th.prototype.rh);
C("X.renderer3D.prototype.get",th.prototype.get);C("X.renderer3D.prototype.render",th.prototype.gc);C("X.renderer3D.prototype.destroy",th.prototype.Wa);C("X.renderer3D.prototype.remove",th.prototype.remove);C("X.renderer3D.prototype.resetBoundingBox",th.prototype.kk);C("X.renderer3D.prototype.bbox",th.prototype.Jl);C("X.renderer3D.prototype.resetViewAndRender",th.prototype.Qd);C("X.renderer3D.prototype.pick",th.prototype.Tf);C("X.renderer3D.prototype.pick3d",th.prototype.gk);
C("X.renderer3D.prototype.afterRender",th.prototype.Fg);C("X.renderer3D.prototype.resize",th.prototype.ab);function uh(){W.call(this);this.f="mesh";Fa(this,new yc)}E(uh,W);C("X.mesh",uh);function vh(){W.call(this);this.f="fibers";Fa(this,new yc)}E(vh,W);C("X.fibers",vh);function wh(){Vg.call(this);this.f="renderer2D";this.Ta=t;this.Fa=-1;this.Zb=[];this.rg=this.od=this.mg=this.Yd=t;this.Yc=this.ad=this.Xc=this.$c=0;this.Z=this.$=this.T=this.R=this.Oe=-1;this.sg=new Float32Array([-255,-255,-255,-255]);this.zg=r;this.zb=1}E(wh,Vg);w=wh.prototype;w.remove=function(a){wh.w.remove.call(this,a);this.rb.remove(a);return r};w.Rj=aa();w.ak=aa();
w.Qf=function(a){wh.w.Qf.call(this,a);var b=this.Ha[0];if(b){var c="",c=0==this.Fa?"indexX":1==this.Fa?"indexY":"indexZ";b[c]=a.X?b[c]+1:b[c]-1;eval("this.onScroll();")}};w.bk=function(a){var b=this.Ha[0];if(b){var c=b.Z-b.$,e=c/2,d=parseInt(c+c/15*-a.hf,10);a=parseInt(e+e/15*a.We,10);c==d&&d++;e==a&&a++;b.$-=parseInt(e-a,10);b.$-=parseInt(c-d,10);b.$=Math.max(b.$,b.pa);b.Z-=parseInt(e-a,10);b.Z+=parseInt(c-d,10);b.Z=Math.min(b.Z,b.fa);eval("this.onWindowLevel();")}};
wh.prototype.__defineGetter__("orientation",v("Ta"));wh.prototype.__defineSetter__("orientation",function(a){a=a.toUpperCase();"AXIAL"==a?(a="Z",this.Fa=2):"SAGITTAL"==a?(a="X",this.Fa=0):"CORONAL"==a&&(a="Y",this.Fa=1);"X"!=a&&("Y"!=a&&"Z"!=a)&&m(Error("Invalid orientation."));this.Ta=a});wh.prototype.__defineGetter__("radiological",v("zg"));wh.prototype.__defineGetter__("normalizedScale",v("zb"));wh.prototype.__defineGetter__("canvasWidth",function(){return this.oa.width});
wh.prototype.__defineGetter__("canvasHeight",function(){return this.oa.height});wh.prototype.__defineGetter__("sliceWidth",v("$c"));wh.prototype.__defineGetter__("sliceHeight",v("Xc"));wh.prototype.__defineSetter__("radiological",ba("zg"));w=wh.prototype;
w.Da=function(){this.Ta||m(Error("No 2D orientation set."));wh.w.Da.call(this,"2d");this.a.fillStyle="rgba(50,50,50,0)";this.a.fillRect(0,0,this.oa.width,this.oa.height);this.Yd=he("canvas");this.od=he("canvas");this.od.style.Rl="pixelated";I(this.O,Bd,this.bk.bind(this))};w.ze=function(){wh.w.ze.call(this);Ah(this)};w.Qd=function(){wh.w.Qd.call(this);Ah(this);var a=this.Ha[0];a&&(a.Z=a.fa,a.$=a.pa)};w.update=function(a){this.wb(a);this.Oe=-1};
w.wb=function(a){wh.w.wb.call(this,a);var b=u;this.get(a.sa)&&(b=r);if(a instanceof M){var c=a.s,e=a.e,d=a.ya;if(e!=t&&e.s!=t&&e.s.j)this.wb(e);else if(d!=t&&d.s!=t&&d.s.j)this.ea.load(d,a);else{if(c!=t&&ja(c))if(a.Dc!=t){if(a.Dc.Cf!=c.length)return}else{b=0;e=c.length;for(b=0;b<e;b++)this.ea.load(c[b],a);return}else if(c!=t&&c.j){this.ea.load(a,a);return}this.Fa="X"==this.Ta?0:"Y"==this.Ta?1:2;this.ib=a.c[this.Fa].c;d=t;d=0==this.Fa?a.indexX:1==this.Fa?a.indexY:a.indexZ;c=a.c[this.Fa].c[d].qg;e=
a.c[this.Fa].c[d].pg;this.ad=a.c[this.Fa].c[d].bd;this.Yc=a.c[this.Fa].c[d].Ic;this.$c=c;this.Xc=e;d=this.Yd;d.width=c;d.height=e;var f=this.od;f.width=c;f.height=e;this.mg=d.getContext("2d");this.rg=f.getContext("2d");b||(this.rb.add(a),Ah(this))}}};function Ah(a){var b=Math.min(a.L/(a.$c*a.ad),a.D/(a.Xc*a.Yc));a.O.o[14]=b}w.Sj=aa();
w.Rh=function(a,b){var c=this.Ha[0],e=this.O.o,d=t,f=this.$c,g=this.Xc,h=t,l=t;if("Y"==this.Ta)d=this.ib[parseInt(c.indexY,10)],h=d.bd,l=d.Ic,this.Zb[0]="rgba(255,0,0,.3)",this.Zb[1]="rgba(0,0,255,.3)";else if("Z"==this.Ta)d=this.ib[parseInt(c.indexZ,10)],h=d.bd,l=d.Ic,this.Zb[0]="rgba(255,0,0,.3)",this.Zb[1]="rgba(0,255,0,.3)";else{d=this.ib[parseInt(c.indexX,10)];h=d.Ic;l=d.bd;this.Zb[0]="rgba(0,255,0,.3)";this.Zb[1]="rgba(0,0,255,.3)";var j=f,f=g,g=j}var k=1*e[12],e=-1*e[13],j=[this.L/2,this.D/
2],h=f*h*this.zb,l=g*l*this.zb,n=j[0]-h/2,j=j[1]-l/2,n=n+k*this.zb,j=j+e*this.zb;return a>n&&a<n+h&&b>j&&b<j+l?(k=(a-n)/h*f,e=(b-j)/l*g,l=d.mi[4],"X"==this.Ta?(j=f-k,k=e,e=j):"Y"==this.Ta?k=f-k:"Z"==this.Ta&&(k=f-k,e=g-e),k=d.li+k*d.bd,e=d.fi+e*d.Ic,k=Rc(k,e,l,1),f=Sc(),cd(d.Zh,k,f),f=[Math.floor(f[0]),Math.floor(f[1]),Math.floor(f[2])],g=Sc(),cd(d.$h,k,g),d=Math.round((c.b[0].i[0]*g[0]+c.b[0].i[1]*g[1]+c.b[0].i[2]*g[2]+c.b[0].Ze)/c.b[0].Zc),d>=c.b[0].p?d=c.b[0].p-1:0>d&&(d=0),k=Math.round((c.b[1].i[0]*
g[0]+c.b[1].i[1]*g[1]+c.b[1].i[2]*g[2]+c.b[1].Ze)/c.b[1].Zc),k>=c.b[1].p?k=c.b[1].p-1:0>k&&(k=0),e=Math.round((c.b[2].i[0]*g[0]+c.b[2].i[1]*g[1]+c.b[2].i[2]*g[2]+c.b[2].Ze)/c.b[2].Zc),e>=c.b[2].p?e=c.b[2].p-1:0>e&&(e=0),[[d,k,e],[f[0],f[1],f[2]],[g[0],g[1],g[2]]]):t};
w.hc=function(a,b){wh.w.hc.call(this,a,b);if(0!=this.rb.K.length){var c=this.Ha[0],e=t,e=0==this.Fa?c.indexX:1==this.Fa?c.indexY:c.indexZ,d=this.ib[parseInt(e,10)].qg,f=this.ib[parseInt(e,10)].pg;this.ad=this.ib[parseInt(e,10)].bd;this.Yc=this.ib[parseInt(e,10)].Ic;this.$c=d;this.Xc=f;var g=this.L,h=this.D,l=this.O.o;this.a.save();this.a.clearRect(-g,-h,2*g,2*h);this.a.restore();this.zb=Math.max(l[14],1E-4);this.a.setTransform(this.zb,0,0,this.zb,0,0);var j=1*l[12],l=-1*l[13],k=t;c.e&&(k=c.e.ef);
var n=this.ib[parseInt(e,10)],s=n.I.bc,n=n.e,q=t;n&&(q=n.bc);var x=this.$c,z=this.Xc,B=this.mg,A=this.rg,G=B.getImageData(0,0,x,z),D=A.getImageData(0,0,x,z),H=G.data,K=D.data,N=H.length,R=c.R,O=c.T,S=c.$,da=c.Z;if(this.Oe!=e||this.R!=R||this.T!=O||this.$!=S||this.Z!=da||k&&!vf(k,this.sg,0)){var L=this.Yd;L.width=d;L.height=f;L=this.od;L.width=d;L.height=f;d=0;do{var L=[0,0,0,0],f=[0,0,0,0],ca=s[d]/255*(c.fa-c.pa)+c.pa,na=da-S,U=na/2+S,V=0,V=ca<U-na/2?0:ca>U+na/2?255:255*(ca-(U-na/2))/na;ca>=R&&ca<=
O&&(L=new P(c.Yb[0],c.Yb[1],c.Yb[2]),L=(new P(c.Wb[0],c.Wb[1],c.Wb[2])).scale(V).add(L.scale(255-V)),L=[Math.floor(L.x),Math.floor(L.y),Math.floor(L.d),255],n&&(-255==k[3]?f=[q[d],q[d+1],q[d+2],q[d+3]]:vf(k,q,d)&&(f=[q[d],q[d+1],q[d+2],q[d+3]])));"X"==this.Ta?(H[d]=L[0],H[d+1]=L[1],H[d+2]=L[2],H[d+3]=L[3],K[d]=f[0],K[d+1]=f[1],K[d+2]=f[2],K[d+3]=f[3]):"Y"==this.Ta?(V=Math.floor(d/(4*x)),V=4*V*x+(4*(x-1)-(d-4*V*x)),H[V]=L[0],H[V+1]=L[1],H[V+2]=L[2],H[V+3]=L[3],K[V]=f[0],K[V+1]=f[1],K[V+2]=f[2],K[V+
3]=f[3]):(V=N-1-d,H[V-3]=L[0],H[V-2]=L[1],H[V-1]=L[2],H[V]=L[3],K[V-3]=f[0],K[V-2]=f[1],K[V-1]=f[2],K[V]=f[3]);d+=4}while(d<N);B.putImageData(G,0,0);A.putImageData(D,0,0);this.Oe=e;this.R=R;this.T=O;this.$=S;this.Z=da;n&&(this.sg=k)}this.a.globalAlpha=1;this.a.translate(g/2/this.zb,h/2/this.zb);"X"==this.Ta&&(this.a.rotate(0.5*Math.PI),e=j,j=l,l=-e);j=-x*this.ad/2+j;l=-z*this.Yc/2+l;this.a.drawImage(this.Yd,j,l,x*this.ad,z*this.Yc);n&&c.e.P&&(this.a.globalAlpha=1,this.a.drawImage(this.od,j,l,x*this.ad,
z*this.Yc));if(this.U.SLICENAVIGATORS)if(this.oa.style.cursor="none",this.W.ae&&this.W.Dg&&!this.W.yb){if(j=this.W.ua,j=this.Rh(j[0],j[1]))c.Fb=j[0][0],c.Gb=j[0][1],c.Hb=j[0][2],c.q(u),this.onSliceNavigation(),this.a.setTransform(1,0,0,1,0,0),this.a.beginPath(),this.a.moveTo(this.W.ua[0],0),this.a.lineTo(this.W.ua[0],this.W.ua[1]-1),this.a.moveTo(this.W.ua[0],this.W.ua[1]+1),this.a.lineTo(this.W.ua[0],this.D),this.a.strokeStyle=this.Zb[0],this.a.stroke(),this.a.closePath(),this.a.beginPath(),this.a.moveTo(0,
this.W.ua[1]),this.a.lineTo(this.W.ua[0]-1,this.W.ua[1]),this.a.moveTo(this.W.ua[0]+1,this.W.ua[1]),this.a.lineTo(this.L,this.W.ua[1]),this.a.strokeStyle=this.Zb[1],this.a.stroke(),this.a.closePath(),this.a.font="10pt Arial",this.a.textAlign="left",this.a.textBaseline="top",this.a.fillStyle="white",this.a.fillText("RAS: "+j[2][0].toFixed(2)+", "+j[2][1].toFixed(2)+", "+j[2][2].toFixed(2),0,0),x=n=l="undefined","undefined"!=typeof c.ca[j[1][2].toFixed(0)]&&"undefined"!=typeof c.ca[j[1][2].toFixed(0)][j[1][1].toFixed(0)]&&
(l=c.ca[j[1][2].toFixed(0)][j[1][1].toFixed(0)][j[1][0].toFixed(0)],c.M&&(n=c.e.ca[j[1][2].toFixed(0)][j[1][1].toFixed(0)][j[1][0].toFixed(0)],c.e.ld&&(x=c.e.ld.get(n),"undefined"!=typeof x&&(x=x[0])))),this.a.fillText("Background:  "+l+" ("+j[1][0].toFixed(0)+", "+j[1][1].toFixed(0)+", "+j[1][2].toFixed(0)+")",0,15),c.M&&this.a.fillText("Labelmap:  "+x+" ("+n+")",0,30)}else this.oa.style.cursor="default"}};C("X.renderer2D",wh);C("X.renderer2D.prototype.init",wh.prototype.Da);
C("X.renderer2D.prototype.add",wh.prototype.add);C("X.renderer2D.prototype.onShowtime",wh.prototype.th);C("X.renderer2D.prototype.onRender",wh.prototype.rh);C("X.renderer2D.prototype.onScroll",wh.prototype.Rj);C("X.renderer2D.prototype.onWindowLevel",wh.prototype.ak);C("X.renderer2D.prototype.get",wh.prototype.get);C("X.renderer2D.prototype.resetViewAndRender",wh.prototype.Qd);C("X.renderer2D.prototype.xy2ijk",wh.prototype.Rh);C("X.renderer2D.prototype.render",wh.prototype.gc);
C("X.renderer2D.prototype.destroy",wh.prototype.Wa);C("X.renderer2D.prototype.onSliceNavigation",wh.prototype.Sj);C("X.renderer2D.prototype.afterRender",wh.prototype.Fg);C("X.renderer2D.prototype.resize",wh.prototype.ab);
